(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(e,t){},104:function(e,t){},105:function(e,t){},106:function(e,t){},107:function(e,t){},108:function(e,t){},171:function(e,t,n){"use strict";n.r(t);var a=n(2),i=n.n(a),r=n(7),o=n.n(r),l=(n(95),n(27)),s=n(26),g=(n(96),n(62)),c=n.n(g),u=n(81),h=n(12);function m(e,t){for(var n=[e.canvas.width,e.canvas.height],a=n[0],i=n[1],r=e.createImageData(a,i),o=0;o<a;o++)for(var l=0;l<i;l++){var s=o+l*a;r.data[4*s+0]=Math.min(255,Math.max(0,127.5*(1+t[0][o][l][0]))),r.data[4*s+1]=Math.min(255,Math.max(0,127.5*(1+t[0][o][l][1]))),r.data[4*s+2]=Math.min(255,Math.max(0,127.5*(1+t[0][o][l][2]))),r.data[4*s+3]=255}e.putImageData(r,0,0)}function d(e){var t=e.state,n=e.dispatchState,r=Object(a.useState)(null),o=Object(s.a)(r,2),l=o[0],g=o[1],d=Object(a.useState)(null),f=Object(s.a)(d,2),p=f[0],v=f[1],b=Object(a.useState)(null),w=Object(s.a)(b,2),S=w[0],y=w[1],E=Object(a.useMemo)(function(){return function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n}(t.algorithmSettings.width,t.algorithmSettings.height)},[t.algorithmSettings.width,t.algorithmSettings.height]);return Object(a.useEffect)(function(){if(t.requestRun){var e=l,a=p,i=S;if(null===e||null===a||null===i){var r=[t.algorithmSettings.width,t.algorithmSettings.height,1];(e=function(e,t,n,a){for(var i=h.c({shape:e}),r=[i],o=0;o<n;o++)r.push(h.d.conv2d({filters:Math.min(256,Math.pow(2,o)*a),kernelSize:[4,4],padding:"same",strides:2,activation:"elu"}).apply(r[r.length-1]));for(var l=[r[r.length-1]],s=0;s<n;s++){var g=s===n-1,c=h.d.conv2dTranspose({filters:Math.min(256,Math.pow(2,n-s-1)*a),kernelSize:[4,4],padding:"same",strides:2,activation:"elu"}).apply(l[l.length-1]),u=h.d.concatenate({axis:-1}).apply([c,r[n-s-1]]),m=h.d.conv2d({filters:g?t:Math.min(256,Math.pow(2,n-s-1)*a),kernelSize:[4,4],padding:"same",strides:1,activation:g?"tanh":"elu"}).apply(u);l.push(m)}return h.e({inputs:i,outputs:l[l.length-1]})}(r,3,t.algorithmSettings.layers,t.algorithmSettings.filters)).compile({optimizer:"adam",loss:"meanAbsoluteError"}),a=h.f([1].concat(r)),o=t.sourceImage,s=t.algorithmSettings.width,d=t.algorithmSettings.height,i=h.i(h.g(h.a(h.h(o).reshape([1,d,s,4]).slice([0,0,0,0],[1,d,s,3]),127.5),1),[0,2,1,3]),g(e),v(a),y(i)}Object(u.a)(c.a.mark(function r(){var o;return c.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,n({type:"setRunning",running:!0}),r.next=4,e.fit(a,i,{batchSize:1,epochs:20});case 4:return r.next=6,e.predict(a).array();case 6:o=r.sent,m(E.getContext("2d"),o),n({type:"addImageData",imageData:{iteration:t.iteration,uri:E.toDataURL("image/png")}}),r.next=13;break;case 11:r.prev=11,r.t0=r.catch(0);case 13:n({type:"setRunning",running:!1}),n({type:"setRequestRun",requestRun:!1});case 15:case"end":return r.stop()}},r,null,[[0,11]])}))()}var o,s,d},[t.requestRun]),Object(a.useEffect)(function(){t.generating||(null!==l&&l.dispose(),null!==S&&S.dispose(),null!==p&&p.dispose(),g(null),y(null),v(null))},[t.generating]),i.a.createElement("div",null)}h.b();var f=n(36),p=n(173),v=n(174),b=n(175),w=n(176);n(164),n(165);function S(e,t){var n=Object(l.a)({},e);switch(t.type){case"reset":n.images=[],n.generating=!1,n.iteration=0,n.requestRun=!1,n.algorithmSettings={filters:8,layers:5,width:256,height:256};break;case"start":n.generating=!0;break;case"pause":n.generating=!1;break;case"addImageData":n.images.push(t.imageData);break;case"algorithmSettings":n.algorithmSettings=t.newSettings;break;case"setSourceImage":n.sourceImage=t.image,n.images=[],n.iteration=0;break;case"incrementIteration":n.iteration+=1;break;case"setRunning":n.running=t.running;break;case"setRequestRun":n.requestRun=t.requestRun;break;default:throw new Error("Unhandled action in state update: "+JSON.stringify(t))}return n}var y=n(89),E=n(86),k=n(87),R=n.n(k),x=(n(170),function(){var e=Object(a.useReducer)(S,{generating:!1,running:!1,iteration:0,images:[],algorithmSettings:{filters:8,layers:5,width:256,height:256},sourceImage:null,requestRun:!1}),t=Object(s.a)(e,2),n=t[0],r=t[1];Object(a.useEffect)(function(){n.generating&&!n.requestRun&&(r({type:"incrementIteration"}),r({type:"setRequestRun",requestRun:!0}))},[n.requestRun,n.generating,r]);var o=Object(a.useRef)(null),g=Object(a.useState)(null),c=Object(s.a)(g,2),u=c[0],h=c[1];Object(a.useEffect)(function(){if(null!==u){var e=o.current.getContext("2d");e.drawImage(u,0,0,n.algorithmSettings.width,n.algorithmSettings.height);var t=e.getImageData(0,0,n.algorithmSettings.width,n.algorithmSettings.height).data;r({type:"setSourceImage",image:Array.from(t)})}},[u,n.algorithmSettings.width,n.algorithmSettings.height,r]);var m=Object(y.a)({accept:"image/*",onDrop:function(e){h(null);var t=new Image;t.onload=function(e){h(t)};var n=e[0],a=new FileReader;a.onload=function(e){e.target.readyState===FileReader.DONE&&(t.src=e.target.result)},a.readAsDataURL(n)},disabled:n.generating||n.running}),k=m.getRootProps,x=m.getInputProps,O=Object(a.useMemo)(function(){return n.generating&&n.running?"Running, iteration: ".concat(n.iteration,". Click an image to save it."):n.generating&&!n.running?"Starting, your browser might freeze for a while...":!n.generating&&n.running?"Stopping...":n.generating||n.running||n.sourceImage?n.generating||n.running?void 0:"Click start":"Click on the empty canvas to select an image or drop an image on it. None of your data is uploaded as everything is running client-side."},[n.generating,n.running,n.sourceImage,n.iteration]);return i.a.createElement(p.a,null,i.a.createElement(v.a,null,i.a.createElement("h1",{style:{textAlign:"center"}},"Deep Image Prior (",i.a.createElement("a",{href:"https://arxiv.org/abs/1711.10925"},"Paper"),")"),i.a.createElement("a",{href:"https://github.com/RobinKa/web-deep-image-prior"},i.a.createElement("h3",{style:{textAlign:"center"}},"Source Code")),i.a.createElement(b.a,null,i.a.createElement(v.a,null,i.a.createElement("div",Object.assign({style:{textAlign:"center"}},k()),i.a.createElement("input",x()),i.a.createElement("canvas",{style:{boxShadow:"0px 0px 5px gray"},ref:o,width:n.algorithmSettings.width,height:n.algorithmSettings.height}))),i.a.createElement(v.a,null,i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement(f.a,{disabled:n.generating||n.running,defaultValue:256,min:0,max:1024,step:32,onChange:function(e){return function(e){r({type:"algorithmSettings",newSettings:Object(l.a)({},n.algorithmSettings,{width:e})})}(e)}}),i.a.createElement("label",null,"Width: ",n.algorithmSettings.width)),i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement(f.a,{disabled:n.generating||n.running,defaultValue:256,min:0,max:1024,step:32,onChange:function(e){return function(e){r({type:"algorithmSettings",newSettings:Object(l.a)({},n.algorithmSettings,{height:e})})}(e)}}),i.a.createElement("label",null,"Height: ",n.algorithmSettings.height)),i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement(f.a,{disabled:n.generating||n.running,defaultValue:5,min:1,max:20,step:1,onChange:function(e){return function(e){r({type:"algorithmSettings",newSettings:Object(l.a)({},n.algorithmSettings,{layers:e})})}(e)}}),i.a.createElement("label",null,"Layers: ",n.algorithmSettings.layers)),i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement(f.a,{disabled:n.generating||n.running,defaultValue:8,min:1,max:256,step:1,onChange:function(e){return function(e){r({type:"algorithmSettings",newSettings:Object(l.a)({},n.algorithmSettings,{filters:e})})}(e)}}),i.a.createElement("label",null,"Filters: ",n.algorithmSettings.filters)),i.a.createElement("p",{style:{fontSize:"20px"}},O),i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement(d,{state:n,dispatchState:r}),i.a.createElement(w.a,{style:{visibility:n.running||n.generating||!n.sourceImage?"hidden":"visible"},onClick:function(){return r({type:"start"})}},"Start"),i.a.createElement(w.a,{style:{visibility:n.running&&n.generating?"visible":"hidden"},onClick:function(){return r({type:"pause"})}},"Stop"),i.a.createElement(w.a,{onClick:function(){return r({type:"reset"})}},"Reset"))))),i.a.createElement(v.a,null,i.a.createElement(E.Carousel,{onClickItem:function(e,t){return R.a.saveAs(n.images[e].uri,"image_iter".concat(n.images[e].iteration,".png"))},selectedItem:n.images.length>0?n.images.length-1:0,showArrows:!0,autoPlay:!1},n.images.map(function(e){return i.a.createElement("div",{key:e.uri},i.a.createElement("img",{src:e.uri,alt:e.uri}),i.a.createElement("p",{className:"legend"},"Iteration ",e.iteration))}))))}),O=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function j(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}o.a.render(i.a.createElement(x,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/deepimageprior",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/deepimageprior","/service-worker.js");O?(function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):j(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):j(t,e)})}}()},90:function(e,t,n){e.exports=n(171)},95:function(e,t,n){},96:function(e,t,n){}},[[90,1,2]]]);
//# sourceMappingURL=main.6db5e7b4.chunk.js.map