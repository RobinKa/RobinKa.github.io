{"version":3,"sources":["kernels/simulation.ts","simulator.ts","sources.ts","components.tsx","serialization.ts","maps.ts","util.ts","kernels/rendering.ts","App.tsx","serviceWorker.ts","index.tsx","icons/fullscreen.png"],"names":["getAt","field","shapeX","shapeY","x","y","makeFieldTexture","value","copyTexture","texture","this","thread","drawOnTexture","pos","size","keep","oldValue","output","Math","max","abs","injectSource","source","dt","gx","gy","decaySource","pow","updateMagneticX","fieldY","fieldZ","permeability","magFieldX","cs","reflectiveBoundary","xAtMinBound","xAtMaxBound","yAtMinBound","yAtMaxBound","updateMagneticY","fieldX","magFieldY","updateMagneticZ","magFieldZ","updateElectricX","permittivity","elFieldX","updateElectricY","elFieldY","updateElectricZ","elFieldZ","memoByName","makeNew","memoized","name","FDTDSimulator","gpu","gridSize","cellSize","data","updateMagnetic","updateElectric","kernels","setGridSize","forEach","kernel","setOutput","dim","electricField","shape","magneticField","values","resetFields","setCellSize","stepElectric","el","map","f","mag","perm","injectedElZ","electricSourceFieldZ","time","stepMagnetic","resetMaterials","drawPermeability","drawPermittivity","injectSignal","loadPermittivity","loadPermeability","getData","makeKernel","runKernel","createKernel","setWarnVarUsage","setPipeline","setTactic","setDynamicOutput","setDynamicArguments","setPrecision","push","makeKernelWithFuncs","setFunctions","k","makeKernelWithFuncsAndConsts","setConstants","makeField","initialValue","i","PointSignalSource","amplitude","frequency","position","turnOffTime","inject","simulator","t","undefined","cos","PI","CollapsibleContainer","props","useState","initiallyCollapsed","collapsed","setCollapsed","id","className","style","textAlign","background","fontWeight","color","onClick","e","width","height","border","cursor","buttonStyle","title","children","LabeledSlider","setValue","allowNegative","logarithmic","displayDigits","absValue","log2","negative","setNegative","rangeSliderRef","useRef","updateValue","useCallback","current","newValue","parseFloat","useEffect","displayValue","toFixed","label","type","checked","onChange","target","ref","min","step","lineHeight","marginBottom","OptionSelector","margin","options","option","optionIndex","buttonClassName","key","backgroundColor","selectedOption","overflow","textOverflow","setSelectedOption","SaveLoadComponent","simulatorMapUrl","setSimulatorMapUrl","onSaveClicked","simData","window","open","materialMap","canvas","document","createElement","ctx","getContext","fillStyle","fillRect","textBaseline","fillText","canvasData","getImageData","round","putImageData","toDataURL","encodeMaterialMap","toArray","onLoadClicked","encodedMaterialMap","targetSize","onLoaded","image","Image","crossOrigin","onload","drawImage","imageData","src","decodeMaterialMap","padding","ExamplesComponent","setGridSizeLongest","setDt","setSimulationSpeed","setSources","loadMap","simulatorMap","loadedSources","sourcesDescriptors","desc","Error","simulationSettings","simulationSpeed","useMemo","_","Array","fill","maps","slitCenterX","isWallRow","permittivityRow","getCurvePoint","sin","endPoint","center","isLensPoint","point","dx","dy","SettingsComponent","gridSizeLongest","resolutionScale","setResolutionScale","setReflectiveBoundary","ControlComponent","showSignal","clickOption","display","signalBrushSize","setSignalBrushSize","signalBrushValue","setSignalBrushValue","signalFrequency","setSignalFrequency","materialBrushSize","setMaterialBrushSize","permittivityBrushValue","setPermittivityBrushValue","permeabilityBrushValue","setPermeabilityBrushValue","setClickOption","toggleFullScreen","fullscreenElement","exitFullscreen","documentElement","requestFullscreen","clamp","drawGpu","electricFieldX","electricFieldY","electricFieldZ","magneticFieldX","magneticFieldY","magneticFieldZ","eAA","magXAA","magYAA","magZAA","mAA","permittivityValue","exp","permeabilityValue","tileFactorX","tileFactorY","backgroundX","backgroundY","drawCpu","fx","fy","gpuMode","GPU","isSinglePrecisionSupported","isWebGL2Supported","isWebGLSupported","getGpuMode","console","log","defaultSignalBrushValue","defaultSignalFrequency","initialDt","initialCellSize","initialGridSizeLongest","initialResolutionScale","initialWindowSize","innerWidth","innerHeight","initialCanvasSize","calculateCanvasSize","initialGridSize","calculateGridSize","windowSize","canvasSize","canvasAspect","ceil","Boolean","location","hostname","match","ReactDOM","render","drawCanvasRef","setCanvasSize","setWindowSize","sources","adjustCanvasSize","wndSize","addEventListener","removeEventListener","setGpu","mode","renderSim","setGraphical","makeRenderSimulatorCanvas","drawingMaterial","setDrawingMaterial","mousePosition","setMousePosition","signalStrength","mouseDownPos","windowToSimulationPoint","windowPoint","floor","simStep","brushHalfSize","timer","setInterval","clearInterval","drawStep","cnvSize","stop","requestAnimationFrame","drawIfNotStopped","changeMaterial","canvasPos","centerX","centerY","onInputDown","clientX","clientY","onInputMove","onInputUp","activeBrushSize","touchAction","userSelect","onMouseDown","onMouseMove","onMouseUp","onMouseLeave","onTouchStart","touches","onTouchMove","onTouchEnd","onTouchCancel","onContextMenu","preventDefault","bottom","right","href","rel","textDecoration","pointerEvents","left","top","Fullscreen","alt","getElementById","navigator","serviceWorker","ready","then","registration","unregister","module","exports"],"mappings":"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","file":"static/js/main.3d8ae440.chunk.js","sourcesContent":["import { IKernelFunctionThis } from \"gpu.js\"\r\n\r\nexport function getAt(field: number[][], shapeX: number, shapeY: number, x: number, y: number) {\r\n    if (x < 0 || x >= shapeX || y < 0 || y >= shapeY) {\r\n        return 0\r\n    }\r\n\r\n    return field[y][x]\r\n}\r\n\r\nexport function makeFieldTexture(this: IKernelFunctionThis, value: number) {\r\n    return value\r\n}\r\n\r\nexport function copyTexture(this: IKernelFunctionThis, texture: number[][]) {\r\n    return texture[this.thread.y!][this.thread.x]\r\n}\r\n\r\nexport function drawOnTexture(this: IKernelFunctionThis, pos: number[], size: number, value: number, keep: number, texture: number[][]) {\r\n    const x = this.thread.x as number\r\n    const y = this.thread.y! as number\r\n    const gx = this.output.x as number\r\n    const gy = this.output.y as number\r\n\r\n    const oldValue = getAt(texture, gx, gy, x, y)\r\n\r\n    const within = Math.max(Math.abs(pos[0] - x), Math.abs(pos[1] - y)) < size\r\n\r\n    return within ? value + keep * oldValue : oldValue\r\n}\r\n\r\nexport function injectSource(this: IKernelFunctionThis, source: number[][], field: number[][], dt: number) {\r\n    const x = this.thread.x as number\r\n    const y = this.thread.y! as number\r\n    const gx = this.output.x as number\r\n    const gy = this.output.y as number\r\n\r\n    return getAt(field, gx, gy, x, y) + getAt(source, gx, gy, x, y) * dt\r\n}\r\n\r\nexport function decaySource(this: IKernelFunctionThis, source: number[][], dt: number) {\r\n    const x = this.thread.x as number\r\n    const y = this.thread.y! as number\r\n    const gx = this.output.x as number\r\n    const gy = this.output.y as number\r\n\r\n    return getAt(source, gx, gy, x, y) * Math.pow(0.1, dt)\r\n}\r\n\r\nexport function updateMagneticX(this: IKernelFunctionThis, fieldY: number[][], fieldZ: number[][], permeability: number[][], magFieldX: number[][], dt: number, cs: number, reflectiveBoundary: boolean) {\r\n    const x = this.thread.x as number\r\n    const y = this.thread.y! as number\r\n    const gx = this.output.x as number\r\n    const gy = this.output.y as number\r\n\r\n    if (!reflectiveBoundary) {\r\n        const xAtMinBound = x < 2 ? 1 : 0\r\n        const xAtMaxBound = x + 2 >= gx ? -1 : 0\r\n        const yAtMinBound = y < 2 ? 1 : 0\r\n        const yAtMaxBound = y + 2 >= gy ? -1 : 0\r\n        if (xAtMinBound !== 0 || xAtMaxBound !== 0 || yAtMinBound !== 0 || yAtMaxBound !== 0) {\r\n            return magFieldX[y + yAtMinBound + yAtMaxBound][x + xAtMinBound + xAtMaxBound]\r\n        }\r\n    }\r\n\r\n    // d_Y Z - d_Z Y\r\n    return getAt(magFieldX, gx, gy, x, y) - (dt / (getAt(permeability, gx, gy, x, y) * cs)) * (\r\n        (getAt(fieldZ, gx, gy, x, y + 1) - getAt(fieldZ, gx, gy, x, y)))\r\n}\r\n\r\nexport function updateMagneticY(this: IKernelFunctionThis, fieldX: number[][], fieldZ: number[][], permeability: number[][], magFieldY: number[][], dt: number, cs: number, reflectiveBoundary: boolean) {\r\n    const x = this.thread.x as number\r\n    const y = this.thread.y! as number\r\n    const gx = this.output.x as number\r\n    const gy = this.output.y as number\r\n\r\n    if (!reflectiveBoundary) {\r\n        const xAtMinBound = x < 2 ? 1 : 0\r\n        const xAtMaxBound = x + 2 >= gx ? -1 : 0\r\n        const yAtMinBound = y < 2 ? 1 : 0\r\n        const yAtMaxBound = y + 2 >= gy ? -1 : 0\r\n        if (xAtMinBound !== 0 || xAtMaxBound !== 0 || yAtMinBound !== 0 || yAtMaxBound !== 0) {\r\n            return magFieldY[y + yAtMinBound + yAtMaxBound][x + xAtMinBound + xAtMaxBound]\r\n        }\r\n    }\r\n\r\n    // d_Z X - d_X Z\r\n    return getAt(magFieldY, gx, gy, x, y) - (dt / (getAt(permeability, gx, gy, x, y) * cs)) * (\r\n        -(getAt(fieldZ, gx, gy, x + 1, y) - getAt(fieldZ, gx, gy, x, y)))\r\n}\r\n\r\nexport function updateMagneticZ(this: IKernelFunctionThis, fieldX: number[][], fieldY: number[][], permeability: number[][], magFieldZ: number[][], dt: number, cs: number, reflectiveBoundary: boolean) {\r\n    const x = this.thread.x as number\r\n    const y = this.thread.y! as number\r\n    const gx = this.output.x as number\r\n    const gy = this.output.y as number\r\n\r\n    if (!reflectiveBoundary) {\r\n        const xAtMinBound = x < 2 ? 1 : 0\r\n        const xAtMaxBound = x + 2 >= gx ? -1 : 0\r\n        const yAtMinBound = y < 2 ? 1 : 0\r\n        const yAtMaxBound = y + 2 >= gy ? -1 : 0\r\n        if (xAtMinBound !== 0 || xAtMaxBound !== 0 || yAtMinBound !== 0 || yAtMaxBound !== 0) {\r\n            return magFieldZ[y + yAtMinBound + yAtMaxBound][x + xAtMinBound + xAtMaxBound]\r\n        }\r\n    }\r\n\r\n    // d_X Y - d_Y X\r\n    return getAt(magFieldZ, gx, gy, x, y) - (dt / (getAt(permeability, gx, gy, x, y) * cs)) * (\r\n        (getAt(fieldY, gx, gy, x + 1, y) - getAt(fieldY, gx, gy, x, y)) -\r\n        (getAt(fieldX, gx, gy, x, y + 1) - getAt(fieldX, gx, gy, x, y)))\r\n}\r\n\r\nexport function updateElectricX(this: IKernelFunctionThis, fieldY: number[][], fieldZ: number[][], permittivity: number[][], elFieldX: number[][], dt: number, cs: number, reflectiveBoundary: boolean) {\r\n    const x = this.thread.x as number\r\n    const y = this.thread.y! as number\r\n    const gx = this.output.x as number\r\n    const gy = this.output.y as number\r\n\r\n    if (!reflectiveBoundary) {\r\n        const xAtMinBound = x < 2 ? 1 : 0\r\n        const xAtMaxBound = x + 2 >= gx ? -1 : 0\r\n        const yAtMinBound = y < 2 ? 1 : 0\r\n        const yAtMaxBound = y + 2 >= gy ? -1 : 0\r\n        if (xAtMinBound !== 0 || xAtMaxBound !== 0 || yAtMinBound !== 0 || yAtMaxBound !== 0) {\r\n            return elFieldX[y + yAtMinBound + yAtMaxBound][x + xAtMinBound + xAtMaxBound]\r\n        }\r\n    }\r\n\r\n    // d_Y Z - d_Z Y\r\n    return getAt(elFieldX, gx, gy, x, y) + (dt / (getAt(permittivity, gx, gy, x, y) * cs)) * (\r\n        (getAt(fieldZ, gx, gy, x, y) - getAt(fieldZ, gx, gy, x, y - 1)))\r\n}\r\n\r\nexport function updateElectricY(this: IKernelFunctionThis, fieldX: number[][], fieldZ: number[][], permittivity: number[][], elFieldY: number[][], dt: number, cs: number, reflectiveBoundary: boolean) {\r\n    const x = this.thread.x as number\r\n    const y = this.thread.y! as number\r\n    const gx = this.output.x as number\r\n    const gy = this.output.y as number\r\n\r\n    if (!reflectiveBoundary) {\r\n        const xAtMinBound = x < 2 ? 1 : 0\r\n        const xAtMaxBound = x + 2 >= gx ? -1 : 0\r\n        const yAtMinBound = y < 2 ? 1 : 0\r\n        const yAtMaxBound = y + 2 >= gy ? -1 : 0\r\n        if (xAtMinBound !== 0 || xAtMaxBound !== 0 || yAtMinBound !== 0 || yAtMaxBound !== 0) {\r\n            return elFieldY[y + yAtMinBound + yAtMaxBound][x + xAtMinBound + xAtMaxBound]\r\n        }\r\n    }\r\n\r\n    // d_Z X - d_X Z\r\n    return getAt(elFieldY, gx, gy, x, y) + (dt / (getAt(permittivity, gx, gy, x, y) * cs)) * (\r\n        -(getAt(fieldZ, gx, gy, x, y) - getAt(fieldZ, gx, gy, x - 1, y)))\r\n}\r\n\r\nexport function updateElectricZ(this: IKernelFunctionThis, fieldX: number[][], fieldY: number[][], permittivity: number[][], elFieldZ: number[][], dt: number, cs: number, reflectiveBoundary: boolean) {\r\n    const x = this.thread.x as number\r\n    const y = this.thread.y! as number\r\n    const gx = this.output.x as number\r\n    const gy = this.output.y as number\r\n\r\n    if (!reflectiveBoundary) {\r\n        const xAtMinBound = x < 2 ? 1 : 0\r\n        const xAtMaxBound = x + 2 >= gx ? -1 : 0\r\n        const yAtMinBound = y < 2 ? 1 : 0\r\n        const yAtMaxBound = y + 2 >= gy ? -1 : 0\r\n        if (xAtMinBound !== 0 || xAtMaxBound !== 0 || yAtMinBound !== 0 || yAtMaxBound !== 0) {\r\n            return elFieldZ[y + yAtMinBound + yAtMaxBound][x + xAtMinBound + xAtMaxBound]\r\n        }\r\n    }\r\n\r\n    // d_X Y - d_Y X\r\n    return getAt(elFieldZ, gx, gy, x, y) + (dt / (getAt(permittivity, gx, gy, x, y) * cs)) * (\r\n        (getAt(fieldY, gx, gy, x, y) - getAt(fieldY, gx, gy, x - 1, y)) -\r\n        (getAt(fieldX, gx, gy, x, y) - getAt(fieldX, gx, gy, x, y - 1)))\r\n}","import { GPU, IKernelRunShortcut, Texture, KernelFunction } from \"gpu.js\"\r\nimport * as k from \"./kernels/simulation\"\r\n\r\nexport type ScalarField2D = {\r\n    values: Texture\r\n    shape: [number, number]\r\n}\r\n\r\nexport type SimulationData = {\r\n    time: number\r\n    electricField: [ScalarField2D, ScalarField2D, ScalarField2D]\r\n    magneticField: [ScalarField2D, ScalarField2D, ScalarField2D]\r\n\r\n    permittivity: ScalarField2D\r\n    permeability: ScalarField2D\r\n\r\n    electricSourceFieldZ: ScalarField2D\r\n}\r\n\r\nexport interface Simulator {\r\n    stepElectric: (dt: number) => void\r\n    stepMagnetic: (dt: number) => void\r\n    resetFields: () => void\r\n    resetMaterials: () => void\r\n    injectSignal: (pos: [number, number], size: number, value: number, dt: number) => void\r\n    getData: () => SimulationData\r\n}\r\n\r\nfunction memoByName<T>(makeNew: () => T) {\r\n    const memoized: { [name: string]: T } = {}\r\n\r\n    return (name: string) => {\r\n        if (!memoized[name]) {\r\n            memoized[name] = makeNew()\r\n        }\r\n        return memoized[name]\r\n    }\r\n}\r\n\r\nexport class FDTDSimulator implements Simulator {\r\n    private data: SimulationData\r\n\r\n    private updateMagnetic: [IKernelRunShortcut, IKernelRunShortcut, IKernelRunShortcut]\r\n    private updateElectric: [IKernelRunShortcut, IKernelRunShortcut, IKernelRunShortcut]\r\n\r\n    private injectSource: IKernelRunShortcut\r\n    private decaySource: IKernelRunShortcut\r\n\r\n    private makeFieldTexture: (name: string) => IKernelRunShortcut\r\n    private copyTexture: (name: string) => IKernelRunShortcut\r\n\r\n    private drawOnTexture: (name: string) => IKernelRunShortcut\r\n\r\n    private kernels: IKernelRunShortcut[] = []\r\n\r\n    constructor(readonly gpu: GPU, private gridSize: [number, number], private cellSize: number, public reflectiveBoundary: boolean) {\r\n        const makeKernel = (kernel: KernelFunction) => {\r\n            const runKernel = this.gpu.createKernel(kernel).setOutput(this.gridSize).setWarnVarUsage(false)\r\n                .setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true).setPrecision(\"single\")\r\n            this.kernels.push(runKernel)\r\n            return runKernel\r\n        }\r\n        const makeKernelWithFuncs = (kernel: KernelFunction) => makeKernel(kernel).setFunctions([k.getAt])\r\n        const makeKernelWithFuncsAndConsts = (kernel: KernelFunction) => makeKernelWithFuncs(kernel).setConstants({ cellSize: cellSize })\r\n\r\n        this.makeFieldTexture = memoByName(() => makeKernel(k.makeFieldTexture))\r\n        this.copyTexture = memoByName(() => makeKernel(k.copyTexture))\r\n\r\n        const makeField = (name: string, initialValue: number): ScalarField2D => { return { values: this.makeFieldTexture(name)(initialValue) as Texture, shape: this.gridSize } }\r\n\r\n        this.data = {\r\n            time: 0,\r\n            electricField: [0, 1, 2].map(i => makeField(`e${i}`, 0)) as [ScalarField2D, ScalarField2D, ScalarField2D],\r\n            magneticField: [0, 1, 2].map(i => makeField(`m${i}`, 0)) as [ScalarField2D, ScalarField2D, ScalarField2D],\r\n            electricSourceFieldZ: makeField(\"es2\", 0),\r\n            permittivity: makeField(\"permittivity\", 1),\r\n            permeability: makeField(\"permeability\", 1)\r\n        }\r\n\r\n        this.drawOnTexture = memoByName(() => makeKernelWithFuncsAndConsts(k.drawOnTexture))\r\n        this.injectSource = makeKernelWithFuncs(k.injectSource)\r\n        this.decaySource = makeKernelWithFuncs(k.decaySource)\r\n\r\n        this.updateMagnetic = [\r\n            makeKernelWithFuncsAndConsts(k.updateMagneticX),\r\n            makeKernelWithFuncsAndConsts(k.updateMagneticY),\r\n            makeKernelWithFuncsAndConsts(k.updateMagneticZ)\r\n        ]\r\n\r\n        this.updateElectric = [\r\n            makeKernelWithFuncsAndConsts(k.updateElectricX),\r\n            makeKernelWithFuncsAndConsts(k.updateElectricY),\r\n            makeKernelWithFuncsAndConsts(k.updateElectricZ)\r\n        ]\r\n    }\r\n\r\n    setGridSize = (gridSize: [number, number]) => {\r\n        this.gridSize = gridSize\r\n\r\n        this.kernels.forEach(kernel => kernel.setOutput(gridSize))\r\n\r\n        for (let dim = 0; dim < 3; dim++) {\r\n            this.data.electricField[dim].shape = gridSize\r\n            this.data.magneticField[dim].shape = gridSize\r\n        }\r\n\r\n        this.data.permittivity.shape = gridSize\r\n        this.data.permeability.shape = gridSize\r\n\r\n        // TODO: Copy only the valid fraction. This one will potentially copy out of bounds.\r\n        this.data.permittivity.values = this.copyTexture(\"permittivity\")(this.data.permittivity.values) as Texture\r\n        this.data.permeability.values = this.copyTexture(\"permeability\")(this.data.permeability.values) as Texture\r\n\r\n        this.resetFields()\r\n    }\r\n\r\n    setCellSize = (cellSize: number) => {\r\n        this.cellSize = cellSize\r\n\r\n        this.resetFields()\r\n    }\r\n\r\n    stepElectric = (dt: number) => {\r\n        const el = this.data.electricField.map(f => f.values)\r\n        const mag = this.data.magneticField.map(f => f.values)\r\n        const perm = this.data.permittivity.values\r\n\r\n        const injectedElZ = this.injectSource(this.data.electricSourceFieldZ.values, el[2], dt) as Texture\r\n        this.data.electricSourceFieldZ.values = this.decaySource(this.copyTexture(\"es2\")(this.data.electricSourceFieldZ.values), dt) as Texture\r\n\r\n        // d/dt E(x, t) = curl B(x, t) / Îµ\r\n        this.data.electricField[0].values = this.updateElectric[0](mag[1], mag[2], perm, this.copyTexture(\"e0\")(el[0]), dt, this.cellSize, this.reflectiveBoundary) as Texture\r\n        this.data.electricField[1].values = this.updateElectric[1](mag[0], mag[2], perm, this.copyTexture(\"e1\")(el[1]), dt, this.cellSize, this.reflectiveBoundary) as Texture\r\n        this.data.electricField[2].values = this.updateElectric[2](mag[0], mag[1], perm, injectedElZ, dt, this.cellSize, this.reflectiveBoundary) as Texture\r\n\r\n        this.data.time += dt / 2\r\n    }\r\n\r\n    stepMagnetic = (dt: number) => {\r\n        const el = this.data.electricField.map(f => f.values)\r\n        const mag = this.data.magneticField.map(f => f.values)\r\n        const perm = this.data.permeability.values\r\n\r\n        // d/dt B(x, t) = -curl E(x, t) / Âµ\r\n        this.data.magneticField[0].values = this.updateMagnetic[0](el[1], el[2], perm, this.copyTexture(\"m0\")(mag[0]), dt, this.cellSize, this.reflectiveBoundary) as Texture\r\n        this.data.magneticField[1].values = this.updateMagnetic[1](el[0], el[2], perm, this.copyTexture(\"m1\")(mag[1]), dt, this.cellSize, this.reflectiveBoundary) as Texture\r\n        this.data.magneticField[2].values = this.updateMagnetic[2](el[0], el[1], perm, this.copyTexture(\"m2\")(mag[2]), dt, this.cellSize, this.reflectiveBoundary) as Texture\r\n\r\n        this.data.time += dt / 2\r\n    }\r\n\r\n    resetFields = () => {\r\n        this.data.time = 0\r\n\r\n        for (let dim = 0; dim < 3; dim++) {\r\n            this.data.electricField[dim].values = this.makeFieldTexture(`e${dim}`)(0) as Texture\r\n            this.data.magneticField[dim].values = this.makeFieldTexture(`m${dim}`)(0) as Texture\r\n        }\r\n\r\n        this.data.electricSourceFieldZ.values = this.makeFieldTexture(\"es2\")(0) as Texture\r\n    }\r\n\r\n    resetMaterials = () => {\r\n        this.data.permeability.values = this.makeFieldTexture(\"permeability\")(1) as Texture\r\n        this.data.permittivity.values = this.makeFieldTexture(\"permittivity\")(1) as Texture\r\n    }\r\n\r\n    drawPermeability = (pos: [number, number, number], size: number, value: number) => {\r\n        this.data.permeability.values = this.drawOnTexture(\"permeability\")(pos, size, value, 0, this.copyTexture(\"permability\")(this.data.permeability.values)) as Texture\r\n    }\r\n\r\n    drawPermittivity = (pos: [number, number, number], size: number, value: number) => {\r\n        this.data.permittivity.values = this.drawOnTexture(\"permittivity\")(pos, size, value, 0, this.copyTexture(\"permittivity\")(this.data.permittivity.values)) as Texture\r\n    }\r\n\r\n    injectSignal = (pos: [number, number], size: number, value: number, dt: number) => {\r\n        this.data.electricSourceFieldZ.values = this.drawOnTexture(\"es2\")(pos, size, value * dt, 1, this.copyTexture(\"es2\")(this.data.electricSourceFieldZ.values)) as Texture\r\n    }\r\n\r\n    loadPermittivity = (permittivity: number[][]) => {\r\n        this.data.permittivity.values = this.copyTexture(\"loadPermittivity\")(permittivity) as Texture\r\n    }\r\n\r\n    loadPermeability = (permeability: number[][]) => {\r\n        this.data.permeability.values = this.copyTexture(\"loadPermeability\")(permeability) as Texture\r\n    }\r\n\r\n    getData = () => this.data\r\n}","import { Simulator } from \"./simulator\"\r\n\r\nexport interface SignalSource {\r\n    inject(simulator: Simulator, dt: number): void\r\n}\r\n\r\nexport class PointSignalSource implements SignalSource {\r\n    constructor(public amplitude: number, public frequency: number, public position: [number, number], public turnOffTime?: number) {\r\n\r\n    }\r\n\r\n    inject = (simulator: Simulator, dt: number) => {\r\n        const t = simulator.getData().time\r\n        if (t >= 0 && (this.turnOffTime === undefined || t <= this.turnOffTime)) {\r\n            const amplitude = -this.amplitude * Math.cos(2 * Math.PI * this.frequency * t)\r\n            simulator.injectSignal(this.position, 1, amplitude, dt)\r\n        }\r\n    }\r\n}\r\n\r\n","import React, { ReactElement, useState, useCallback, useMemo, useRef, useEffect } from \"react\"\r\nimport { encodeMaterialMap, decodeMaterialMap, SimulatorMap, SimulationSettings } from \"./serialization\"\r\nimport { FDTDSimulator } from \"./simulator\"\r\nimport { SignalSource, PointSignalSource } from \"./sources\"\r\nimport * as maps from \"./maps\"\r\n\r\nexport type CollapsibleContainerProps = {\r\n    children: ReactElement<any> | ReactElement<any>[] | null\r\n    id?: string\r\n    className?: string\r\n    style?: React.CSSProperties\r\n    buttonStyle?: React.CSSProperties\r\n    title?: string\r\n    initiallyCollapsed?: boolean\r\n}\r\n\r\nexport function CollapsibleContainer(props: CollapsibleContainerProps) {\r\n    const [collapsed, setCollapsed] = useState(props.initiallyCollapsed !== undefined ? props.initiallyCollapsed : false)\r\n\r\n    return (\r\n        <div id={props.id} className={props.className} style={{ textAlign: \"center\", background: \"rgb(33, 33, 33)\", fontWeight: \"lighter\", color: \"white\", ...props.style }}>\r\n            <button onClick={e => setCollapsed(!collapsed)} style={{ width: \"100%\", height: \"24px\", background: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", fontWeight: \"bold\", cursor: \"pointer\", ...props.buttonStyle }}>\r\n                {props.title ? `${props.title} ` : \"\"}[{collapsed ? \"+\" : \"-\"}]\r\n            </button>\r\n            {!collapsed && props.children}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type LabeledSliderProps = {\r\n    label: string\r\n    value: number,\r\n    setValue: (value: number) => void\r\n    min: number\r\n    max: number\r\n    step: number\r\n    allowNegative?: boolean\r\n    logarithmic?: boolean\r\n    displayDigits?: number\r\n}\r\n\r\nexport function LabeledSlider(props: LabeledSliderProps) {\r\n    const { value, setValue, allowNegative, logarithmic, displayDigits } = props\r\n    const absValue = logarithmic ? Math.log2(Math.abs(value)) : Math.abs(value)\r\n\r\n    const [negative, setNegative] = useState(value < 0)\r\n\r\n    const rangeSliderRef = useRef<HTMLInputElement>(null)\r\n\r\n    const updateValue = useCallback(() => {\r\n        if (rangeSliderRef.current) {\r\n            let newValue = parseFloat(rangeSliderRef.current.value)\r\n            if (logarithmic) {\r\n                newValue = Math.pow(2, newValue)\r\n            }\r\n\r\n            setValue((negative ? -1 : 1) * newValue)\r\n        }\r\n    }, [setValue, negative, logarithmic, rangeSliderRef])\r\n\r\n    useEffect(() => updateValue(), [negative, updateValue])\r\n\r\n    const displayValue = (displayDigits !== undefined) ? value.toFixed(displayDigits) : value\r\n\r\n    return (\r\n        <div>\r\n            <label>{props.label}</label>\r\n            <div>\r\n                {allowNegative && <>\r\n                    <input type=\"checkbox\" checked={negative} onChange={e => setNegative(e.target.checked)} /><label>Negative</label>\r\n                </>}\r\n                <input type=\"range\" ref={rangeSliderRef} min={props.min} max={props.max} value={absValue} step={props.step}\r\n                    onChange={updateValue} style={{ height: 10, width: \"100%\" }} />\r\n                <div style={{ textAlign: \"center\", lineHeight: 0.2, marginBottom: \"7px\" }}>\r\n                    {displayValue}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type OptionSelectorProps = {\r\n    options: string[]\r\n    selectedOption: number\r\n    setSelectedOption: (selectedOption: number) => void\r\n    buttonClassName?: string\r\n}\r\n\r\nexport function OptionSelector(props: OptionSelectorProps) {\r\n    return (\r\n        <div style={{ margin: \"10px\" }}>\r\n            {props.options.map((option, optionIndex) =>\r\n                <button className={props.buttonClassName} key={option} style={{\r\n                    backgroundColor: \"rgb(50, 50, 50)\",\r\n                    color: \"white\",\r\n                    border: optionIndex === props.selectedOption ? \"3px solid rgb(0, 150, 255)\" : \"0\",\r\n                    height: \"30px\",\r\n                    width: \"70px\",\r\n                    overflow: \"hidden\",\r\n                    textOverflow: \"hidden\"\r\n                }}\r\n                    onClick={e => props.setSelectedOption(optionIndex)}>\r\n                    {option}\r\n                </button>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type SaveLoadComponentProps = {\r\n    simulator: FDTDSimulator | null\r\n    gridSize: [number, number]\r\n}\r\n\r\nexport function SaveLoadComponent(props: SaveLoadComponentProps) {\r\n    const simulator = props.simulator\r\n    const gridSize = props.gridSize\r\n    const [simulatorMapUrl, setSimulatorMapUrl] = useState(\"\")\r\n\r\n    const onSaveClicked = useCallback(() => {\r\n        if (simulator) {\r\n            const simData = simulator.getData()\r\n\r\n            window.open(encodeMaterialMap({\r\n                permittivity: simData.permittivity.values.toArray() as number[][],\r\n                permeability: simData.permeability.values.toArray() as number[][],\r\n                shape: [simData.permeability.shape[0], simData.permeability.shape[1]]\r\n            }))\r\n        }\r\n    }, [simulator])\r\n\r\n    const onLoadClicked = useCallback(() => {\r\n        if (simulator) {\r\n            decodeMaterialMap(simulatorMapUrl, [gridSize[0], gridSize[1]], map => {\r\n                if (simulator) {\r\n                    simulator.loadPermeability(map.permeability)\r\n                    simulator.loadPermittivity(map.permittivity)\r\n                }\r\n            })\r\n        }\r\n    }, [simulator, gridSize, simulatorMapUrl])\r\n\r\n    return (\r\n        <div style={{ padding: \"10px\" }}>\r\n            <div>\r\n                <button onClick={onSaveClicked} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Save map</button>\r\n            </div>\r\n            <div>\r\n                <input type=\"text\" onChange={e => setSimulatorMapUrl(e.target.value)} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", margin: \"2px\" }} />\r\n                <button onClick={onLoadClicked} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Load map url</button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type ExamplesComponentProps = {\r\n    simulator: FDTDSimulator | null\r\n\r\n    dt: number\r\n    simulationSpeed: number\r\n    cellSize: number\r\n    gridSize: [number, number]\r\n\r\n    setGridSizeLongest: (gridSizeLongest: number) => void\r\n    setDt: (dt: number) => void\r\n    setCellSize: (cellSize: number) => void\r\n    setSimulationSpeed: (simulationSpeed: number) => void\r\n    setSources: (sources: SignalSource[]) => void\r\n}\r\n\r\nexport function ExamplesComponent(props: ExamplesComponentProps) {\r\n    const { simulator, setGridSizeLongest, setDt, setCellSize, setSimulationSpeed, setSources } = props\r\n\r\n    const loadMap = useCallback((simulatorMap: SimulatorMap) => {\r\n        if (simulator) {\r\n            simulator.resetFields()\r\n            simulator.loadPermeability(simulatorMap.materialMap.permeability)\r\n            simulator.loadPermittivity(simulatorMap.materialMap.permittivity)\r\n        }\r\n\r\n        const loadedSources = simulatorMap.sourcesDescriptors.map(desc => {\r\n            if (desc.type === \"point\") {\r\n                return new PointSignalSource(desc.amplitude, desc.frequency, desc.position, desc.turnOffTime)\r\n            }\r\n\r\n            throw new Error(`Unsupported source type: ${desc.type}`)\r\n        })\r\n\r\n        setCellSize(simulatorMap.simulationSettings.cellSize)\r\n        setDt(simulatorMap.simulationSettings.dt)\r\n        setSimulationSpeed(simulatorMap.simulationSettings.simulationSpeed)\r\n        setGridSizeLongest(Math.max(simulatorMap.simulationSettings.gridSize[0], simulatorMap.simulationSettings.gridSize[1]))\r\n        setSources(loadedSources)\r\n    }, [simulator, setCellSize, setDt, setSimulationSpeed, setGridSizeLongest, setSources])\r\n\r\n    const simulationSettings = useMemo<SimulationSettings>(() => {\r\n        return {\r\n            dt: props.dt,\r\n            cellSize: props.cellSize,\r\n            gridSize: props.gridSize,\r\n            simulationSpeed: props.simulationSpeed\r\n        }\r\n    }, [props.dt, props.cellSize, props.gridSize, props.simulationSpeed])\r\n\r\n    return (\r\n        <div style={{ padding: \"10px\" }}>\r\n            <button onClick={_ => loadMap(maps.empty(simulationSettings))} style={{ backgroundColor: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Empty</button>\r\n            <button onClick={_ => loadMap(maps.doubleSlit(simulationSettings))} style={{ backgroundColor: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Double slit</button>\r\n            <button onClick={_ => loadMap(maps.fiberOptics(simulationSettings))} style={{ backgroundColor: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Fiber optics</button>\r\n            <button onClick={_ => loadMap(maps.lens(simulationSettings))} style={{ backgroundColor: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Lens</button>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type SettingsComponentProps = {\r\n    gridSizeLongest: number\r\n    setGridSizeLongest: (gridSizeLongest: number) => void\r\n\r\n    dt: number\r\n    setDt: (dt: number) => void\r\n\r\n    cellSize: number\r\n    setCellSize: (cellSize: number) => void\r\n\r\n    resolutionScale: number\r\n    setResolutionScale: (resolutionScale: number) => void\r\n\r\n    simulationSpeed: number\r\n    setSimulationSpeed: (simulationSpeed: number) => void\r\n\r\n    reflectiveBoundary: boolean\r\n    setReflectiveBoundary: (reflectiveBoundary: boolean) => void\r\n}\r\n\r\nexport function SettingsComponent(props: SettingsComponentProps) {\r\n    return (\r\n        <div style={{ padding: \"10px\" }}>\r\n            <LabeledSlider label=\"Grid length\" value={props.gridSizeLongest} setValue={props.setGridSizeLongest} min={100} max={2000} step={100} />\r\n            <LabeledSlider label=\"Time step size\" value={props.dt} setValue={props.setDt} min={0.001} max={0.1} step={0.001} allowNegative={true} />\r\n            <LabeledSlider label=\"Cell size\" value={props.cellSize} setValue={props.setCellSize} min={0.002} max={0.2} step={0.001} />\r\n            <LabeledSlider label=\"Resolution scale\" value={props.resolutionScale} setValue={props.setResolutionScale} min={0.1} max={2} step={0.1} />\r\n            <LabeledSlider label=\"Simulation speed\" value={props.simulationSpeed} setValue={props.setSimulationSpeed} min={0} max={10} step={0.1} />\r\n            <input type=\"checkbox\" checked={props.reflectiveBoundary} onChange={e => props.setReflectiveBoundary(e.target.checked)} />Reflective boundary\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type ControlComponentProps = {\r\n    signalBrushSize: number,\r\n    setSignalBrushSize: (brushSize: number) => void\r\n\r\n    signalBrushValue: number\r\n    setSignalBrushValue: (brushValue: number) => void\r\n\r\n    materialBrushSize: number,\r\n    setMaterialBrushSize: (brushSize: number) => void\r\n\r\n    permeabilityBrushValue: number\r\n    setPermeabilityBrushValue: (brushValue: number) => void\r\n\r\n    permittivityBrushValue: number\r\n    setPermittivityBrushValue: (brushValue: number) => void\r\n\r\n    signalFrequency: number,\r\n    setSignalFrequency: (signalFrequency: number) => void\r\n\r\n    clickOption: number\r\n    setClickOption: (clickOption: number) => void\r\n\r\n    resetFields: () => void\r\n    resetMaterials: () => void\r\n}\r\n\r\nexport function ControlComponent(props: ControlComponentProps) {\r\n    const showSignal = props.clickOption === 1\r\n\r\n    return (\r\n        <div style={{ padding: \"10px\" }}>\r\n            <div style={{ display: showSignal ? undefined : \"none\" }}>\r\n                <LabeledSlider label=\"Brush size\" value={props.signalBrushSize} setValue={props.setSignalBrushSize} min={1} max={100} step={1} />\r\n                <LabeledSlider label=\"Signal amplitude\" value={props.signalBrushValue} setValue={props.setSignalBrushValue} min={1} max={500} step={1} />\r\n                <LabeledSlider label=\"Signal frequency\" value={props.signalFrequency} setValue={props.setSignalFrequency} min={0} max={25} step={0.25} />\r\n            </div>\r\n            <div style={{ display: !showSignal ? undefined : \"none\" }}>\r\n                <LabeledSlider label=\"Brush size\" value={props.materialBrushSize} setValue={props.setMaterialBrushSize} min={1} max={100} step={1} />\r\n                <LabeledSlider label=\"Îµ value\" value={props.permittivityBrushValue} setValue={props.setPermittivityBrushValue} min={-1} max={10} step={0.1} allowNegative={true} logarithmic={true} displayDigits={1} />\r\n                <LabeledSlider label=\"Âµ value\" value={props.permeabilityBrushValue} setValue={props.setPermeabilityBrushValue} min={-1} max={10} step={0.1} allowNegative={true} logarithmic={true} displayDigits={1} />\r\n            </div>\r\n            <OptionSelector options={[\"Material\", \"Signal\"]} selectedOption={props.clickOption} setSelectedOption={props.setClickOption} />\r\n            <div>\r\n                <button onClick={props.resetFields} style={{ backgroundColor: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", margin: \"2px\", width: \"130px\" }}>Reset fields</button>\r\n                <button onClick={props.resetMaterials} style={{ backgroundColor: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", margin: \"2px\", width: \"130px\" }}>Reset materials</button>\r\n            </div>\r\n        </div>\r\n    )\r\n}","export type SimulationSettings = {\r\n    dt: number\r\n    gridSize: [number, number]\r\n    simulationSpeed: number\r\n    cellSize: number\r\n}\r\n\r\nexport type MaterialMap = {\r\n    permittivity: number[][]\r\n    permeability: number[][]\r\n    shape: [number, number]\r\n}\r\n\r\nexport type EncodedMaterialMap = string\r\n\r\nexport type SourceDescriptor = {\r\n    type: \"point\"\r\n    position: [number, number]\r\n    amplitude: number\r\n    frequency: number\r\n    turnOffTime?: number\r\n}\r\n\r\nexport type SimulatorMap = {\r\n    materialMap: MaterialMap\r\n    simulationSettings: SimulationSettings\r\n    sourcesDescriptors: SourceDescriptor[]\r\n}\r\n\r\nexport function encodeMaterialMap(materialMap: MaterialMap): string {\r\n    const canvas = document.createElement(\"canvas\")\r\n    canvas.width = materialMap.shape[0]\r\n    canvas.height = materialMap.shape[1]\r\n\r\n    const permeability = materialMap.permeability\r\n    const permittivity = materialMap.permittivity\r\n\r\n    const ctx = canvas.getContext(\"2d\")!\r\n\r\n    ctx.fillStyle = \"rgb(1, 0, 1)\"\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height)\r\n\r\n    ctx.fillStyle = \"rgb(0, 255, 0)\"\r\n    ctx.textAlign = \"center\"\r\n    ctx.textBaseline = \"middle\"\r\n    ctx.fillText(\"warlock.ai/maxwell\", canvas.width / 2, canvas.height / 2)\r\n\r\n    const canvasData = ctx.getImageData(0, 0, canvas.width, canvas.height)\r\n\r\n    for (let x = 0; x < canvas.width; x++) {\r\n        for (let y = 0; y < canvas.height; y++) {\r\n            canvasData.data[x * 4 + y * canvas.width * 4 + 0] = Math.round(permittivity[y][x]) // r\r\n            canvasData.data[x * 4 + y * canvas.width * 4 + 2] = Math.round(permeability[y][x]) // b\r\n            canvasData.data[x * 4 + y * canvas.width * 4 + 3] = 255 // a\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(canvasData, 0, 0)\r\n\r\n    return canvas.toDataURL(\"image/png\")\r\n}\r\n\r\nexport function decodeMaterialMap(encodedMaterialMap: EncodedMaterialMap, targetSize: [number, number], onLoaded: (materialMap: MaterialMap) => void) {\r\n    const canvas = document.createElement(\"canvas\")\r\n    canvas.width = targetSize[0]\r\n    canvas.height = targetSize[1]\r\n    const image = new Image()\r\n    image.crossOrigin = \"anonymous\"\r\n    image.onload = e => {\r\n        const ctx = canvas.getContext(\"2d\")!\r\n\r\n        ctx.fillStyle = \"rgb(1, 0, 1)\"\r\n        ctx.fillRect(0, 0, canvas.width, canvas.height)\r\n\r\n        ctx.drawImage(image, 0, 0, image.width, image.height)\r\n\r\n        const materialMap: MaterialMap = { permeability: [], permittivity: [], shape: targetSize }\r\n\r\n        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data\r\n        for (let y = 0; y < targetSize[1]; y++) {\r\n            materialMap.permittivity.push([])\r\n            materialMap.permeability.push([])\r\n            for (let x = 0; x < targetSize[0]; x++) {\r\n                materialMap.permittivity[y].push(Math.max(1, imageData[x * 4 + y * targetSize[0] * 4 + 0]))\r\n                materialMap.permeability[y].push(Math.max(1, imageData[x * 4 + y * targetSize[0] * 4 + 2]))\r\n            }\r\n        }\r\n\r\n        onLoaded(materialMap)\r\n    }\r\n    image.src = encodedMaterialMap\r\n}","import { SimulatorMap, MaterialMap, SourceDescriptor, SimulationSettings } from \"./serialization\"\r\n\r\nexport function empty(simulationSettings: SimulationSettings): SimulatorMap {\r\n    const materialMap: MaterialMap = {\r\n        permittivity: [],\r\n        permeability: [],\r\n        shape: simulationSettings.gridSize\r\n    }\r\n\r\n    for (let y = 0; y < simulationSettings.gridSize[1]; y++) {\r\n        materialMap.permittivity.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n        materialMap.permeability.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n    }\r\n\r\n    const sourceDescriptors: SourceDescriptor[] = []\r\n\r\n    return {\r\n        sourcesDescriptors: sourceDescriptors,\r\n        simulationSettings: simulationSettings,\r\n        materialMap: materialMap\r\n    }\r\n}\r\n\r\nexport function doubleSlit(simulationSettings: SimulationSettings): SimulatorMap {\r\n    const materialMap: MaterialMap = {\r\n        permittivity: [],\r\n        permeability: [],\r\n        shape: simulationSettings.gridSize\r\n    }\r\n\r\n    const slitCenterX = Math.round(0.75 * simulationSettings.gridSize[0])\r\n\r\n    for (let y = 0; y < simulationSettings.gridSize[1]; y++) {\r\n        const isWallRow = Math.abs(y - simulationSettings.gridSize[1] / 5) < 2\r\n        const permittivityRow = new Array(simulationSettings.gridSize[0]).fill(isWallRow ? 100 : 1)\r\n\r\n        if (isWallRow) {\r\n            for (let x = slitCenterX - 20; x < slitCenterX - 10; x++) {\r\n                permittivityRow[x] = 1\r\n            }\r\n\r\n            for (let x = slitCenterX + 20; x > slitCenterX + 10; x--) {\r\n                permittivityRow[x] = 1\r\n            }\r\n        }\r\n\r\n        materialMap.permittivity.push(permittivityRow)\r\n        materialMap.permeability.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n    }\r\n\r\n    const sourceDescriptors: SourceDescriptor[] = [{\r\n        type: \"point\",\r\n        amplitude: 150000,\r\n        frequency: 3,\r\n        position: [Math.round(slitCenterX), Math.round(simulationSettings.gridSize[1] / 15)]\r\n    }]\r\n\r\n    return {\r\n        sourcesDescriptors: sourceDescriptors,\r\n        simulationSettings: simulationSettings,\r\n        materialMap: materialMap\r\n    }\r\n}\r\n\r\nexport function fiberOptics(simulationSettings: SimulationSettings): SimulatorMap {\r\n    const materialMap: MaterialMap = {\r\n        permittivity: [],\r\n        permeability: [],\r\n        shape: simulationSettings.gridSize\r\n    }\r\n\r\n    for (let y = 0; y < simulationSettings.gridSize[1]; y++) {\r\n        materialMap.permittivity.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n        materialMap.permeability.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n    }\r\n\r\n    function getCurvePoint(t: number): [number, number] {\r\n        return [\r\n            Math.round(simulationSettings.gridSize[0] * 3 / 4 + simulationSettings.gridSize[0] / 5 * 0.5 / (2 * t + 1) * -Math.sin(2 * Math.PI * t)),\r\n            Math.round(simulationSettings.gridSize[1] * (1 / 10 + t * (1 - 2 / 10)))\r\n        ]\r\n    }\r\n\r\n    const numPoints = 100\r\n    const thickness = 2\r\n    for (let t = 0; t < numPoints; t++) {\r\n        const pos = getCurvePoint(t / numPoints)\r\n\r\n        for (let x = -thickness + pos[0]; x < thickness + pos[0]; x++) {\r\n            for (let y = -thickness + pos[1]; y < thickness + pos[1]; y++) {\r\n                if (x >= 0 && y >= 0 && x < simulationSettings.gridSize[0] && y < simulationSettings.gridSize[1]) {\r\n                    materialMap.permittivity[y][x] = 2\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    const endPoint = getCurvePoint(1)\r\n\r\n    const sourceDescriptors: SourceDescriptor[] = [{\r\n        type: \"point\",\r\n        amplitude: 40000,\r\n        frequency: 5,\r\n        position: [endPoint[0] - 1, endPoint[1]],\r\n        turnOffTime: 0.5\r\n    }, {\r\n        type: \"point\",\r\n        amplitude: 40000,\r\n        frequency: 5,\r\n        position: [endPoint[0] + 2, endPoint[1]],\r\n        turnOffTime: 0.5\r\n    },]\r\n\r\n    return {\r\n        sourcesDescriptors: sourceDescriptors,\r\n        simulationSettings: simulationSettings,\r\n        materialMap: materialMap\r\n    }\r\n}\r\n\r\nexport function lens(simulationSettings: SimulationSettings): SimulatorMap {\r\n    const materialMap: MaterialMap = {\r\n        permittivity: [],\r\n        permeability: [],\r\n        shape: simulationSettings.gridSize\r\n    }\r\n\r\n    const center = [simulationSettings.gridSize[0] * 0.6, simulationSettings.gridSize[1] / 2]\r\n\r\n    function isLensPoint(point: [number, number]) {\r\n        const dx = point[0] - center[0]\r\n        const dy = point[1] - center[1]\r\n\r\n        return 4 * dx * dx + dy * dy < simulationSettings.gridSize[0] * simulationSettings.gridSize[0] / (10 * 10)\r\n    }\r\n\r\n    for (let y = 0; y < simulationSettings.gridSize[1]; y++) {\r\n        materialMap.permittivity.push([])\r\n        materialMap.permeability.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n        for (let x = 0; x < simulationSettings.gridSize[0]; x++) {\r\n            materialMap.permittivity[y].push(isLensPoint([x, y]) ? 3 : 1)\r\n        }\r\n    }\r\n\r\n    const sourceDescriptors: SourceDescriptor[] = [{\r\n        type: \"point\",\r\n        amplitude: 100000,\r\n        frequency: 2,\r\n        position: [Math.round(simulationSettings.gridSize[0] / 10), Math.round(simulationSettings.gridSize[1] / 2)],\r\n        turnOffTime: 0.5\r\n    }]\r\n\r\n    return {\r\n        sourcesDescriptors: sourceDescriptors,\r\n        simulationSettings: simulationSettings,\r\n        materialMap: materialMap\r\n    }\r\n}","export function toggleFullScreen() {\r\n    if (!document.fullscreenElement) {\r\n        document.documentElement.requestFullscreen()\r\n    } else if (document.exitFullscreen) {\r\n        document.exitFullscreen()\r\n    }\r\n}\r\n\r\nexport function clamp(min: number, max: number, value: number) {\r\n    return Math.max(min, Math.min(max, value))\r\n}","import { IKernelFunctionThis } from \"gpu.js\"\r\n\r\nexport function getAt(field: number[][], shapeX: number, shapeY: number, x: number, y: number) {\r\n    if (x < 0 || x >= shapeX || y < 0 || y >= shapeY) {\r\n        return 0\r\n    }\r\n\r\n    return field[y][x]\r\n}\r\n\r\nexport function drawGpu(this: IKernelFunctionThis, electricFieldX: number[][], electricFieldY: number[][], electricFieldZ: number[][],\r\n    magneticFieldX: number[][], magneticFieldY: number[][], magneticFieldZ: number[][],\r\n    permittivity: number[][], permeability: number[][], gridSize: number[]) {\r\n    const gx = gridSize[0]\r\n    const gy = gridSize[1]\r\n\r\n    const x = gx * this.thread.x! / (this.output.x as number)\r\n    const y = gy * (1 - this.thread.y! / (this.output.y as number))\r\n\r\n    const eAA =\r\n        getAt(electricFieldX, gx, gy, x, y) * getAt(electricFieldX, gx, gy, x, y) +\r\n        getAt(electricFieldY, gx, gy, x, y) * getAt(electricFieldY, gx, gy, x, y) +\r\n        getAt(electricFieldZ, gx, gy, x, y) * getAt(electricFieldZ, gx, gy, x, y)\r\n\r\n    // Magnetic field is offset from electric field, so get value at +0.5 by interpolating 0 and 1\r\n    const magXAA = getAt(magneticFieldX, gx, gy, x - 0.5, y - 0.5)\r\n    const magYAA = getAt(magneticFieldY, gx, gy, x - 0.5, y - 0.5)\r\n    const magZAA = getAt(magneticFieldZ, gx, gy, x - 0.5, y - 0.5)\r\n\r\n    const mAA = magXAA * magXAA + magYAA * magYAA + magZAA * magZAA\r\n\r\n    // Material constants are between 1 and 100, map to [0, 1] using tanh(0.5 * x)\r\n    const permittivityValue = (2 / (1 + Math.exp(-0.4 * (getAt(permittivity, gx, gy, x, y)))) - 1)\r\n    const permeabilityValue = (2 / (1 + Math.exp(-0.4 * (getAt(permeability, gx, gy, x, y)))) - 1)\r\n\r\n    const tileFactorX = Math.max(1, gridSize[0] / this.output.x)\r\n    const tileFactorY = Math.max(1, gridSize[1] / this.output.y!)\r\n\r\n    const backgroundX = (Math.abs((tileFactorX * x) % 1 - 0.5) < 0.25 ? 1 : 0) * (Math.abs((tileFactorY * y) % 1 - 0.5) < 0.25 ? 1 : 0)\r\n    const backgroundY = 1 - backgroundX\r\n\r\n    const scale = 15\r\n    this.color(\r\n        Math.min(1, eAA / scale + 0.8 * backgroundX * permittivityValue),\r\n        Math.min(1, eAA / scale + mAA / scale),\r\n        Math.min(1, mAA / scale + 0.8 * backgroundY * permeabilityValue))\r\n}\r\n\r\n// On CPU we can't use float indices so round the coordinates\r\nexport function drawCpu(this: IKernelFunctionThis, electricFieldX: number[][], electricFieldY: number[][], electricFieldZ: number[][],\r\n    magneticFieldX: number[][], magneticFieldY: number[][], magneticFieldZ: number[][],\r\n    permittivity: number[][], permeability: number[][], gridSize: number[]) {\r\n    const gx = gridSize[0]\r\n    const gy = gridSize[1]\r\n\r\n    const fx = gx * this.thread.x! / (this.output.x as number)\r\n    const fy = gy * (1 - this.thread.y! / (this.output.y as number))\r\n    const x = Math.round(fx)\r\n    const y = Math.round(fy)\r\n\r\n    const eAA =\r\n        getAt(electricFieldX, gx, gy, x, y) * getAt(electricFieldX, gx, gy, x, y) +\r\n        getAt(electricFieldY, gx, gy, x, y) * getAt(electricFieldY, gx, gy, x, y) +\r\n        getAt(electricFieldZ, gx, gy, x, y) * getAt(electricFieldZ, gx, gy, x, y)\r\n\r\n    // Magnetic field is offset from electric field, so get value at +0.5 by interpolating 0 and 1\r\n    const magXAA = getAt(magneticFieldX, gx, gy, x, y)\r\n    const magYAA = getAt(magneticFieldY, gx, gy, x, y)\r\n    const magZAA = getAt(magneticFieldZ, gx, gy, x, y)\r\n\r\n    const mAA = magXAA * magXAA + magYAA * magYAA + magZAA * magZAA\r\n\r\n    // Material constants are between 1 and 100, map to [0, 1] using tanh(0.5 * x)\r\n    const permittivityValue = (2 / (1 + Math.exp(-0.4 * (getAt(permittivity, gx, gy, x, y)))) - 1)\r\n    const permeabilityValue = (2 / (1 + Math.exp(-0.4 * (getAt(permeability, gx, gy, x, y)))) - 1)\r\n\r\n    const tileFactorX = Math.max(1, gridSize[0] / this.output.x)\r\n    const tileFactorY = Math.max(1, gridSize[1] / this.output.y!)\r\n\r\n    const backgroundX = (Math.abs((tileFactorX * fx) % 1 - 0.5) < 0.25 ? 1 : 0) * (Math.abs((tileFactorY * fy) % 1 - 0.5) < 0.25 ? 1 : 0)\r\n    const backgroundY = 1 - backgroundX\r\n\r\n    const scale = 15\r\n    this.color(\r\n        Math.min(1, eAA / scale + 0.8 * backgroundX * permittivityValue),\r\n        Math.min(1, eAA / scale + mAA / scale),\r\n        Math.min(1, mAA / scale + 0.8 * backgroundY * permeabilityValue))\r\n}","import React, { useRef, useCallback, useEffect, useState, useMemo } from 'react'\nimport { GPU, GPUMode, GPUInternalMode } from \"gpu.js\"\nimport { FDTDSimulator } from \"./simulator\"\nimport { CollapsibleContainer, ControlComponent, SaveLoadComponent, SettingsComponent, ExamplesComponent } from './components'\nimport { toggleFullScreen, clamp } from './util'\nimport Fullscreen from \"./icons/fullscreen.png\"\nimport \"./App.css\"\nimport { SignalSource } from './sources'\nimport * as k from './kernels/rendering'\n\nfunction getGpuMode(): GPUMode | GPUInternalMode {\n    if (GPU.isSinglePrecisionSupported) {\n        if (GPU.isWebGL2Supported) {\n            return \"webgl2\"\n        } else if (GPU.isWebGLSupported) {\n            return \"webgl\"\n        }\n    }\n\n    return \"cpu\"\n}\n\nconst gpuMode = getGpuMode()\nconsole.log(`Using GPU mode ${gpuMode}`)\n\nconst defaultSignalBrushValue = gpuMode === \"cpu\" ? 5 : 50\nconst defaultSignalBrushSize = 1\nconst defaultSignalFrequency = gpuMode === \"cpu\" ? 1 : 3\nconst defaultPermittivityBrushValue = 5\nconst defaultPermeabilityBrushValue = 1\nconst defaultMaterialBrushSize = 5\n\nconst initialDt = gpuMode === \"cpu\" ? 0.026 : 0.013\nconst initialCellSize = gpuMode === \"cpu\" ? 0.04 : 0.02\nconst initialSimulationSpeed = 1\nconst initialGridSizeLongest = gpuMode === \"cpu\" ? 200 : 400\nconst initialResolutionScale = gpuMode === \"cpu\" ? 0.3 : 1\nconst initialWindowSize: [number, number] = [window.innerWidth, window.innerHeight]\nconst initialCanvasSize: [number, number] = calculateCanvasSize(initialWindowSize, initialResolutionScale)\nconst initialGridSize: [number, number] = calculateGridSize(initialGridSizeLongest, initialCanvasSize)\nconst initialReflectiveBoundary = false\n\nfunction calculateCanvasSize(windowSize: [number, number], resolutionScale: number): [number, number] {\n    return [Math.round(windowSize[0] * resolutionScale), Math.round(windowSize[1] * resolutionScale)]\n}\n\nfunction calculateGridSize(gridSizeLongest: number, canvasSize: [number, number]): [number, number] {\n    const canvasAspect = canvasSize[0] / canvasSize[1]\n\n    return canvasSize[0] >= canvasSize[1] ?\n        [gridSizeLongest, Math.ceil(gridSizeLongest / canvasAspect)] :\n        [Math.ceil(gridSizeLongest * canvasAspect), gridSizeLongest]\n}\n\nconst makeRenderSimulatorCanvas = (gpu: GPU, canvasSize: [number, number]) => {\n    const kernel = gpuMode !== \"cpu\" ? gpu.createKernel(k.drawGpu) : gpu.createKernel(k.drawCpu)\n    return kernel.setOutput(canvasSize).setGraphical(true).setFunctions([k.getAt]).setWarnVarUsage(false).setTactic(\"performance\").setPrecision(\"unsigned\").setDynamicOutput(true).setDynamicArguments(true)\n}\n\nexport default function () {\n    const drawCanvasRef = useRef<HTMLCanvasElement>(null)\n\n    const [canvasSize, setCanvasSize] = useState<[number, number]>(initialCanvasSize)\n    const [windowSize, setWindowSize] = useState<[number, number]>(initialWindowSize)\n    const [gridSizeLongest, setGridSizeLongest] = useState(initialGridSizeLongest)\n    const [dt, setDt] = useState(initialDt)\n    const [cellSize, setCellSize] = useState(initialCellSize)\n    const [resolutionScale, setResolutionScale] = useState(initialResolutionScale)\n    const [simulationSpeed, setSimulationSpeed] = useState(initialSimulationSpeed)\n    const [reflectiveBoundary, setReflectiveBoundary] = useState(initialReflectiveBoundary)\n\n    const [sources, setSources] = useState<SignalSource[]>([])\n\n    useEffect(() => {\n        const adjustCanvasSize = () => {\n            const wndSize: [number, number] = [window.innerWidth, window.innerHeight]\n            setCanvasSize(calculateCanvasSize(wndSize, resolutionScale))\n            setWindowSize(wndSize)\n        }\n\n        adjustCanvasSize()\n\n        window.addEventListener(\"resize\", adjustCanvasSize)\n        return () => window.removeEventListener(\"resize\", adjustCanvasSize)\n    }, [resolutionScale])\n\n    const gridSize = useMemo<[number, number]>(() => calculateGridSize(gridSizeLongest, canvasSize), [canvasSize, gridSizeLongest])\n\n    // Would use useMemo for gpu here, but useMemo does not seem to work with ref dependencies.\n    const [gpu, setGpu] = useState<GPU | null>(null)\n    useEffect(() => {\n        if (drawCanvasRef.current) {\n            setGpu(new GPU({ mode: gpuMode, canvas: drawCanvasRef.current }))\n        }\n    }, [drawCanvasRef])\n\n    const simulator = useMemo(() => gpu ? new FDTDSimulator(gpu, initialGridSize, initialCellSize, initialReflectiveBoundary) : null, [gpu])\n    const renderSim = useMemo(() => gpu ? makeRenderSimulatorCanvas(gpu, initialGridSize) : null, [gpu])\n\n    // Update render sim output size\n    useEffect(() => {\n        if (renderSim) {\n            renderSim.setOutput(canvasSize)\n        }\n    }, [renderSim, canvasSize])\n\n    // Update simulator grid size\n    useEffect(() => {\n        if (simulator) {\n            simulator.setGridSize(gridSize)\n        }\n    }, [simulator, gridSize])\n\n    // Update simulator cell size\n    useEffect(() => {\n        if (simulator) {\n            simulator.setCellSize(cellSize)\n        }\n    }, [simulator, cellSize])\n\n    // Update reflective boundary\n    useEffect(() => {\n        if (simulator) {\n            simulator.reflectiveBoundary = reflectiveBoundary\n        }\n    }, [simulator, reflectiveBoundary])\n\n    const [signalBrushSize, setSignalBrushSize] = useState(defaultSignalBrushSize)\n    const [signalBrushValue, setSignalBrushValue] = useState(defaultSignalBrushValue)\n\n    const [materialBrushSize, setMaterialBrushSize] = useState(defaultMaterialBrushSize)\n    const [permittivityBrushValue, setPermittivityBrushValue] = useState(defaultPermittivityBrushValue)\n    const [permeabilityBrushValue, setPermeabilityBrushValue] = useState(defaultPermeabilityBrushValue)\n    const [signalFrequency, setSignalFrequency] = useState(defaultSignalFrequency)\n    const [drawingMaterial, setDrawingMaterial] = useState(false)\n    const optionMaterialBrush = 0\n    const optionSignal = 1\n    const [clickOption, setClickOption] = useState(optionSignal) // material, signal\n\n    const [mousePosition, setMousePosition] = useState<[number, number] | null>(null)\n\n    const signalStrength = useRef(0)\n    const mouseDownPos = useRef<[number, number] | null>(null)\n\n    const windowToSimulationPoint = useMemo(() => {\n        return (windowPoint: [number, number]) => {\n            const simulationPoint: [number, number] = [\n                clamp(0, gridSize[0] - 1, Math.floor(gridSize[0] * windowPoint[0] / windowSize[0])),\n                clamp(0, gridSize[1] - 1, Math.floor(gridSize[1] * windowPoint[1] / windowSize[1]))\n            ]\n            return simulationPoint\n        }\n    }, [windowSize, gridSize])\n\n    const simStep = useCallback(() => {\n        if (simulator) {\n            const simData = simulator.getData()\n\n            if (mouseDownPos.current !== null) {\n                const center = windowToSimulationPoint(mouseDownPos.current)\n                const brushHalfSize = Math.round(signalBrushSize / 2)\n\n                simulator.injectSignal(center, brushHalfSize, -signalBrushValue * 2000 * Math.cos(2 * Math.PI * signalFrequency * simData.time), dt)\n            }\n\n            for (const source of sources) {\n                source.inject(simulator, dt)\n            }\n\n            simulator.stepMagnetic(dt)\n            simulator.stepElectric(dt)\n        }\n    }, [simulator, dt, signalFrequency, signalBrushValue, signalBrushSize, sources, windowToSimulationPoint])\n\n    useEffect(() => {\n        if (simulationSpeed > 0) {\n            const timer = setInterval(simStep, 1000 / simulationSpeed * dt)\n            return () => clearInterval(timer)\n        }\n\n        return undefined\n    }, [simStep, dt, simulationSpeed])\n\n    const drawStep = useCallback(() => {\n        if (simulator && renderSim) {\n            if (drawCanvasRef.current) {\n                const cnvSize = calculateCanvasSize([window.innerWidth, window.innerHeight], resolutionScale)\n                drawCanvasRef.current.width = cnvSize[0]\n                drawCanvasRef.current.height = cnvSize[1]\n            }\n\n            const simData = simulator.getData()\n\n            renderSim(simData.electricField[0].values, simData.electricField[1].values, simData.electricField[2].values,\n                simData.magneticField[0].values, simData.magneticField[1].values, simData.magneticField[2].values,\n                simData.permittivity.values, simData.permeability.values, gridSize)\n        }\n    }, [simulator, renderSim, gridSize, resolutionScale, drawCanvasRef])\n\n    useEffect(() => {\n        let stop = false\n        const drawIfNotStopped = () => {\n            if (!stop) {\n                drawStep()\n                requestAnimationFrame(drawIfNotStopped)\n            }\n        }\n\n        requestAnimationFrame(drawIfNotStopped)\n\n        return () => { stop = true }\n    }, [drawStep])\n\n    const changeMaterial = useCallback((canvasPos: [number, number]) => {\n        if (simulator) {\n            const centerX = Math.round(gridSize[0] * (canvasPos[0] / windowSize[0]))\n            const centerY = Math.round(gridSize[1] * (canvasPos[1] / windowSize[1]))\n            const brushHalfSize = Math.round(materialBrushSize / 2)\n\n            simulator.drawPermittivity([centerX, centerY, 0], brushHalfSize, permittivityBrushValue)\n            simulator.drawPermeability([centerX, centerY, 0], brushHalfSize, permeabilityBrushValue)\n        }\n    }, [simulator, gridSize, windowSize, materialBrushSize, permittivityBrushValue, permeabilityBrushValue])\n\n    const resetMaterials = useCallback(() => {\n        if (simulator) {\n            simulator.resetMaterials()\n        }\n    }, [simulator])\n\n    const resetFields = useCallback(() => {\n        if (simulator) {\n            simulator.resetFields()\n            signalStrength.current = 0\n        }\n    }, [simulator])\n\n    const onInputDown = useCallback(([clientX, clientY]: [number, number]) => {\n        if (simulator) {\n            if (clickOption === optionSignal) {\n                mouseDownPos.current = [clientX, clientY]\n            } else if (clickOption === optionMaterialBrush) {\n                changeMaterial([clientX, clientY])\n                setDrawingMaterial(true)\n            }\n        }\n    }, [simulator, changeMaterial, clickOption])\n\n    const onInputMove = useCallback(([clientX, clientY]: [number, number]) => {\n        if (simulator) {\n            if (clickOption === optionSignal && mouseDownPos.current !== null) {\n                mouseDownPos.current = [clientX, clientY]\n            }\n\n            if (drawingMaterial) {\n                changeMaterial([clientX, clientY])\n            }\n        }\n    }, [simulator, changeMaterial, clickOption, drawingMaterial])\n\n    const onInputUp = useCallback(() => {\n        if (clickOption === optionSignal) {\n            mouseDownPos.current = null\n        } else if (clickOption === optionMaterialBrush) {\n            setDrawingMaterial(false)\n        }\n    }, [clickOption])\n\n    const activeBrushSize = useMemo(() => clickOption === optionSignal ? signalBrushSize : materialBrushSize, [clickOption, signalBrushSize, materialBrushSize])\n\n    return (\n        <div style={{ touchAction: \"none\", userSelect: \"none\" }}>\n            <canvas width={canvasSize[0]} height={canvasSize[1]} ref={drawCanvasRef} style={{ position: \"absolute\", width: windowSize[0], height: windowSize[1] }}\n                onMouseDown={e => onInputDown([e.clientX, e.clientY])}\n                onMouseMove={e => { setMousePosition([e.clientX, e.clientY]); onInputMove([e.clientX, e.clientY]) }}\n                onMouseUp={e => onInputUp()}\n                onMouseLeave={e => onInputUp()}\n                onTouchStart={e => { setMousePosition([e.touches[0].clientX, e.touches[0].clientY]); onInputDown([e.touches[0].clientX, e.touches[0].clientY]) }}\n                onTouchMove={e => { setMousePosition([e.touches[0].clientX, e.touches[0].clientY]); onInputMove([e.touches[0].clientX, e.touches[0].clientY]) }}\n                onTouchEnd={e => { setMousePosition(null); onInputUp() }}\n                onTouchCancel={e => { setMousePosition(null); onInputUp() }}\n                onContextMenu={e => e.preventDefault()}\n            />\n\n            <div style={{ position: \"absolute\", bottom: 10, right: 10 }}>\n                <a href=\"https://github.com/RobinKa/maxwell-simulation\" rel=\"noopener noreferrer\" target=\"_blank\" style={{ fontWeight: \"lighter\", color: \"rgba(255, 255, 255, 100)\", textDecoration: \"none\" }}>Source code</a>\n            </div>\n\n            {mousePosition &&\n                <div style={{ position: \"absolute\", pointerEvents: \"none\", left: mousePosition[0] - (2 * (activeBrushSize + 1)), top: mousePosition[1] - (2 * (activeBrushSize + 1)), width: 4 * (activeBrushSize + 1), height: 4 * (activeBrushSize + 1), border: \"2px solid yellow\" }} />\n            }\n\n            {gpuMode === \"cpu\" &&\n                <div style={{ position: \"absolute\", pointerEvents: \"none\", left: 10, bottom: 10, color: \"red\", fontWeight: \"lighter\" }}>Using CPU (WebGL with float textures unsupported by your device)</div>\n            }\n\n            <img onClick={toggleFullScreen} src={Fullscreen} alt=\"Fullscreen\" style={{ position: \"absolute\", right: 10, top: 10, cursor: \"pointer\" }} />\n\n            <CollapsibleContainer id=\"Menu\" title=\"Menu\" buttonStyle={{ background: \"rgb(60, 60, 60)\" }}>\n                <CollapsibleContainer title=\"Examples\">\n                    <ExamplesComponent\n                        simulator={simulator} setCellSize={setCellSize} setDt={setDt}\n                        setGridSizeLongest={setGridSizeLongest} setSimulationSpeed={setSimulationSpeed}\n                        setSources={setSources} gridSize={gridSize} dt={dt}\n                        cellSize={cellSize} simulationSpeed={simulationSpeed} />\n                </CollapsibleContainer>\n                <CollapsibleContainer title=\"Controls\">\n                    <ControlComponent\n                        signalBrushSize={signalBrushSize} setSignalBrushSize={setSignalBrushSize}\n                        materialBrushSize={materialBrushSize} setMaterialBrushSize={setMaterialBrushSize}\n                        signalBrushValue={signalBrushValue} setSignalBrushValue={setSignalBrushValue}\n                        permittivityBrushValue={permittivityBrushValue} setPermittivityBrushValue={setPermittivityBrushValue}\n                        permeabilityBrushValue={permeabilityBrushValue} setPermeabilityBrushValue={setPermeabilityBrushValue}\n                        signalFrequency={signalFrequency} setSignalFrequency={setSignalFrequency}\n                        clickOption={clickOption} setClickOption={setClickOption}\n                        resetFields={resetFields} resetMaterials={resetMaterials} />\n                </CollapsibleContainer>\n                <CollapsibleContainer title=\"Save / Load\" initiallyCollapsed={true}>\n                    <SaveLoadComponent simulator={simulator} gridSize={gridSize} />\n                </CollapsibleContainer>\n                <CollapsibleContainer title=\"Settings\" initiallyCollapsed={true}>\n                    <SettingsComponent\n                        gridSizeLongest={gridSizeLongest} setGridSizeLongest={setGridSizeLongest}\n                        simulationSpeed={simulationSpeed} setSimulationSpeed={setSimulationSpeed}\n                        resolutionScale={resolutionScale} setResolutionScale={setResolutionScale}\n                        cellSize={cellSize} setCellSize={setCellSize}\n                        reflectiveBoundary={reflectiveBoundary} setReflectiveBoundary={setReflectiveBoundary}\n                        dt={dt} setDt={setDt} />\n                </CollapsibleContainer>\n            </CollapsibleContainer>\n        </div>\n    )\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABISURBVFhH7dchDgAhDETRKfe/M1TUlgyqgv8Mq+AnQMjGTjJFqs+rlzlXjWMIIKC9Be6Jd3XrsAUEAAB4jgkYD+DPiIDfA6QD/j8gGcpVf+MAAAAASUVORK5CYII=\""],"sourceRoot":""}