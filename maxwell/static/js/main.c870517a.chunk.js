(this.webpackJsonpmaxwell=this.webpackJsonpmaxwell||[]).push([[0],{184:function(e,t,i){"use strict";i.r(t);var a=i(6),n=i.n(a),r=i(72),s=i.n(r),c=(i(81),i(34)),l=i.n(c),u=i(73),o=i(9),d=i(74),h=i(75);function g(e){var t={};return function(i){return t[i]||(t[i]=e()),t[i]}}var p=function e(t,i,a){var n=this;Object(h.a)(this,e),this.gpu=t,this.gridSize=i,this.cellSize=a,this.data=void 0,this.updateMagneticX=void 0,this.updateMagneticY=void 0,this.updateMagneticZ=void 0,this.updateElectricX=void 0,this.updateElectricY=void 0,this.updateElectricZ=void 0,this.injectSource=void 0,this.decaySource=void 0,this.makeFieldTexture=void 0,this.copyTexture=void 0,this.drawOnTexture=void 0,this.stepElectric=function(e){var t=n.data.electricFieldX.values,i=n.data.electricFieldY.values,a=n.data.electricFieldZ.values,r=n.data.magneticFieldX.values,s=n.data.magneticFieldY.values,c=n.data.magneticFieldZ.values,l=n.data.permittivity.values,u=n.injectSource(n.data.electricSourceFieldZ.values,a,e);n.data.electricSourceFieldZ.values=n.decaySource(n.copyTexture("esz")(n.data.electricSourceFieldZ.values),e),n.data.electricFieldX.values=n.updateElectricX(s,c,l,n.copyTexture("ex")(t),e),n.data.electricFieldY.values=n.updateElectricY(r,c,l,n.copyTexture("ey")(i),e),n.data.electricFieldZ.values=n.updateElectricZ(r,s,l,u,e),n.data.time+=e/2},this.stepMagnetic=function(e){var t=n.data.electricFieldX.values,i=n.data.electricFieldY.values,a=n.data.electricFieldZ.values,r=n.data.magneticFieldX.values,s=n.data.magneticFieldY.values,c=n.data.magneticFieldZ.values,l=n.data.permeability.values;n.data.magneticFieldX.values=n.updateMagneticX(i,a,l,n.copyTexture("mx")(r),e),n.data.magneticFieldY.values=n.updateMagneticY(t,a,l,n.copyTexture("my")(s),e),n.data.magneticFieldZ.values=n.updateMagneticZ(t,i,l,n.copyTexture("mz")(c),e),n.data.time+=e/2},this.resetFields=function(){n.data.time=0,n.data.electricFieldX.values=n.makeFieldTexture("ex")(0),n.data.electricFieldY.values=n.makeFieldTexture("ey")(0),n.data.electricFieldZ.values=n.makeFieldTexture("ez")(0),n.data.magneticFieldX.values=n.makeFieldTexture("mx")(0),n.data.magneticFieldY.values=n.makeFieldTexture("my")(0),n.data.magneticFieldZ.values=n.makeFieldTexture("mz")(0),n.data.electricSourceFieldZ.values=n.makeFieldTexture("esz")(0)},this.resetMaterials=function(){n.data.permeability.values=n.makeFieldTexture("permeability")(1),n.data.permittivity.values=n.makeFieldTexture("permittivity")(1)},this.drawPermeability=function(e,t,i){n.data.permeability.values=n.drawOnTexture("permeability")(e,t,i,0,n.copyTexture("permability")(n.data.permeability.values))},this.drawPermittivity=function(e,t,i){n.data.permittivity.values=n.drawOnTexture("permittivity")(e,t,i,0,n.copyTexture("permittivity")(n.data.permittivity.values))},this.injectSignal=function(e,t,i,a){n.data.electricSourceFieldZ.values=n.drawOnTexture("esz")(e,t,i*a,1,n.copyTexture("esz")(n.data.electricSourceFieldZ.values))},this.getData=function(){return n.data};var r=i[0]*i[1]*i[2];function s(e,t,i,a,n,r,s){return n<0||n>=t||r<0||r>=i||s<0||s>=a?0:e[n+r*t+s*t*i]}function c(e,t){return e%t}function l(e,t,i){return Math.floor(e/t)%i}function u(e,t,i,a){return Math.floor(e/(t*i))%a}this.makeFieldTexture=g((function(){return n.gpu.createKernel((function(e){return e})).setOutput([r]).setPipeline(!0)})),this.copyTexture=g((function(){return n.gpu.createKernel((function(e){return e[this.thread.x]})).setOutput([r]).setPipeline(!0)})),this.data={time:0,electricFieldX:{values:this.makeFieldTexture("ex")(0),shape:i},electricFieldY:{values:this.makeFieldTexture("ey")(0),shape:i},electricFieldZ:{values:this.makeFieldTexture("ez")(0),shape:i},magneticFieldX:{values:this.makeFieldTexture("mx")(0),shape:i},magneticFieldY:{values:this.makeFieldTexture("my")(0),shape:i},magneticFieldZ:{values:this.makeFieldTexture("mz")(0),shape:i},electricSourceFieldZ:{values:this.makeFieldTexture("esz")(0),shape:i},permittivity:{values:this.makeFieldTexture("permittivity")(1),shape:i},permeability:{values:this.makeFieldTexture("permeability")(1),shape:i}},this.drawOnTexture=g((function(){return n.gpu.createKernel((function(e,t,i,a,n){var r=Math.floor(this.thread.x),o=this.constants.gridSizeX,d=this.constants.gridSizeY,h=this.constants.gridSizeZ,g=c(r,o),p=l(r,o,d),m=u(r,o,d,h),v=s(n,o,d,h,g,p,m);return Math.max(Math.abs(e[0]-g),Math.max(Math.abs(e[1]-p),Math.abs(e[2]-m)))<t?i+a*v:v}),{output:[r],constants:{cellSize:a,gridSizeX:i[0],gridSizeY:i[1],gridSizeZ:i[2]}}).setFunctions([c,l,u,s]).setWarnVarUsage(!1).setPipeline(!0)})),this.injectSource=this.gpu.createKernel((function(e,t,i){var a=Math.floor(this.thread.x),n=this.constants.gridSizeX,r=this.constants.gridSizeY,o=this.constants.gridSizeZ,d=c(a,n),h=l(a,n,r),g=u(a,n,r,o);return s(t,n,r,o,d,h,g)+s(e,n,r,o,d,h,g)*i}),{output:[r],constants:{cellSize:a,gridSizeX:i[0],gridSizeY:i[1],gridSizeZ:i[2]}}).setFunctions([c,l,u,s]).setWarnVarUsage(!1).setPipeline(!0),this.decaySource=this.gpu.createKernel((function(e,t){var i=Math.floor(this.thread.x),a=this.constants.gridSizeX,n=this.constants.gridSizeY,r=this.constants.gridSizeZ;return s(e,a,n,r,c(i,a),l(i,a,n),u(i,a,n,r))*Math.pow(.1,t)}),{output:[r],constants:{cellSize:a,gridSizeX:i[0],gridSizeY:i[1],gridSizeZ:i[2]}}).setFunctions([c,l,u,s]).setWarnVarUsage(!1).setPipeline(!0),this.updateMagneticX=this.gpu.createKernel((function(e,t,i,a,n){var r=Math.floor(this.thread.x),o=this.constants.gridSizeX,d=this.constants.gridSizeY,h=this.constants.gridSizeZ,g=this.constants.cellSize,p=c(r,o),m=l(r,o,d),v=u(r,o,d,h);return s(a,o,d,h,p,m,v)-n/(s(i,o,d,h,p,m,v)*g)*(s(t,o,d,h,p,m+1,v)-s(t,o,d,h,p,m,v))}),{output:[r],constants:{cellSize:a,gridSizeX:i[0],gridSizeY:i[1],gridSizeZ:i[2]}}).setFunctions([c,l,u,s]).setWarnVarUsage(!1).setPipeline(!0),this.updateMagneticY=this.gpu.createKernel((function(e,t,i,a,n){var r=Math.floor(this.thread.x),o=this.constants.gridSizeX,d=this.constants.gridSizeY,h=this.constants.gridSizeZ,g=this.constants.cellSize,p=c(r,o),m=l(r,o,d),v=u(r,o,d,h);return s(a,o,d,h,p,m,v)-n/(s(i,o,d,h,p,m,v)*g)*-(s(t,o,d,h,p+1,m,v)-s(t,o,d,h,p,m,v))}),{output:[r],constants:{cellSize:a,gridSizeX:i[0],gridSizeY:i[1],gridSizeZ:i[2]}}).setFunctions([c,l,u,s]).setWarnVarUsage(!1).setPipeline(!0),this.updateMagneticZ=this.gpu.createKernel((function(e,t,i,a,n){var r=Math.floor(this.thread.x),o=this.constants.gridSizeX,d=this.constants.gridSizeY,h=this.constants.gridSizeZ,g=this.constants.cellSize,p=c(r,o),m=l(r,o,d),v=u(r,o,d,h);return s(a,o,d,h,p,m,v)-n/(s(i,o,d,h,p,m,v)*g)*(s(t,o,d,h,p+1,m,v)-s(t,o,d,h,p,m,v)-(s(e,o,d,h,p,m+1,v)-s(e,o,d,h,p,m,v)))}),{output:[r],constants:{cellSize:a,gridSizeX:i[0],gridSizeY:i[1],gridSizeZ:i[2]}}).setFunctions([c,l,u,s]).setWarnVarUsage(!1).setPipeline(!0),this.updateElectricX=this.gpu.createKernel((function(e,t,i,a,n){var r=Math.floor(this.thread.x),o=this.constants.gridSizeX,d=this.constants.gridSizeY,h=this.constants.gridSizeZ,g=this.constants.cellSize,p=c(r,o),m=l(r,o,d),v=u(r,o,d,h);return s(a,o,d,h,p,m,v)+n/(s(i,o,d,h,p,m,v)*g)*(s(t,o,d,h,p,m,v)-s(t,o,d,h,p,m-1,v))}),{output:[r],constants:{cellSize:a,gridSizeX:i[0],gridSizeY:i[1],gridSizeZ:i[2]}}).setFunctions([c,l,u,s]).setWarnVarUsage(!1).setPipeline(!0),this.updateElectricY=this.gpu.createKernel((function(e,t,i,a,n){var r=Math.floor(this.thread.x),o=this.constants.gridSizeX,d=this.constants.gridSizeY,h=this.constants.gridSizeZ,g=this.constants.cellSize,p=c(r,o),m=l(r,o,d),v=u(r,o,d,h);return s(a,o,d,h,p,m,v)+n/(s(i,o,d,h,p,m,v)*g)*-(s(t,o,d,h,p,m,v)-s(t,o,d,h,p-1,m,v))}),{output:[r],constants:{cellSize:a,gridSizeX:i[0],gridSizeY:i[1],gridSizeZ:i[2]}}).setFunctions([c,l,u,s]).setWarnVarUsage(!1).setPipeline(!0),this.updateElectricZ=this.gpu.createKernel((function(e,t,i,a,n){var r=Math.floor(this.thread.x),o=this.constants.gridSizeX,d=this.constants.gridSizeY,h=this.constants.gridSizeZ,g=this.constants.cellSize,p=c(r,o),m=l(r,o,d),v=u(r,o,d,h);return s(a,o,d,h,p,m,v)+n/(s(i,o,d,h,p,m,v)*g)*(s(t,o,d,h,p,m,v)-s(t,o,d,h,p-1,m,v)-(s(e,o,d,h,p,m,v)-s(e,o,d,h,p,m-1,v)))}),{output:[r],constants:{cellSize:a,gridSizeX:i[0],gridSizeY:i[1],gridSizeZ:i[2]}}).setFunctions([c,l,u,s]).setWarnVarUsage(!1).setPipeline(!0)},m=[window.innerWidth,window.innerHeight],v=m[0]/m[1],S=m[0]>=m[1]?[600,Math.ceil(600/v),1]:[Math.ceil(600*v),600,1],b=null;function f(e,t,i){return Math.max(e,Math.min(t,i))}function z(e){return n.a.createElement("div",null,n.a.createElement("label",null,e.label),n.a.createElement("div",null,n.a.createElement("input",{type:"range",min:e.min,max:e.max,value:e.value,step:e.step,onChange:function(t){return e.setValue(parseFloat(t.target.value))},style:{height:10,width:"100%"}}),n.a.createElement("div",{style:{textAlign:"center",lineHeight:.1,marginBottom:"7px"}},e.value)))}function x(e){return n.a.createElement("div",null,e.options.map((function(t,i){return n.a.createElement("button",{key:t,style:{boxSizing:"border-box",border:i===e.selectedOption?"4px solid rgb(0, 150, 255)":"0",height:"30px",margin:"5px",width:"".concat(100/e.options.length,"%"),background:"rgb(100, 100, 100)",color:"white"},onClick:function(t){return e.setSelectedOption(i)}},t)})))}function F(e){var t=Object(a.useState)(!1),i=Object(o.a)(t,2),r=i[0],s=i[1];return n.a.createElement("div",{style:{userSelect:"none"}},n.a.createElement("div",{style:{textAlign:"center",position:"absolute",opacity:.8,background:"rgba(33, 33, 33, 100)",fontWeight:"lighter",color:"white"}},n.a.createElement("button",{onClick:function(e){return s(!r)},style:{width:"100%",height:"30px",background:"rgba(50, 50, 50, 100)",border:"0px",color:"white",fontWeight:"bold",cursor:"pointer"}},"Controls [",r?"+":"-","]"),!r&&n.a.createElement("div",{style:{padding:"10px"}},n.a.createElement(z,{label:"Brush size",value:e.brushSize,setValue:e.setBrushSize,min:1,max:100,step:1}),n.a.createElement(z,{label:"Brush value",value:e.brushValue,setValue:e.setBrushValue,min:1,max:100,step:1}),n.a.createElement(z,{label:"Signal frequency",value:e.signalFrequency,setValue:e.setSignalFrequency,min:0,max:5,step:.5}),n.a.createElement(x,{options:["\u03b5 brush","\xb5 brush","Signal"],selectedOption:e.clickOption,setSelectedOption:e.setClickOption}),n.a.createElement("button",{onClick:e.resetFields,style:{background:"rgba(50, 50, 50, 100)",border:"0px",color:"white",margin:"2px"}},"Reset fields"),n.a.createElement("button",{onClick:e.resetMaterials,style:{background:"rgba(50, 50, 50, 100)",border:"0px",color:"white",margin:"2px"}},"Reset materials"))))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(n.a.createElement((function(){var e=Object(a.useState)(1),t=Object(o.a)(e,2),i=t[0],r=t[1],s=Object(a.useState)(10),c=Object(o.a)(s,2),h=c[0],g=c[1],v=Object(a.useState)(1),z=Object(o.a)(v,2),x=z[0],y=z[1],M=Object(a.useState)(!1),O=Object(o.a)(M,2),j=O[0],k=O[1],Z=Object(a.useState)(!1),w=Object(o.a)(Z,2),X=w[0],Y=w[1],E=Object(a.useState)(2),T=Object(o.a)(E,2),C=T[0],P=T[1],V=Object(a.useState)(null),W=Object(o.a)(V,2),K=W[0],U=W[1],B=Object(a.useRef)(0),R=Object(a.useRef)(null),q=Object(a.useRef)(null),D=Object(a.useRef)(null),I=Object(a.useCallback)((function(){if(b){var e=b.getData();if(null!==R.current&&D.current){var t=f(0,e.electricSourceFieldZ.shape[0]-1,Math.floor(e.electricSourceFieldZ.shape[0]*R.current[0]/D.current.width)),a=f(0,e.electricSourceFieldZ.shape[1]-1,Math.floor(e.electricSourceFieldZ.shape[1]*R.current[1]/D.current.height)),n=Math.round(i/2);b.injectSignal([t,a,0],n,1e3*-h*Math.cos(2*Math.PI*x*e.time),.02)}b.stepMagnetic(.02),b.stepElectric(.02)}}),[x,h,i]);Object(a.useEffect)((function(){var e=setInterval(I,20);return function(){return clearInterval(e)}}),[I]);var A=Object(a.useCallback)((function(){var e=!1;return function(){var t=Object(u.a)(l.a.mark((function t(){var i,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=function(e){return requestAnimationFrame(e)};case 1:if(e){t.next=7;break}return b&&(a=b.getData()).time>0&&null!==q.current&&q.current(a.electricFieldX.values,a.electricFieldY.values,a.electricFieldZ.values,a.magneticFieldX.values,a.magneticFieldY.values,a.magneticFieldZ.values,a.permittivity.values,a.permeability.values),t.next=5,new Promise(i);case 5:t.next=1;break;case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()(),function(){e=!0}}),[]);Object(a.useEffect)((function(){if(!D.current)throw new Error("Canvas ref was null");var e=new d.GPU({mode:"webgl",canvas:D.current});q.current=function(e){function t(e,t,i,a,n,r,s){return n<0||n>=t||r<0||r>=i||s<0||s>=a?0:e[n+r*t+s*t*i]}return e.createKernel((function(e,i,a,n,r,s,c,l){var u=this.constants.gridSizeX,o=this.constants.gridSizeY,d=this.constants.gridSizeZ,h=u*this.thread.x/this.output.x,g=o*(1-this.thread.y/this.output.y),p=Math.floor(h),m=Math.floor(g),v=Math.floor(d/2),S=t(e,u,o,d,p,m,v)*t(e,u,o,d,p,m,v)+t(i,u,o,d,p,m,v)*t(i,u,o,d,p,m,v)+t(a,u,o,d,p,m,v)*t(a,u,o,d,p,m,v),b=(t(n,u,o,d,p,m,v)+t(n,u,o,d,p-1,m-1,v))/2,f=(t(r,u,o,d,p,m,v)+t(r,u,o,d,p-1,m-1,v))/2,z=(t(s,u,o,d,p,m,v)+t(s,u,o,d,p-1,m-1,v))/2,x=b*b+f*f+z*z,F=Math.max(0,Math.min(1,(1+.4342944819*Math.log(t(c,u,o,d,p,m,v)))/4)),y=Math.max(0,Math.min(1,(1+.4342944819*Math.log(t(l,u,o,d,p,m,v)))/4)),M=(Math.abs(h%1-.5)<.25?1:0)*(Math.abs(g%1-.5)<.25?1:0),O=1-M;this.color(S/15+.5*M*F,S/15+x/15,x/15+.5*O*y)}),{output:[m[0],m[1]],constants:{gridSizeX:S[0],gridSizeY:S[1],gridSizeZ:S[2]},graphical:!0}).setFunctions([t]).setWarnVarUsage(!1)}(e),b=new p(e,S,.04),A()}),[A]);var H=Object(a.useCallback)((function(e){if(b){var t=Math.round(S[0]*(e[0]/m[0])),a=Math.round(S[1]*(e[1]/m[1])),n=Math.round(i/2);b.drawPermittivity([t,a,0],n,h)}}),[i,h]),J=Object(a.useCallback)((function(e){if(b){var t=Math.round(S[0]*(e[0]/m[0])),a=Math.round(S[1]*(e[1]/m[1])),n=Math.round(i/2);b.drawPermeability([t,a,0],n,h)}}),[i,h]),G=Object(a.useCallback)((function(){b&&b.resetMaterials()}),[]),$=Object(a.useCallback)((function(){b&&(b.resetFields(),B.current=0)}),[]),_=Object(a.useCallback)((function(e){var t=Object(o.a)(e,2),i=t[0],a=t[1];b&&(2===C?R.current=[i,a]:0===C?(H([i,a]),Y(!0)):1===C&&(J([i,a]),k(!0)))}),[H,J,C]),L=Object(a.useCallback)((function(e){var t=Object(o.a)(e,2),i=t[0],a=t[1];b&&(2===C&&null!==R.current&&(R.current=[i,a]),X&&H([i,a]),j&&J([i,a]))}),[H,J,C,j,X]),N=Object(a.useCallback)((function(){2===C?R.current=null:1===C?k(!1):0===C&&Y(!1)}),[C]),Q=Object(a.useState)(2),ee=Object(o.a)(Q,2),te=ee[0],ie=ee[1],ae=Object(a.useState)(1),ne=Object(o.a)(ae,2),re=ne[0],se=ne[1],ce=Object(a.useState)(10),le=Object(o.a)(ce,2),ue=le[0],oe=le[1],de=Object(a.useState)(5),he=Object(o.a)(de,2),ge=he[0],pe=he[1],me=Object(a.useState)(5),ve=Object(o.a)(me,2),Se=ve[0],be=ve[1];return Object(a.useEffect)((function(){2===C&&2!==te?(pe(i),be(h),r(re),g(ue)):2!==C&&2===te&&(se(i),oe(h),r(ge),g(Se)),ie(C)}),[C,te,re,ue,ge,Se,i,h]),n.a.createElement("div",null,n.a.createElement("canvas",{width:m[0],height:m[1],ref:D,style:{position:"absolute",userSelect:"none"},onMouseDown:function(e){return _([e.clientX,e.clientY])},onMouseMove:function(e){U([e.clientX,e.clientY]),L([e.clientX,e.clientY])},onMouseUp:function(e){return N()},onTouchStart:function(e){return _([e.touches[0].clientX,e.touches[0].clientY])},onTouchMove:function(e){return L([e.touches[0].clientX,e.touches[0].clientY])},onTouchEnd:function(e){return N()},onContextMenu:function(e){return e.preventDefault()}}),n.a.createElement("div",{style:{position:"absolute",bottom:10,right:10,userSelect:"none"}},n.a.createElement("a",{href:"https://github.com/RobinKa/maxwell-simulation",rel:"noopener noreferrer",target:"_blank",style:{fontWeight:"lighter",color:"rgba(255, 255, 255, 100)",textDecoration:"none"}},"Source code")),K&&n.a.createElement("div",{style:{position:"absolute",pointerEvents:"none",left:K[0]-2*(i+1),top:K[1]-2*(i+1),width:4*(i+1),height:4*(i+1),border:"2px solid yellow"}}),n.a.createElement(F,{brushSize:i,setBrushSize:r,brushValue:h,setBrushValue:g,signalFrequency:x,setSignalFrequency:y,clickOption:C,setClickOption:P,resetFields:$,resetMaterials:G}))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},76:function(e,t,i){e.exports=i(184)},81:function(e,t,i){}},[[76,1,2]]]);
//# sourceMappingURL=main.c870517a.chunk.js.map