{"version":3,"sources":["simulator.ts","components.tsx","util.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["memoByName","makeNew","memoized","name","FDTDSimulator","gpu","gridSize","cellSize","getAt","field","shapeX","shapeY","x","y","data","updateMagneticX","updateMagneticY","updateMagneticZ","updateElectricX","updateElectricY","updateElectricZ","injectSource","decaySource","makeFieldTexture","copyTexture","drawOnTexture","setGridSize","forEach","kernel","setOutput","resetFields","resetMaterials","setCellSize","stepElectric","dt","elX","electricFieldX","values","elY","electricFieldY","elZ","electricFieldZ","magX","magneticFieldX","magY","magneticFieldY","magZ","magneticFieldZ","perm","permittivity","injectedElZ","electricSourceFieldZ","time","stepMagnetic","permeability","drawPermeability","pos","size","value","drawPermittivity","injectSignal","loadPermittivity","loadPermeability","getData","this","createKernel","setPipeline","setTactic","setDynamicOutput","setDynamicArguments","texture","thread","shape","keep","oldValue","output","Math","max","abs","constants","setFunctions","setWarnVarUsage","source","gx","gy","pow","fieldY","fieldZ","magFieldX","cs","fieldX","magFieldY","magFieldZ","elFieldX","elFieldY","elFieldZ","CollapsibleContainer","props","useState","collapsed","setCollapsed","style","textAlign","background","fontWeight","color","onClick","e","width","height","border","cursor","buttonStyle","title","children","LabeledSlider","label","type","min","step","onChange","setValue","parseFloat","target","lineHeight","marginBottom","OptionSelector","options","map","option","optionIndex","key","boxSizing","selectedOption","margin","length","setSelectedOption","SaveLoadComponent","simulator","simulatorMapUrl","setSimulatorMapUrl","onSaveClicked","useCallback","simData","window","open","simulatorMap","canvas","document","createElement","ctx","getContext","fillStyle","fillRect","textBaseline","fillText","canvasData","getImageData","round","putImageData","toDataURL","simulatorMapToImageUrl","toArray","onLoadClicked","imageUrl","targetSize","onLoaded","image","Image","crossOrigin","onload","drawImage","imageData","push","src","imageUrlToSimulatorMap","padding","SettingsComponent","gridSizeLongest","setGridSizeLongest","setDt","simulationSpeed","setSimulationSpeed","ControlComponent","brushSize","setBrushSize","brushValue","setBrushValue","signalFrequency","setSignalFrequency","clickOption","setClickOption","initialCanvasSize","innerWidth","innerHeight","initialGridSize","calculateGridSize","canvasSize","canvasAspect","ceil","clamp","Boolean","location","hostname","match","ReactDOM","render","drawCanvasRef","useRef","setCanvasSize","useEffect","adjustCanvasSize","addEventListener","removeEventListener","useMemo","setGpu","current","GPU","mode","renderSim","g","eAA","magXAA","magYAA","magZAA","mAA","permittivityValue","log","permeabilityValue","backgroundX","backgroundY","setGraphical","setPrecision","makeRenderSimulatorCanvas","drawingPermeability","setDrawingPermeability","drawingPermittivity","setDrawingPermittivity","mousePosition","setMousePosition","signalStrength","mouseDownPos","simStep","centerX","floor","centerY","brushHalfSize","cos","PI","timer","setInterval","clearInterval","drawStep","stop","requestAnimationFrame","drawIfNotStopped","changePermittivity","canvasPos","changePermeability","onInputDown","clientX","clientY","onInputMove","onInputUp","previousClickOption","setPreviousClickOption","signalBrushSize","setSignalBrushSize","signalBrushValue","setSignalBrushValue","materialBrushSize","setMaterialBrushSize","materialBrushValue","setMaterialBrushValue","touchAction","userSelect","ref","position","onMouseDown","onMouseMove","onMouseUp","onMouseLeave","onTouchStart","touches","onTouchMove","onTouchEnd","onTouchCancel","onContextMenu","preventDefault","bottom","right","href","rel","textDecoration","pointerEvents","left","top","opacity","maxHeight","overflowY","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.d499215f.chunk.js","sourcesContent":["import { GPU, IKernelRunShortcut, Texture } from \"gpu.js\"\r\n\r\nexport type ScalarField2D = {\r\n    values: Texture\r\n    shape: [number, number]\r\n}\r\n\r\nexport type SimulationData = {\r\n    time: number\r\n    electricFieldX: ScalarField2D\r\n    electricFieldY: ScalarField2D\r\n    electricFieldZ: ScalarField2D\r\n    magneticFieldX: ScalarField2D\r\n    magneticFieldY: ScalarField2D\r\n    magneticFieldZ: ScalarField2D\r\n\r\n    permittivity: ScalarField2D\r\n    permeability: ScalarField2D\r\n\r\n    electricSourceFieldZ: ScalarField2D\r\n}\r\n\r\nexport interface Simulator {\r\n    stepElectric: (dt: number) => void\r\n    stepMagnetic: (dt: number) => void\r\n    resetFields: () => void\r\n    resetMaterials: () => void\r\n    getData: () => SimulationData\r\n}\r\n\r\nfunction memoByName<T>(makeNew: () => T) {\r\n    const memoized: { [name: string]: T } = {}\r\n\r\n    return (name: string) => {\r\n        if (!memoized[name]) {\r\n            memoized[name] = makeNew()\r\n        }\r\n        return memoized[name]\r\n    }\r\n}\r\n\r\nexport class FDTDSimulator implements Simulator {\r\n    private data: SimulationData\r\n\r\n    private updateMagneticX: IKernelRunShortcut\r\n    private updateMagneticY: IKernelRunShortcut\r\n    private updateMagneticZ: IKernelRunShortcut\r\n    private updateElectricX: IKernelRunShortcut\r\n    private updateElectricY: IKernelRunShortcut\r\n    private updateElectricZ: IKernelRunShortcut\r\n\r\n    private injectSource: IKernelRunShortcut\r\n    private decaySource: IKernelRunShortcut\r\n\r\n    private makeFieldTexture: (name: string) => IKernelRunShortcut\r\n    private copyTexture: (name: string) => IKernelRunShortcut\r\n\r\n    private drawOnTexture: (name: string) => IKernelRunShortcut\r\n\r\n    constructor(readonly gpu: GPU, gridSize: [number, number], private cellSize: number) {\r\n        this.makeFieldTexture = memoByName(() => this.gpu.createKernel(function (value: number) {\r\n            return value\r\n        }).setOutput(gridSize).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true))\r\n\r\n        this.copyTexture = memoByName(() => this.gpu.createKernel(function (texture: number[][]) {\r\n            return texture[this.thread.y!][this.thread.x]\r\n        }).setOutput(gridSize).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true))\r\n\r\n        this.data = {\r\n            time: 0,\r\n            electricFieldX: { values: this.makeFieldTexture(\"ex\")(0) as Texture, shape: gridSize },\r\n            electricFieldY: { values: this.makeFieldTexture(\"ey\")(0) as Texture, shape: gridSize },\r\n            electricFieldZ: { values: this.makeFieldTexture(\"ez\")(0) as Texture, shape: gridSize },\r\n            magneticFieldX: { values: this.makeFieldTexture(\"mx\")(0) as Texture, shape: gridSize },\r\n            magneticFieldY: { values: this.makeFieldTexture(\"my\")(0) as Texture, shape: gridSize },\r\n            magneticFieldZ: { values: this.makeFieldTexture(\"mz\")(0) as Texture, shape: gridSize },\r\n            electricSourceFieldZ: { values: this.makeFieldTexture(\"esz\")(0) as Texture, shape: gridSize },\r\n            permittivity: { values: this.makeFieldTexture(\"permittivity\")(1) as Texture, shape: gridSize },\r\n            permeability: { values: this.makeFieldTexture(\"permeability\")(1) as Texture, shape: gridSize },\r\n        }\r\n\r\n        function getAt(field: number[][], shapeX: number, shapeY: number, x: number, y: number) {\r\n            if (x < 0 || x >= shapeX || y < 0 || y >= shapeY) {\r\n                return 0\r\n            }\r\n\r\n            return field[y][x]\r\n        }\r\n\r\n        this.drawOnTexture = memoByName(() => this.gpu.createKernel(function (pos: number[], size: number, value: number, keep: number, texture: number[][]) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            const oldValue = getAt(texture, gx, gy, x, y)\r\n\r\n            const within = Math.max(Math.abs(pos[0] - x), Math.abs(pos[1] - y)) < size\r\n\r\n            return within ? value + keep * oldValue : oldValue\r\n        }, {\r\n            constants: { cellSize: cellSize },\r\n        }).setOutput(gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true))\r\n\r\n        this.injectSource = this.gpu.createKernel(function (source: number[][], field: number[][], dt: number) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            return getAt(field, gx, gy, x, y) + getAt(source, gx, gy, x, y) * dt\r\n        }).setOutput(gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true)\r\n\r\n        this.decaySource = this.gpu.createKernel(function (source: number[][], dt: number) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            return getAt(source, gx, gy, x, y) * Math.pow(0.1, dt)\r\n        }).setOutput(gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true)\r\n\r\n        this.updateMagneticX = this.gpu.createKernel(function (fieldY: number[][], fieldZ: number[][], permeability: number[][], magFieldX: number[][], dt: number, cs: number) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            // d_Y Z - d_Z Y\r\n            return getAt(magFieldX, gx, gy, x, y) - (dt / (getAt(permeability, gx, gy, x, y) * cs)) * (\r\n                (getAt(fieldZ, gx, gy, x, y + 1) - getAt(fieldZ, gx, gy, x, y)))\r\n        }, {\r\n            constants: { cellSize: cellSize },\r\n        }).setOutput(gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true)\r\n\r\n        this.updateMagneticY = this.gpu.createKernel(function (fieldX: number[][], fieldZ: number[][], permeability: number[][], magFieldY: number[][], dt: number, cs: number) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            // d_Z X - d_X Z\r\n            return getAt(magFieldY, gx, gy, x, y) - (dt / (getAt(permeability, gx, gy, x, y) * cs)) * (\r\n                -(getAt(fieldZ, gx, gy, x + 1, y) - getAt(fieldZ, gx, gy, x, y)))\r\n        }, {\r\n            constants: { cellSize: cellSize },\r\n        }).setOutput(gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true)\r\n\r\n        this.updateMagneticZ = this.gpu.createKernel(function (fieldX: number[][], fieldY: number[][], permeability: number[][], magFieldZ: number[][], dt: number, cs: number) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            // d_X Y - d_Y X\r\n            return getAt(magFieldZ, gx, gy, x, y) - (dt / (getAt(permeability, gx, gy, x, y) * cs)) * (\r\n                (getAt(fieldY, gx, gy, x + 1, y) - getAt(fieldY, gx, gy, x, y)) -\r\n                (getAt(fieldX, gx, gy, x, y + 1) - getAt(fieldX, gx, gy, x, y)))\r\n        }, {\r\n            constants: { cellSize: cellSize },\r\n        }).setOutput(gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true)\r\n\r\n        this.updateElectricX = this.gpu.createKernel(function (fieldY: number[][], fieldZ: number[][], permittivity: number[][], elFieldX: number[][], dt: number, cs: number) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            // d_Y Z - d_Z Y\r\n            return getAt(elFieldX, gx, gy, x, y) + (dt / (getAt(permittivity, gx, gy, x, y) * cs)) * (\r\n                (getAt(fieldZ, gx, gy, x, y) - getAt(fieldZ, gx, gy, x, y - 1)))\r\n        }, {\r\n            constants: { cellSize: cellSize },\r\n        }).setOutput(gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true)\r\n\r\n        this.updateElectricY = this.gpu.createKernel(function (fieldX: number[][], fieldZ: number[][], permittivity: number[][], elFieldY: number[][], dt: number, cs: number) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            // d_Z X - d_X Z\r\n            return getAt(elFieldY, gx, gy, x, y) + (dt / (getAt(permittivity, gx, gy, x, y) * cs)) * (\r\n                -(getAt(fieldZ, gx, gy, x, y) - getAt(fieldZ, gx, gy, x - 1, y)))\r\n        }, {\r\n            constants: { cellSize: cellSize },\r\n        }).setOutput(gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true)\r\n\r\n        this.updateElectricZ = this.gpu.createKernel(function (fieldX: number[][], fieldY: number[][], permittivity: number[][], elFieldZ: number[][], dt: number, cs: number) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            // d_X Y - d_Y X\r\n            return getAt(elFieldZ, gx, gy, x, y) + (dt / (getAt(permittivity, gx, gy, x, y) * cs)) * (\r\n                (getAt(fieldY, gx, gy, x, y) - getAt(fieldY, gx, gy, x - 1, y)) -\r\n                (getAt(fieldX, gx, gy, x, y) - getAt(fieldX, gx, gy, x, y - 1)))\r\n        }, {\r\n            constants: { cellSize: cellSize },\r\n        }).setOutput(gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true)\r\n    }\r\n\r\n    setGridSize = (gridSize: [number, number]) => {\r\n        const kernels = [\r\n            this.updateElectricX,\r\n            this.updateElectricY,\r\n            this.updateElectricZ,\r\n            this.updateMagneticX,\r\n            this.updateMagneticY,\r\n            this.updateMagneticZ,\r\n            this.injectSource,\r\n            this.decaySource,\r\n            this.makeFieldTexture(\"ex\"),\r\n            this.makeFieldTexture(\"ey\"),\r\n            this.makeFieldTexture(\"ez\"),\r\n            this.makeFieldTexture(\"mx\"),\r\n            this.makeFieldTexture(\"my\"),\r\n            this.makeFieldTexture(\"mz\"),\r\n            this.makeFieldTexture(\"esz\"),\r\n            this.makeFieldTexture(\"permeability\"),\r\n            this.makeFieldTexture(\"permittivity\"),\r\n            this.copyTexture(\"loadPermittivity\"),\r\n            this.copyTexture(\"loadPermittivity\"),\r\n            this.copyTexture(\"permeability\"),\r\n            this.copyTexture(\"permittivity\"),\r\n            this.copyTexture(\"ex\"),\r\n            this.copyTexture(\"ey\"),\r\n            this.copyTexture(\"esz\"),\r\n            this.copyTexture(\"mx\"),\r\n            this.copyTexture(\"my\"),\r\n            this.copyTexture(\"mz\"),\r\n            this.drawOnTexture(\"esz\"),\r\n            this.drawOnTexture(\"permeability\"),\r\n            this.drawOnTexture(\"permittivity\")\r\n        ]\r\n\r\n        kernels.forEach(kernel => kernel.setOutput(gridSize))\r\n\r\n        this.resetFields()\r\n        this.resetMaterials()\r\n    }\r\n\r\n    setCellSize = (cellSize: number) => {\r\n        this.cellSize = cellSize\r\n        this.resetFields()\r\n        this.resetMaterials()\r\n    }\r\n\r\n    stepElectric = (dt: number) => {\r\n        const elX = this.data.electricFieldX.values\r\n        const elY = this.data.electricFieldY.values\r\n        const elZ = this.data.electricFieldZ.values\r\n        const magX = this.data.magneticFieldX.values\r\n        const magY = this.data.magneticFieldY.values\r\n        const magZ = this.data.magneticFieldZ.values\r\n        const perm = this.data.permittivity.values\r\n\r\n        const injectedElZ = this.injectSource(this.data.electricSourceFieldZ.values, elZ, dt) as Texture\r\n        this.data.electricSourceFieldZ.values = this.decaySource(this.copyTexture(\"esz\")(this.data.electricSourceFieldZ.values), dt) as Texture\r\n\r\n        // d/dt E(x, t) = (curl B(x, t))/(µε)\r\n        this.data.electricFieldX.values = this.updateElectricX(magY, magZ, perm, this.copyTexture(\"ex\")(elX), dt, this.cellSize) as Texture\r\n        this.data.electricFieldY.values = this.updateElectricY(magX, magZ, perm, this.copyTexture(\"ey\")(elY), dt, this.cellSize) as Texture\r\n        this.data.electricFieldZ.values = this.updateElectricZ(magX, magY, perm, injectedElZ, dt, this.cellSize) as Texture\r\n\r\n        this.data.time += dt / 2\r\n    }\r\n\r\n    stepMagnetic = (dt: number) => {\r\n        const elX = this.data.electricFieldX.values\r\n        const elY = this.data.electricFieldY.values\r\n        const elZ = this.data.electricFieldZ.values\r\n        const magX = this.data.magneticFieldX.values\r\n        const magY = this.data.magneticFieldY.values\r\n        const magZ = this.data.magneticFieldZ.values\r\n        const perm = this.data.permeability.values\r\n\r\n        // d/dt B(x, t) = -curl E(x, t)\r\n        this.data.magneticFieldX.values = this.updateMagneticX(elY, elZ, perm, this.copyTexture(\"mx\")(magX), dt, this.cellSize) as Texture\r\n        this.data.magneticFieldY.values = this.updateMagneticY(elX, elZ, perm, this.copyTexture(\"my\")(magY), dt, this.cellSize) as Texture\r\n        this.data.magneticFieldZ.values = this.updateMagneticZ(elX, elY, perm, this.copyTexture(\"mz\")(magZ), dt, this.cellSize) as Texture\r\n\r\n        this.data.time += dt / 2\r\n    }\r\n\r\n    resetFields = () => {\r\n        this.data.time = 0\r\n        this.data.electricFieldX.values = this.makeFieldTexture(\"ex\")(0) as Texture\r\n        this.data.electricFieldY.values = this.makeFieldTexture(\"ey\")(0) as Texture\r\n        this.data.electricFieldZ.values = this.makeFieldTexture(\"ez\")(0) as Texture\r\n        this.data.magneticFieldX.values = this.makeFieldTexture(\"mx\")(0) as Texture\r\n        this.data.magneticFieldY.values = this.makeFieldTexture(\"my\")(0) as Texture\r\n        this.data.magneticFieldZ.values = this.makeFieldTexture(\"mz\")(0) as Texture\r\n        this.data.electricSourceFieldZ.values = this.makeFieldTexture(\"esz\")(0) as Texture\r\n    }\r\n\r\n    resetMaterials = () => {\r\n        this.data.permeability.values = this.makeFieldTexture(\"permeability\")(1) as Texture\r\n        this.data.permittivity.values = this.makeFieldTexture(\"permittivity\")(1) as Texture\r\n    }\r\n\r\n    drawPermeability = (pos: [number, number, number], size: number, value: number) => {\r\n        this.data.permeability.values = this.drawOnTexture(\"permeability\")(pos, size, value, 0, this.copyTexture(\"permability\")(this.data.permeability.values)) as Texture\r\n    }\r\n\r\n    drawPermittivity = (pos: [number, number, number], size: number, value: number) => {\r\n        this.data.permittivity.values = this.drawOnTexture(\"permittivity\")(pos, size, value, 0, this.copyTexture(\"permittivity\")(this.data.permittivity.values)) as Texture\r\n    }\r\n\r\n    injectSignal = (pos: [number, number], size: number, value: number, dt: number) => {\r\n        this.data.electricSourceFieldZ.values = this.drawOnTexture(\"esz\")(pos, size, value * dt, 1, this.copyTexture(\"esz\")(this.data.electricSourceFieldZ.values)) as Texture\r\n    }\r\n    \r\n    loadPermittivity = (permittivity: number[][]) => {\r\n        this.data.permittivity.values = this.copyTexture(\"loadPermittivity\")(permittivity) as Texture\r\n    }\r\n\r\n    loadPermeability = (permeability: number[][]) => {\r\n        this.data.permeability.values = this.copyTexture(\"loadPermeability\")(permeability) as Texture\r\n    }\r\n\r\n    getData = () => this.data\r\n}","import React, { ReactElement, useState, useCallback } from \"react\"\r\nimport { simulatorMapToImageUrl, imageUrlToSimulatorMap } from \"./util\"\r\nimport { FDTDSimulator } from \"./simulator\"\r\n\r\nexport type CollapsibleContainerProps = {\r\n    children: ReactElement<any> | ReactElement<any>[] | null\r\n    style?: React.CSSProperties\r\n    buttonStyle?: React.CSSProperties\r\n    title?: string\r\n}\r\n\r\nexport function CollapsibleContainer(props: CollapsibleContainerProps) {\r\n    const [collapsed, setCollapsed] = useState(false)\r\n\r\n    return (\r\n        <div style={{ textAlign: \"center\", background: \"rgb(33, 33, 33)\", fontWeight: \"lighter\", color: \"white\", ...props.style }}>\r\n            <button onClick={e => setCollapsed(!collapsed)} style={{ width: \"100%\", height: \"24px\", background: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", fontWeight: \"bold\", cursor: \"pointer\", ...props.buttonStyle }}>\r\n                {props.title ? `${props.title} ` : \"\"}[{collapsed ? \"+\" : \"-\"}]\r\n            </button>\r\n            {!collapsed && props.children}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type LabeledSliderProps = {\r\n    label: string\r\n    value: number,\r\n    setValue: (value: number) => void\r\n    min: number\r\n    max: number\r\n    step: number\r\n}\r\n\r\nexport function LabeledSlider(props: LabeledSliderProps) {\r\n    return (\r\n        <div>\r\n            <label>{props.label}</label>\r\n            <div>\r\n                <input type=\"range\" min={props.min} max={props.max} value={props.value} step={props.step}\r\n                    onChange={e => props.setValue(parseFloat(e.target.value))} style={{ height: 10, width: \"100%\" }} />\r\n                <div style={{ textAlign: \"center\", lineHeight: 0.1, marginBottom: \"7px\" }}>\r\n                    {props.value}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type OptionSelectorProps = {\r\n    options: string[]\r\n    selectedOption: number\r\n    setSelectedOption: (selectedOption: number) => void\r\n}\r\n\r\nexport function OptionSelector(props: OptionSelectorProps) {\r\n    return (\r\n        <div>\r\n            {props.options.map((option, optionIndex) =>\r\n                <button key={option} style={{\r\n                    boxSizing: \"border-box\",\r\n                    border: optionIndex === props.selectedOption ? \"4px solid rgb(0, 150, 255)\" : \"0\",\r\n                    height: \"30px\",\r\n                    margin: \"5px\",\r\n                    width: `${100 / props.options.length}%`, background: \"rgb(100, 100, 100)\", color: \"white\"\r\n                }}\r\n                    onClick={e => props.setSelectedOption(optionIndex)}>\r\n                    {option}\r\n                </button>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type SaveLoadComponentProps = {\r\n    simulator: FDTDSimulator | null\r\n    gridSize: [number, number]\r\n}\r\n\r\nexport function SaveLoadComponent(props: SaveLoadComponentProps) {\r\n    const simulator = props.simulator\r\n    const gridSize = props.gridSize\r\n    const [simulatorMapUrl, setSimulatorMapUrl] = useState(\"\")\r\n\r\n    const onSaveClicked = useCallback(() => {\r\n        if (simulator) {\r\n            const simData = simulator.getData()\r\n\r\n            window.open(simulatorMapToImageUrl({\r\n                permittivity: simData.permittivity.values.toArray() as number[][],\r\n                permeability: simData.permeability.values.toArray() as number[][],\r\n                shape: [simData.permeability.shape[0], simData.permeability.shape[1]]\r\n            }))\r\n        }\r\n    }, [simulator])\r\n\r\n    const onLoadClicked = useCallback(() => {\r\n        if (simulator) {\r\n            imageUrlToSimulatorMap(simulatorMapUrl, [gridSize[0], gridSize[1]], map => {\r\n                if (simulator) {\r\n                    simulator.loadPermeability(map.permeability)\r\n                    simulator.loadPermittivity(map.permittivity)\r\n                }\r\n            })\r\n        }\r\n    }, [simulator, gridSize, simulatorMapUrl])\r\n\r\n    return (\r\n        <div style={{ padding: \"10px\" }}>\r\n            <div>\r\n                <button onClick={onSaveClicked} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Save map</button>\r\n            </div>\r\n            <div>\r\n                <input type=\"text\" onChange={e => setSimulatorMapUrl(e.target.value)} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", margin: \"2px\" }} />\r\n                <button onClick={onLoadClicked} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Load map url</button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type SettingsComponentProps = {\r\n    gridSizeLongest: number\r\n    setGridSizeLongest: (gridSizeLongest: number) => void\r\n\r\n    dt: number\r\n    setDt: (dt: number) => void\r\n\r\n    cellSize: number\r\n    setCellSize: (cellSize: number) => void\r\n\r\n    simulationSpeed: number\r\n    setSimulationSpeed: (simulationSpeed: number) => void\r\n}\r\n\r\nexport function SettingsComponent(props: SettingsComponentProps) {\r\n    return (\r\n        <div style={{ padding: \"10px\" }}>\r\n            <LabeledSlider label=\"Grid length\" value={props.gridSizeLongest} setValue={props.setGridSizeLongest} min={100} max={2000} step={100} />\r\n            <LabeledSlider label=\"Time step size\" value={props.dt} setValue={props.setDt} min={0.001} max={0.1} step={0.001} />\r\n            <LabeledSlider label=\"Cell size\" value={props.cellSize} setValue={props.setCellSize} min={0.001} max={1} step={0.001} />\r\n            <LabeledSlider label=\"Simulation speed\" value={props.simulationSpeed} setValue={props.setSimulationSpeed} min={0.1} max={10} step={0.1} />\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type ControlComponentProps = {\r\n    brushSize: number,\r\n    setBrushSize: (brushSize: number) => void\r\n\r\n    brushValue: number\r\n    setBrushValue: (brushValue: number) => void\r\n\r\n    signalFrequency: number,\r\n    setSignalFrequency: (signalFrequency: number) => void\r\n\r\n    clickOption: number\r\n    setClickOption: (clickOption: number) => void\r\n\r\n    resetFields: () => void\r\n    resetMaterials: () => void\r\n}\r\n\r\nexport function ControlComponent(props: ControlComponentProps) {\r\n    return (\r\n        <div style={{ padding: \"10px\" }}>\r\n            <LabeledSlider label=\"Brush size\" value={props.brushSize} setValue={props.setBrushSize} min={1} max={100} step={1} />\r\n            <LabeledSlider label=\"Brush value\" value={props.brushValue} setValue={props.setBrushValue} min={1} max={100} step={1} />\r\n            <LabeledSlider label=\"Signal frequency\" value={props.signalFrequency} setValue={props.setSignalFrequency} min={0} max={25} step={0.25} />\r\n            <OptionSelector options={[\"ε brush\", \"µ brush\", \"Signal\"]} selectedOption={props.clickOption} setSelectedOption={props.setClickOption} />\r\n            <div>\r\n                <button onClick={props.resetFields} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Reset fields</button>\r\n                <button onClick={props.resetMaterials} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Reset materials</button>\r\n            </div>\r\n        </div>\r\n    )\r\n}","type SimulatorMap = {\r\n    permittivity: number[][]\r\n    permeability: number[][]\r\n    shape: [number, number]\r\n}\r\n\r\nexport function simulatorMapToImageUrl(simulatorMap: SimulatorMap): string {\r\n    const canvas = document.createElement(\"canvas\")\r\n    canvas.width = simulatorMap.shape[0]\r\n    canvas.height = simulatorMap.shape[1]\r\n\r\n    const permeability = simulatorMap.permeability\r\n    const permittivity = simulatorMap.permittivity\r\n\r\n    const ctx = canvas.getContext(\"2d\")!\r\n\r\n    ctx.fillStyle = \"rgb(1, 0, 1)\"\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height)\r\n\r\n    ctx.fillStyle = \"rgb(0, 255, 0)\"\r\n    ctx.textAlign = \"center\"\r\n    ctx.textBaseline = \"middle\"\r\n    ctx.fillText(\"warlock.ai/maxwell\", canvas.width / 2, canvas.height / 2)\r\n\r\n    const canvasData = ctx.getImageData(0, 0, canvas.width, canvas.height)\r\n\r\n    for (let x = 0; x < canvas.width; x++) {\r\n        for (let y = 0; y < canvas.height; y++) {\r\n            canvasData.data[x * 4 + y * canvas.width * 4 + 0] = Math.round(permittivity[y][x]) // r\r\n            canvasData.data[x * 4 + y * canvas.width * 4 + 2] = Math.round(permeability[y][x]) // b\r\n            canvasData.data[x * 4 + y * canvas.width * 4 + 3] = 255 // a\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(canvasData, 0, 0)\r\n\r\n    return canvas.toDataURL(\"image/png\")\r\n}\r\n\r\nexport function imageUrlToSimulatorMap(imageUrl: string, targetSize: [number, number], onLoaded: (simulatorMap: SimulatorMap) => void) {\r\n    const canvas = document.createElement(\"canvas\")\r\n    canvas.width = targetSize[0]\r\n    canvas.height = targetSize[1]\r\n    const image = new Image()\r\n    image.crossOrigin = \"anonymous\"\r\n    image.onload = e => {\r\n        const ctx = canvas.getContext(\"2d\")!\r\n\r\n        ctx.fillStyle = \"rgb(1, 0, 1)\"\r\n        ctx.fillRect(0, 0, canvas.width, canvas.height)\r\n\r\n        ctx.drawImage(image, 0, 0, image.width, image.height)\r\n\r\n        const map: SimulatorMap = { permeability: [], permittivity: [], shape: targetSize }\r\n\r\n        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data\r\n        for (let y = 0; y < targetSize[1]; y++) {\r\n            map.permittivity.push([])\r\n            map.permeability.push([])\r\n            for (let x = 0; x < targetSize[0]; x++) {\r\n                map.permittivity[y].push(Math.max(1, imageData[x * 4 + y * targetSize[0] * 4 + 0]))\r\n                map.permeability[y].push(Math.max(1, imageData[x * 4 + y * targetSize[0] * 4 + 2]))\r\n            }\r\n        }\r\n\r\n        onLoaded(map)\r\n    }\r\n    image.src = imageUrl\r\n}","import React, { useRef, useCallback, useEffect, useState, useMemo } from 'react'\nimport { GPU } from \"gpu.js\"\nimport { FDTDSimulator } from \"./simulator\"\nimport { CollapsibleContainer, ControlComponent, SaveLoadComponent, SettingsComponent } from './components'\n\n\nconst defaultSignalBrushValue = 10\nconst defaultSignalBrushSize = 1\nconst defaultMaterialBrushValue = 5\nconst defaultMaterialBrushSize = 5\n\nconst initialDt = 0.02\nconst initialCellSize = 0.04\nconst initialSimulationSpeed = 1\nconst initialGridSizeLongest = 600\nconst initialCanvasSize: [number, number] = [window.innerWidth, window.innerHeight]\nconst initialGridSize: [number, number] = calculateGridSize(initialGridSizeLongest, initialCanvasSize)\n\nfunction calculateGridSize(gridSizeLongest: number, canvasSize: [number, number]): [number, number] {\n    const canvasAspect = canvasSize[0] / canvasSize[1]\n\n    return canvasSize[0] >= canvasSize[1] ?\n        [gridSizeLongest, Math.ceil(gridSizeLongest / canvasAspect)] :\n        [Math.ceil(gridSizeLongest * canvasAspect), gridSizeLongest]\n}\n\nconst makeRenderSimulatorCanvas = (g: GPU, canvasSize: [number, number]) => {\n    function getAt(field: number[][], shapeX: number, shapeY: number, x: number, y: number) {\n        if (x < 0 || x >= shapeX || y < 0 || y >= shapeY) {\n            return 0\n        }\n\n        return field[y][x]\n    }\n\n    return g.createKernel(function (electricFieldX: number[][], electricFieldY: number[][], electricFieldZ: number[][],\n        magneticFieldX: number[][], magneticFieldY: number[][], magneticFieldZ: number[][],\n        permittivity: number[][], permeability: number[][], gridSize: number[]) {\n        const gx = gridSize[0]\n        const gy = gridSize[1]\n\n        const x = gx * this.thread.x! / (this.output.x as number)\n        const y = gy * (1 - this.thread.y! / (this.output.y as number))\n\n        const eAA =\n            getAt(electricFieldX, gx, gy, x, y) * getAt(electricFieldX, gx, gy, x, y) +\n            getAt(electricFieldY, gx, gy, x, y) * getAt(electricFieldY, gx, gy, x, y) +\n            getAt(electricFieldZ, gx, gy, x, y) * getAt(electricFieldZ, gx, gy, x, y)\n\n        // Magnetic field is offset from electric field, so get value at +0.5 by interpolating 0 and 1\n        const magXAA = getAt(magneticFieldX, gx, gy, x - 0.5, y - 0.5)\n        const magYAA = getAt(magneticFieldY, gx, gy, x - 0.5, y - 0.5)\n        const magZAA = getAt(magneticFieldZ, gx, gy, x - 0.5, y - 0.5)\n\n        const mAA = magXAA * magXAA + magYAA * magYAA + magZAA * magZAA\n\n        const scale = 15\n\n        // Material constants are between 1 and 100, so take log10 ([0, 2]) and divide by 2 to get full range\n        const permittivityValue = 0.3 + 0.7 * Math.max(0, Math.min(1, (0.4342944819 * Math.log(getAt(permittivity, gx, gy, x, y))) / 2))\n        const permeabilityValue = 0.3 + 0.7 * Math.max(0, Math.min(1, (0.4342944819 * Math.log(getAt(permeability, gx, gy, x, y))) / 2))\n\n        const backgroundX = (Math.abs(x % 1 - 0.5) < 0.25 ? 1 : 0) * (Math.abs(y % 1 - 0.5) < 0.25 ? 1 : 0)\n        const backgroundY = 1 - backgroundX\n\n        this.color(Math.min(1, eAA / scale + 0.5 * backgroundX * permittivityValue), Math.min(1, eAA / scale + mAA / scale), Math.min(1, mAA / scale + 0.5 * backgroundY * permeabilityValue))\n    }).setOutput(canvasSize).setGraphical(true).setFunctions([getAt]).setWarnVarUsage(false).setTactic(\"performance\").setPrecision(\"unsigned\").setDynamicOutput(true).setDynamicArguments(true)\n}\n\nfunction clamp(min: number, max: number, value: number) {\n    return Math.max(min, Math.min(max, value))\n}\n\nexport default function () {\n    const drawCanvasRef = useRef<HTMLCanvasElement>(null)\n\n    const [canvasSize, setCanvasSize] = useState<[number, number]>(initialCanvasSize)\n    const [gridSizeLongest, setGridSizeLongest] = useState(initialGridSizeLongest)\n    const [dt, setDt] = useState(initialDt)\n    const [cellSize, setCellSize] = useState(initialCellSize)\n    const [simulationSpeed, setSimulationSpeed] = useState(initialSimulationSpeed)\n\n    useEffect(() => {\n        const adjustCanvasSize = () => setCanvasSize([window.innerWidth, window.innerHeight])\n\n        window.addEventListener(\"resize\", adjustCanvasSize)\n        return () => window.removeEventListener(\"resize\", adjustCanvasSize)\n    }, [])\n\n    const gridSize = useMemo<[number, number]>(() => calculateGridSize(gridSizeLongest, canvasSize), [canvasSize, gridSizeLongest])\n\n    // Would use useMemo for gpu here, but useMemo does not seem to work with ref dependencies.\n    const [gpu, setGpu] = useState<GPU | null>(null)\n    useEffect(() => {\n        if (drawCanvasRef.current) {\n            setGpu(new GPU({ mode: \"webgl\", canvas: drawCanvasRef.current }))\n        }\n    }, [drawCanvasRef])\n\n    const simulator = useMemo(() => gpu ? new FDTDSimulator(gpu, initialGridSize, initialCellSize) : null, [gpu])\n    const renderSim = useMemo(() => gpu ? makeRenderSimulatorCanvas(gpu, initialGridSize) : null, [gpu])\n\n    // Update render sim output size\n    useEffect(() => {\n        if (renderSim) {\n            renderSim.setOutput(canvasSize)\n        }\n    }, [renderSim, canvasSize])\n\n    // Update simulator grid size\n    useEffect(() => {\n        if (simulator) {\n            simulator.setGridSize(gridSize)\n        }\n    }, [simulator, gridSize])\n\n    // Update simulator cell size\n    useEffect(() => {\n        if (simulator) {\n            simulator.setCellSize(cellSize)\n        }\n    }, [simulator, cellSize])\n\n    const [brushSize, setBrushSize] = useState(defaultSignalBrushSize)\n    const [brushValue, setBrushValue] = useState(defaultSignalBrushValue)\n    const [signalFrequency, setSignalFrequency] = useState(1)\n    const [drawingPermeability, setDrawingPermeability] = useState(false)\n    const [drawingPermittivity, setDrawingPermittivity] = useState(false)\n    const [clickOption, setClickOption] = useState(2) // eps, mu, signal\n    const optionPermittivityBrush = 0\n    const optionPermeabilityBrush = 1\n    const optionSignal = 2\n\n    const [mousePosition, setMousePosition] = useState<[number, number] | null>(null)\n\n    const signalStrength = useRef(0)\n    const mouseDownPos = useRef<[number, number] | null>(null)\n\n    const simStep = useCallback(() => {\n        if (simulator) {\n            const simData = simulator.getData()\n\n            if (mouseDownPos.current !== null) {\n                const centerX = clamp(0, gridSize[0] - 1, Math.floor(gridSize[0] * mouseDownPos.current[0] / canvasSize[0]))\n                const centerY = clamp(0, gridSize[1] - 1, Math.floor(gridSize[1] * mouseDownPos.current[1] / canvasSize[1]))\n                const brushHalfSize = Math.round(brushSize / 2)\n\n                simulator.injectSignal([centerX, centerY], brushHalfSize, -brushValue * 2000 * Math.cos(2 * Math.PI * signalFrequency * simData.time), dt)\n            }\n\n            simulator.stepMagnetic(dt)\n            simulator.stepElectric(dt)\n        }\n    }, [simulator, canvasSize, gridSize, dt, signalFrequency, brushValue, brushSize])\n\n    useEffect(() => {\n        const timer = setInterval(simStep, 1000 / simulationSpeed * dt)\n        return () => clearInterval(timer)\n    }, [simStep, dt, simulationSpeed])\n\n    const drawStep = useCallback(() => {\n        if (simulator && renderSim) {\n            if (drawCanvasRef.current) {\n                drawCanvasRef.current.width = window.innerWidth\n                drawCanvasRef.current.height = window.innerHeight\n            }\n\n            const simData = simulator.getData()\n\n            if (simData.time > 0) {\n                renderSim(simData.electricFieldX.values, simData.electricFieldY.values, simData.electricFieldZ.values,\n                    simData.magneticFieldX.values, simData.magneticFieldY.values, simData.magneticFieldZ.values,\n                    simData.permittivity.values, simData.permeability.values, gridSize)\n            }\n        }\n    }, [simulator, renderSim, gridSize, drawCanvasRef])\n\n    useEffect(() => {\n        let stop = false\n        const drawIfNotStopped = () => {\n            if (!stop) {\n                drawStep()\n                requestAnimationFrame(drawIfNotStopped)\n            }\n        }\n\n        requestAnimationFrame(drawIfNotStopped)\n\n        return () => { stop = true }\n    }, [drawStep])\n\n    const changePermittivity = useCallback((canvasPos: [number, number]) => {\n        if (simulator) {\n            const centerX = Math.round(gridSize[0] * (canvasPos[0] / canvasSize[0]))\n            const centerY = Math.round(gridSize[1] * (canvasPos[1] / canvasSize[1]))\n            const brushHalfSize = Math.round(brushSize / 2)\n\n            simulator.drawPermittivity([centerX, centerY, 0], brushHalfSize, brushValue)\n        }\n    }, [simulator, gridSize, canvasSize, brushSize, brushValue])\n\n    const changePermeability = useCallback((canvasPos: [number, number]) => {\n        if (simulator) {\n            const centerX = Math.round(gridSize[0] * (canvasPos[0] / canvasSize[0]))\n            const centerY = Math.round(gridSize[1] * (canvasPos[1] / canvasSize[1]))\n            const brushHalfSize = Math.round(brushSize / 2)\n\n            simulator.drawPermeability([centerX, centerY, 0], brushHalfSize, brushValue)\n        }\n    }, [simulator, gridSize, canvasSize, brushSize, brushValue])\n\n    const resetMaterials = useCallback(() => {\n        if (simulator) {\n            simulator.resetMaterials()\n        }\n    }, [simulator])\n\n    const resetFields = useCallback(() => {\n        if (simulator) {\n            simulator.resetFields()\n            signalStrength.current = 0\n        }\n    }, [simulator])\n\n    const onInputDown = useCallback(([clientX, clientY]: [number, number]) => {\n        if (simulator) {\n            if (clickOption === optionSignal) {\n                mouseDownPos.current = [clientX, clientY]\n            } else if (clickOption === optionPermittivityBrush) {\n                changePermittivity([clientX, clientY])\n                setDrawingPermittivity(true)\n            } else if (clickOption === optionPermeabilityBrush) {\n                changePermeability([clientX, clientY])\n                setDrawingPermeability(true)\n            }\n        }\n    }, [simulator, changePermittivity, changePermeability, clickOption])\n\n    const onInputMove = useCallback(([clientX, clientY]: [number, number]) => {\n        if (simulator) {\n            if (clickOption === optionSignal && mouseDownPos.current !== null) {\n                mouseDownPos.current = [clientX, clientY]\n            }\n\n            if (drawingPermittivity) {\n                changePermittivity([clientX, clientY])\n            }\n\n            if (drawingPermeability) {\n                changePermeability([clientX, clientY])\n            }\n        }\n    }, [simulator, changePermittivity, changePermeability, clickOption, drawingPermeability, drawingPermittivity])\n\n    const onInputUp = useCallback(() => {\n        if (clickOption === optionSignal) {\n            mouseDownPos.current = null\n        } else if (clickOption === optionPermeabilityBrush) {\n            setDrawingPermeability(false)\n        } else if (clickOption === optionPermittivityBrush) {\n            setDrawingPermittivity(false)\n        }\n    }, [clickOption])\n\n    // Remember old brush values for signal and material\n    const [previousClickOption, setPreviousClickOption] = useState(optionSignal)\n    const [signalBrushSize, setSignalBrushSize] = useState(defaultSignalBrushSize)\n    const [signalBrushValue, setSignalBrushValue] = useState(defaultSignalBrushValue)\n    const [materialBrushSize, setMaterialBrushSize] = useState(defaultMaterialBrushSize)\n    const [materialBrushValue, setMaterialBrushValue] = useState(defaultMaterialBrushValue)\n    useEffect(() => {\n        if (clickOption === optionSignal && previousClickOption !== optionSignal) {\n            setMaterialBrushSize(brushSize)\n            setMaterialBrushValue(brushValue)\n            setBrushSize(signalBrushSize)\n            setBrushValue(signalBrushValue)\n        } else if (clickOption !== optionSignal && previousClickOption === optionSignal) {\n            setSignalBrushSize(brushSize)\n            setSignalBrushValue(brushValue)\n            setBrushSize(materialBrushSize)\n            setBrushValue(materialBrushValue)\n        }\n\n        setPreviousClickOption(clickOption)\n    }, [clickOption, previousClickOption, signalBrushSize, signalBrushValue, materialBrushSize, materialBrushValue, brushSize, brushValue])\n\n    return (\n        <div style={{ touchAction: \"none\", userSelect: \"none\" }}>\n            <canvas width={canvasSize[0]} height={canvasSize[1]} ref={drawCanvasRef} style={{ position: \"absolute\", width: canvasSize[0], height: canvasSize[1] }}\n                onMouseDown={e => onInputDown([e.clientX, e.clientY])}\n                onMouseMove={e => { setMousePosition([e.clientX, e.clientY]); onInputMove([e.clientX, e.clientY]) }}\n                onMouseUp={e => onInputUp()}\n                onMouseLeave={e => onInputUp()}\n                onTouchStart={e => { setMousePosition([e.touches[0].clientX, e.touches[0].clientY]); onInputDown([e.touches[0].clientX, e.touches[0].clientY]) }}\n                onTouchMove={e => { setMousePosition([e.touches[0].clientX, e.touches[0].clientY]); onInputMove([e.touches[0].clientX, e.touches[0].clientY]) }}\n                onTouchEnd={e => { setMousePosition(null); onInputUp() }}\n                onTouchCancel={e => { setMousePosition(null); onInputUp() }}\n                onContextMenu={e => e.preventDefault()}\n            />\n\n            <div style={{ position: \"absolute\", bottom: 10, right: 10 }}>\n                <a href=\"https://github.com/RobinKa/maxwell-simulation\" rel=\"noopener noreferrer\" target=\"_blank\" style={{ fontWeight: \"lighter\", color: \"rgba(255, 255, 255, 100)\", textDecoration: \"none\" }}>Source code</a>\n            </div>\n\n            {mousePosition &&\n                <div style={{ position: \"absolute\", pointerEvents: \"none\", left: mousePosition[0] - (2 * (brushSize + 1)), top: mousePosition[1] - (2 * (brushSize + 1)), width: 4 * (brushSize + 1), height: 4 * (brushSize + 1), border: \"2px solid yellow\" }} />\n            }\n\n            <CollapsibleContainer title=\"Menu\" style={{ position: \"absolute\", opacity: 0.8, maxHeight: canvasSize[1], overflowY: \"auto\" }} buttonStyle={{background: \"rgb(60, 60, 60)\"}}>\n                <CollapsibleContainer title=\"Save / Load\">\n                    <SaveLoadComponent simulator={simulator} gridSize={gridSize} />\n                </CollapsibleContainer>\n                <CollapsibleContainer title=\"Settings\">\n                    <SettingsComponent\n                        gridSizeLongest={gridSizeLongest} setGridSizeLongest={setGridSizeLongest}\n                        simulationSpeed={simulationSpeed} setSimulationSpeed={setSimulationSpeed}\n                        cellSize={cellSize} setCellSize={setCellSize}\n                        dt={dt} setDt={setDt} />\n                </CollapsibleContainer>\n                <CollapsibleContainer title=\"Controls\">\n                    <ControlComponent\n                        brushSize={brushSize} setBrushSize={setBrushSize}\n                        brushValue={brushValue} setBrushValue={setBrushValue}\n                        signalFrequency={signalFrequency} setSignalFrequency={setSignalFrequency}\n                        clickOption={clickOption} setClickOption={setClickOption}\n                        resetFields={resetFields} resetMaterials={resetMaterials} />\n                </CollapsibleContainer>\n            </CollapsibleContainer>\n        </div>\n    )\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}