(this.webpackJsonpmaxwell=this.webpackJsonpmaxwell||[]).push([[0],{101:function(e,t,i){e.exports=i(221)},106:function(e,t,i){},216:function(e,t,i){},221:function(e,t,i){"use strict";i.r(t);var r=i(0),a=i.n(r),n=i(96),l=i.n(n),u=(i(106),i(7)),c=i(18),o=i(100),s=i(22),d=i(30),p=i(31);function h(e,t,i,r,a){return r<0||r>=t||a<0||a>=i?0:e[a][r]}function m(e){return e}function f(e){return e[this.thread.y][this.thread.x]}function b(e,t,i){var r=this.thread.x,a=this.thread.y;return r<0||a<0||r>=t[0]||a>=t[1]?i:e[a][r]}function g(e,t,i,r,a){var n=this.thread.x,l=this.thread.y,u=h(a,this.output.x,this.output.y,n,l);return Math.max(Math.abs(e[0]-n),Math.abs(e[1]-l))<t?i+r*u:u}function v(e,t,i,r,a){var n=this.thread.x,l=this.thread.y,u=h(a,this.output.x,this.output.y,n,l),c=e[0]-n,o=e[1]-l;return c*c+o*o<t*t?i+r*u:u}function y(e,t,i){var r=this.thread.x,a=this.thread.y,n=this.output.x,l=this.output.y;return h(t,n,l,r,a)+h(e,n,l,r,a)*i}function S(e,t){var i=this.thread.x,r=this.thread.y;return h(e,this.output.x,this.output.y,i,r)*Math.pow(.1,t)}function O(e,t,i,r,a,n,l){var u=this.thread.x,c=this.thread.y,o=this.output.x,s=this.output.y;if(!l){var d=u<2?1:0,p=u+2>=o?-1:0,m=c<2?1:0,f=c+2>=s?-1:0;if(0!==d||0!==p||0!==m||0!==f)return r[c+m+f][u+d+p]}return h(r,o,s,u,c)-a/(h(i,o,s,u,c)*n)*(h(t,o,s,u,c+1)-h(t,o,s,u,c))}function x(e,t,i,r,a,n,l){var u=this.thread.x,c=this.thread.y,o=this.output.x,s=this.output.y;if(!l){var d=u<2?1:0,p=u+2>=o?-1:0,m=c<2?1:0,f=c+2>=s?-1:0;if(0!==d||0!==p||0!==m||0!==f)return r[c+m+f][u+d+p]}return h(r,o,s,u,c)-a/(h(i,o,s,u,c)*n)*-(h(t,o,s,u+1,c)-h(t,o,s,u,c))}function j(e,t,i,r,a,n,l){var u=this.thread.x,c=this.thread.y,o=this.output.x,s=this.output.y;if(!l){var d=u<2?1:0,p=u+2>=o?-1:0,m=c<2?1:0,f=c+2>=s?-1:0;if(0!==d||0!==p||0!==m||0!==f)return r[c+m+f][u+d+p]}return h(r,o,s,u,c)-a/(h(i,o,s,u,c)*n)*(h(t,o,s,u+1,c)-h(t,o,s,u,c)-(h(e,o,s,u,c+1)-h(e,o,s,u,c)))}function w(e,t,i,r,a,n,l){var u=this.thread.x,c=this.thread.y,o=this.output.x,s=this.output.y;if(!l){var d=u<2?1:0,p=u+2>=o?-1:0,m=c<2?1:0,f=c+2>=s?-1:0;if(0!==d||0!==p||0!==m||0!==f)return r[c+m+f][u+d+p]}return h(r,o,s,u,c)+a/(h(i,o,s,u,c)*n)*(h(t,o,s,u,c)-h(t,o,s,u,c-1))}function E(e,t,i,r,a,n,l){var u=this.thread.x,c=this.thread.y,o=this.output.x,s=this.output.y;if(!l){var d=u<2?1:0,p=u+2>=o?-1:0,m=c<2?1:0,f=c+2>=s?-1:0;if(0!==d||0!==p||0!==m||0!==f)return r[c+m+f][u+d+p]}return h(r,o,s,u,c)+a/(h(i,o,s,u,c)*n)*-(h(t,o,s,u,c)-h(t,o,s,u-1,c))}function M(e,t,i,r,a,n,l){var u=this.thread.x,c=this.thread.y,o=this.output.x,s=this.output.y;if(!l){var d=u<2?1:0,p=u+2>=o?-1:0,m=c<2?1:0,f=c+2>=s?-1:0;if(0!==d||0!==p||0!==m||0!==f)return r[c+m+f][u+d+p]}return h(r,o,s,u,c)+a/(h(i,o,s,u,c)*n)*(h(t,o,s,u,c)-h(t,o,s,u-1,c)-(h(e,o,s,u,c)-h(e,o,s,u,c-1)))}function z(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function k(e,t,i){return{drawShape:"square",center:e,halfSize:t,value:i}}function C(e,t,i){return{drawShape:"circle",center:e,radius:t,value:i}}function A(e){var t={};return function(i){return t[i]||(t[i]=e()),t[i]}}var F=function e(t,i,r,a){var n=this;Object(p.a)(this,e),this.gpu=t,this.gridSize=i,this.cellSize=r,this.reflectiveBoundary=a,this.data=void 0,this.updateMagnetic=void 0,this.updateElectric=void 0,this.injectSource=void 0,this.decaySource=void 0,this.makeFieldTexture=void 0,this.copyTexture=void 0,this.copyTextureWithBounds=void 0,this.drawOnTexture=void 0,this.kernels=[],this.setGridSize=function(e){n.gridSize=e,n.kernels.forEach((function(t){return t.setOutput(e)}));for(var t=0;t<3;t++)n.data.electricField[t].shape=e,n.data.magneticField[t].shape=e;var i=n.data.permittivity.shape;n.data.permittivity.shape=e,n.data.permeability.shape=e,n.data.permittivity.values=n.copyTextureWithBounds("permittivity")(n.data.permittivity.values,i,1),n.data.permeability.values=n.copyTextureWithBounds("permeability")(n.data.permeability.values,i,1),n.resetFields()},this.setCellSize=function(e){n.cellSize=e,n.resetFields()},this.stepElectric=function(e){var t=n.data.electricField.map((function(e){return e.values})),i=n.data.magneticField.map((function(e){return e.values})),r=n.data.permittivity.values,a=n.injectSource(n.data.electricSourceFieldZ.values,t[2],e);n.data.electricSourceFieldZ.values=n.decaySource(n.copyTexture("es2")(n.data.electricSourceFieldZ.values),e),n.data.electricField[0].values=n.updateElectric[0](i[1],i[2],r,n.copyTexture("e0")(t[0]),e,n.cellSize,n.reflectiveBoundary),n.data.electricField[1].values=n.updateElectric[1](i[0],i[2],r,n.copyTexture("e1")(t[1]),e,n.cellSize,n.reflectiveBoundary),n.data.electricField[2].values=n.updateElectric[2](i[0],i[1],r,a,e,n.cellSize,n.reflectiveBoundary),n.data.time+=e/2},this.stepMagnetic=function(e){var t=n.data.electricField.map((function(e){return e.values})),i=n.data.magneticField.map((function(e){return e.values})),r=n.data.permeability.values;n.data.magneticField[0].values=n.updateMagnetic[0](t[1],t[2],r,n.copyTexture("m0")(i[0]),e,n.cellSize,n.reflectiveBoundary),n.data.magneticField[1].values=n.updateMagnetic[1](t[0],t[2],r,n.copyTexture("m1")(i[1]),e,n.cellSize,n.reflectiveBoundary),n.data.magneticField[2].values=n.updateMagnetic[2](t[0],t[1],r,n.copyTexture("m2")(i[2]),e,n.cellSize,n.reflectiveBoundary),n.data.time+=e/2},this.resetFields=function(){n.data.time=0;for(var e=0;e<3;e++)n.data.electricField[e].values=n.makeFieldTexture("e".concat(e))(0),n.data.magneticField[e].values=n.makeFieldTexture("m".concat(e))(0);n.data.electricSourceFieldZ.values=n.makeFieldTexture("es2")(0)},this.resetMaterials=function(){n.data.permeability.values=n.makeFieldTexture("permeability")(1),n.data.permittivity.values=n.makeFieldTexture("permittivity")(1)},this.drawShape=function(e,t,i,r){var a=n.drawOnTexture[i.drawShape](t),l=n.copyTexture(t)(e.values);switch(i.drawShape){case"square":e.values=a(i.center,i.halfSize,i.value,r,l);break;case"circle":e.values=a(i.center,i.radius,i.value,r,l);break;default:throw Error("Invalid draw shape: ".concat(JSON.stringify(i)))}},this.drawMaterial=function(e,t){var i="permeability"===e?n.data.permeability:n.data.permittivity;n.drawShape(i,e,t,0)},this.injectSignal=function(e,t){n.drawShape(n.data.electricSourceFieldZ,"es2",function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?z(i,!0).forEach((function(t){Object(d.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):z(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},e,{value:e.value*t}),1)},this.loadPermittivity=function(e){n.data.permittivity.values=n.copyTextureWithBounds("loadPermittivity")(e,[e[0].length,e.length],1)},this.loadPermeability=function(e){n.data.permeability.values=n.copyTextureWithBounds("loadPermeability")(e,[e[0].length,e.length],1)},this.getData=function(){return n.data};var l=function(e){var t=n.gpu.createKernel(e).setOutput(n.gridSize).setWarnVarUsage(!1).setPipeline(!0).setTactic("performance").setDynamicOutput(!0).setDynamicArguments(!0).setPrecision("single");return n.kernels.push(t),t},u=function(e){return l(e).setFunctions([h])},c=function(e){return u(e).setConstants({cellSize:r})};this.makeFieldTexture=A((function(){return l(m)})),this.copyTexture=A((function(){return l(f)})),this.copyTextureWithBounds=A((function(){return l(b)}));var o=function(e,t){return{values:n.makeFieldTexture(e)(t),shape:n.gridSize}};this.data={time:0,electricField:[0,1,2].map((function(e){return o("e".concat(e),0)})),magneticField:[0,1,2].map((function(e){return o("m".concat(e),0)})),electricSourceFieldZ:o("es2",0),permittivity:o("permittivity",1),permeability:o("permeability",1)},this.drawOnTexture={square:A((function(){return c(g)})),circle:A((function(){return c(v)}))},this.injectSource=u(y),this.decaySource=u(S),this.updateMagnetic=[c(O),c(x),c(j)],this.updateElectric=[c(w),c(E),c(M)]},T=i(48);function B(e){return{simulationSettings:e.simulationSettings,sourceDescriptors:e.sourceDescriptors,encodedMaterialMap:P(e.materialMap)}}function D(e){var t=q(e.encodedMaterialMap);return{simulationSettings:e.simulationSettings,sourceDescriptors:e.sourceDescriptors,materialMap:t}}function P(e){var t=new Float32Array(2+2*e.shape[0]*e.shape[1]);t[0]=e.shape[0],t[1]=e.shape[1];for(var i=0;i<e.shape[1];i++)for(var r=0;r<e.shape[0];r++){var a=i*e.shape[0]*2+2*r;t[2+a]=e.permittivity[i][r],t[2+a+1]=e.permeability[i][r]}return T.deflate(new Uint8Array(t.buffer),{to:"string"})}function q(e){for(var t=new Float32Array(T.inflate(e).buffer),i=[t[0],t[1]],r=[],a=[],n=0;n<i[1];n++){r.push([]),a.push([]);for(var l=0;l<i[0];l++){var u=n*i[0]*2+2*l;r[n].push(t[2+u]),a[n].push(t[2+u+1])}}return{shape:i,permittivity:r,permeability:a}}var V=function e(t,i,r,a){var n=this;Object(p.a)(this,e),this.amplitude=t,this.frequency=i,this.position=r,this.turnOffTime=a,this.inject=function(e,t){var i=e.getData().time;if(i>=0&&(void 0===n.turnOffTime||i<=n.turnOffTime)){var r=-n.amplitude*Math.cos(2*Math.PI*n.frequency*i),a=k(n.position,1,r);e.injectSignal(a,t)}}};var I=i(23),L=i.n(I),R=i(49),G="https://6xuthl3lv4.execute-api.us-east-1.amazonaws.com/live/share";function U(){return(U=Object(R.a)(L.a.mark((function e(t){var i,r,a;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(G,"?shareId=").concat(t));case 2:if(!(i=e.sent).ok){e.next=10;break}return e.next=6,i.text();case 6:if(!(r=e.sent)){e.next=10;break}return a=JSON.parse(r),e.abrupt("return",D(a));case 10:throw new Error("Invalid share");case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(){return(W=Object(R.a)(L.a.mark((function e(t){var i,r,a,n,l;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=B(t),e.next=3,fetch(G,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({encodedSimulatorMap:JSON.stringify(i)})});case 3:if(!(r=e.sent).ok){e.next=12;break}return e.next=7,r.json();case 7:if(!(a=e.sent)||!a.body){e.next=12;break}if(n=JSON.parse(a.body),!(l=n.shareId)){e.next=12;break}return e.abrupt("return",l);case 12:throw new Error("Failed share upload");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function J(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?N(i,!0).forEach((function(t){Object(d.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):N(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Y(e){var t=Object(r.useState)(void 0!==e.initiallyCollapsed&&e.initiallyCollapsed),i=Object(u.a)(t,2),n=i[0],l=i[1];return a.a.createElement("div",{id:e.id,className:e.className,style:J({textAlign:"center",background:"rgb(33, 33, 33)",fontWeight:"lighter",color:"white"},e.style)},a.a.createElement("button",{onClick:function(e){return l(!n)},style:J({width:"100%",height:"24px",background:"rgb(50, 50, 50)",border:"0px",color:"white",fontWeight:"bold",cursor:"pointer"},e.buttonStyle)},e.title?"".concat(e.title," "):"","[",n?"+":"-","]"),!n&&e.children)}function X(e){var t=e.value,i=e.setValue,n=e.allowNegative,l=e.logarithmic,c=e.displayDigits,o=l?Math.log2(Math.abs(t)):Math.abs(t),s=Object(r.useState)(t<0),d=Object(u.a)(s,2),p=d[0],h=d[1],m=Object(r.useRef)(null),f=Object(r.useCallback)((function(){if(m.current){var e=parseFloat(m.current.value);l&&(e=Math.pow(2,e)),i((p?-1:1)*e)}}),[i,p,l,m]);Object(r.useEffect)((function(){return f()}),[p,f]);var b=void 0!==c?t.toFixed(c):t;return a.a.createElement("div",null,a.a.createElement("label",null,e.label),n&&a.a.createElement(a.a.Fragment,null,a.a.createElement("input",{style:{marginLeft:"10px"},type:"checkbox",checked:p,onChange:function(e){return h(e.target.checked)}}),a.a.createElement("label",null,"Negative")),a.a.createElement("div",null,a.a.createElement("input",{type:"range",ref:m,min:e.min,max:e.max,value:o,step:e.step,onChange:f,style:{height:10,width:"100%"}}),a.a.createElement("div",{style:{textAlign:"center",lineHeight:.2,marginBottom:"7px"}},b)))}function K(e){return a.a.createElement("div",{style:e.style},e.options.map((function(t,i){return a.a.createElement("button",{key:t,style:J({backgroundColor:"rgb(50, 50, 50)",color:"white",border:i===e.selectedOption?"3px solid rgb(0, 150, 255)":"0",height:"30px",width:"70px",overflow:"hidden",textOverflow:"hidden"},e.buttonStyle),onClick:function(t){return e.setSelectedOption(i)}},t)})))}function Q(e){var t=e.shareId,i=e.setShareId,n=e.simulator,l=e.dt,c=e.cellSize,o=e.gridSize,s=Object(r.useState)(""),d=Object(u.a)(s,2),p=d[0],h=d[1],m=Object(r.useMemo)((function(){return function(){if(n){var e=n.getData();return{permittivity:e.permittivity.values.toArray(),permeability:e.permeability.values.toArray(),shape:[e.permeability.shape[0],e.permeability.shape[1]]}}return null}}),[n]),f=Object(r.useCallback)((function(){var e=m();e&&window.open(P(e))}),[m]),b=Object(r.useCallback)((function(){if(n){var e=q(p);n&&(n.loadPermeability(e.permeability),n.loadPermittivity(e.permittivity))}}),[n,p]),g=Object(r.useCallback)((function(){var e=m();e&&function(e){return W.apply(this,arguments)}({materialMap:e,simulationSettings:{cellSize:c,dt:l,gridSize:o,simulationSpeed:1},sourceDescriptors:[]}).then((function(e){return i(e)})).catch((function(e){return console.log("Error uploading share: "+JSON.stringify(e))}))}),[m,i,l,c,o]),v=Object(r.useMemo)((function(){return t?"".concat(window.location.origin,"/").concat(t):null}),[t]),y=Object(r.useRef)(null),S=Object(r.useCallback)((function(){y.current&&(y.current.select(),document.execCommand("copy"))}),[y]),O=Object(r.useMemo)((function(){var e=window.navigator;return e&&e.share?e.share:null}),[]),x=Object(r.useCallback)((function(){O&&O({title:"Interactive electromagnetic wave simulator",url:v}).then((function(){return console.log("Shared")})).catch((function(e){return console.error("Share failed: ".concat(JSON.stringify(e)))}))}),[v,O]);return a.a.createElement("div",{style:{padding:"10px",paddingTop:"0px"}},a.a.createElement("div",null,a.a.createElement("div",{style:{fontSize:"20px"}},"Share"),a.a.createElement("div",null,a.a.createElement("button",{onClick:g,style:{background:"rgba(50, 50, 50, 100)",border:"0px",color:"white",margin:"2px"}},"Generate share url")),a.a.createElement("div",null,v&&a.a.createElement("div",null,a.a.createElement("input",{ref:y,readOnly:!0,type:"text",value:v,style:{background:"rgba(50, 50, 50, 100)",border:"0px",color:"white",margin:"2px",width:"70%"}}),a.a.createElement("button",{onClick:S,style:{background:"rgba(50, 50, 50, 100)",border:"0px",color:"white",margin:"2px"}},"Copy"),O&&a.a.createElement("button",{onClick:x,style:{background:"rgba(50, 50, 50, 100)",border:"0px",color:"white",margin:"2px"}},"Share")))),a.a.createElement("div",{style:{marginTop:"5px"}},a.a.createElement("div",{style:{fontSize:"20px"}},"Material image"),a.a.createElement("div",null,a.a.createElement("button",{onClick:f,style:{background:"rgba(50, 50, 50, 100)",border:"0px",color:"white",margin:"2px"}},"Save")),a.a.createElement("div",null,a.a.createElement("input",{type:"text",onChange:function(e){return h(e.target.value)},style:{background:"rgba(50, 50, 50, 100)",border:"0px",color:"white",margin:"2px"}}),a.a.createElement("button",{onClick:b,style:{background:"rgba(50, 50, 50, 100)",border:"0px",color:"white",margin:"2px"}},"Load"))))}function Z(e){var t=e.simulator,i=e.setGridSizeLongest,n=e.setDt,l=e.setCellSize,u=e.setSimulationSpeed,c=e.setSources,o=Object(r.useCallback)((function(e){t&&(t.resetFields(),t.loadPermeability(e.materialMap.permeability),t.loadPermittivity(e.materialMap.permittivity));var r=e.sourceDescriptors.map((function(e){if("point"===e.type)return new V(e.amplitude,e.frequency,e.position,e.turnOffTime);throw new Error("Unsupported source type: ".concat(e.type))}));l(e.simulationSettings.cellSize),n(e.simulationSettings.dt),u(e.simulationSettings.simulationSpeed),i(Math.max(e.simulationSettings.gridSize[0],e.simulationSettings.gridSize[1])),c(r)}),[t,l,n,u,i,c]),s=Object(r.useMemo)((function(){return{dt:e.dt,cellSize:e.cellSize,gridSize:e.gridSize,simulationSpeed:e.simulationSpeed}}),[e.dt,e.cellSize,e.gridSize,e.simulationSpeed]);return a.a.createElement("div",{style:{padding:"10px"}},a.a.createElement("button",{onClick:function(e){return o(function(e){for(var t={permittivity:[],permeability:[],shape:e.gridSize},i=0;i<e.gridSize[1];i++)t.permittivity.push(new Array(e.gridSize[0]).fill(1)),t.permeability.push(new Array(e.gridSize[0]).fill(1));return{sourceDescriptors:[],simulationSettings:e,materialMap:t}}(s))},style:{backgroundColor:"rgb(50, 50, 50)",border:"0px",color:"white",margin:"2px"}},"Empty"),a.a.createElement("button",{onClick:function(e){return o(function(e){for(var t={permittivity:[],permeability:[],shape:e.gridSize},i=Math.round(.75*e.gridSize[0]),r=.2/e.cellSize,a=0;a<e.gridSize[1];a++){var n=Math.abs(a-e.gridSize[1]/5)<2,l=new Array(e.gridSize[0]).fill(n?100:1);if(n){for(var u=i-2*r;u<i-r;u++)l[u]=1;for(var c=i+2*r;c>i+r;c--)l[c]=1}t.permittivity.push(l),t.permeability.push(new Array(e.gridSize[0]).fill(1))}return{sourceDescriptors:[{type:"point",amplitude:3e4,frequency:3,position:[Math.round(i),Math.round(e.gridSize[1]/15)]}],simulationSettings:e,materialMap:t}}(s))},style:{backgroundColor:"rgb(50, 50, 50)",border:"0px",color:"white",margin:"2px"}},"Double slit"),a.a.createElement("button",{onClick:function(e){return o(function(e){for(var t={permittivity:[],permeability:[],shape:e.gridSize},i=0;i<e.gridSize[1];i++)t.permittivity.push(new Array(e.gridSize[0]).fill(1)),t.permeability.push(new Array(e.gridSize[0]).fill(1));function r(t){return[Math.round(3*e.gridSize[0]/4+e.gridSize[0]/5*.5/(2*t+1)*-Math.sin(2*Math.PI*t)),Math.round(e.gridSize[1]*(.1+.8*t))]}for(var a=.04/e.cellSize,n=0;n<100;n++)for(var l=r(n/100),u=-a+l[0];u<a+l[0];u++)for(var c=-a+l[1];c<a+l[1];c++)u>=0&&c>=0&&u<e.gridSize[0]&&c<e.gridSize[1]&&(t.permittivity[c][u]=2);var o=r(1);return{sourceDescriptors:[{type:"point",amplitude:8e3,frequency:5,position:[o[0]-1,o[1]],turnOffTime:.5},{type:"point",amplitude:8e3,frequency:5,position:[o[0]+2,o[1]],turnOffTime:.5}],simulationSettings:e,materialMap:t}}(s))},style:{backgroundColor:"rgb(50, 50, 50)",border:"0px",color:"white",margin:"2px"}},"Fiber optics"),a.a.createElement("button",{onClick:function(e){return o(function(e){var t={permittivity:[],permeability:[],shape:e.gridSize},i=[.6*e.gridSize[0],e.gridSize[1]/2];function r(t){var r=t[0]-i[0],a=t[1]-i[1];return 4*r*r+a*a<e.gridSize[0]*e.gridSize[0]/100}for(var a=0;a<e.gridSize[1];a++){t.permittivity.push([]),t.permeability.push(new Array(e.gridSize[0]).fill(1));for(var n=0;n<e.gridSize[0];n++)t.permittivity[a].push(r([n,a])?3:1)}return{sourceDescriptors:[{type:"point",amplitude:2e4,frequency:2,position:[Math.round(e.gridSize[0]/10),Math.round(e.gridSize[1]/2)],turnOffTime:.5}],simulationSettings:e,materialMap:t}}(s))},style:{backgroundColor:"rgb(50, 50, 50)",border:"0px",color:"white",margin:"2px"}},"Lens"))}function H(e){var t=e.qualityPresets,i=e.setCellSize,n=e.setGridSizeLongest,l=e.setResolutionScale,u=e.setDt,c=Object(r.useCallback)((function(e){i(e.cellSize),n(e.gridSizeLongest),l(e.resolutionScale),u(e.dt)}),[i,n,l,u]);return a.a.createElement("div",{style:{padding:"10px"}},a.a.createElement("div",null,"Quality presets"),a.a.createElement("div",null,Object.keys(t).map((function(e){return a.a.createElement("button",{key:e,onClick:function(i){return c(t[e])},style:{backgroundColor:"rgb(50, 50, 50)",border:"0px",color:"white",margin:"2px"}},e)}))),a.a.createElement(X,{label:"Grid length",value:e.gridSizeLongest,setValue:e.setGridSizeLongest,min:100,max:2e3,step:100}),a.a.createElement(X,{label:"Time step size",value:e.dt,setValue:e.setDt,min:.001,max:.1,step:.001,allowNegative:!0}),a.a.createElement(X,{label:"Cell size",value:e.cellSize,setValue:e.setCellSize,min:.002,max:.2,step:.001}),a.a.createElement(X,{label:"Resolution scale",value:e.resolutionScale,setValue:e.setResolutionScale,min:.1,max:2,step:.1}),a.a.createElement(X,{label:"Simulation speed",value:e.simulationSpeed,setValue:e.setSimulationSpeed,min:0,max:10,step:.1}),a.a.createElement("input",{type:"checkbox",checked:e.reflectiveBoundary,onChange:function(t){return e.setReflectiveBoundary(t.target.checked)}}),"Reflective boundary")}function _(e){var t=1===e.clickOption,i=e.drawShapeType,n=e.setDrawShapeType,l=Object(r.useMemo)((function(){return"square"===i?0:1}),[i]),u=Object(r.useCallback)((function(e){return n(0===e?"square":"circle")}),[n]),c=Object(r.useMemo)((function(){return"square"===i?"Brush size":"Brush radius"}),[i]);return a.a.createElement("div",{style:{padding:"10px"}},a.a.createElement("input",{type:"checkbox",checked:e.snapInput,onChange:function(t){return e.setSnapInput(t.target.checked)}}),a.a.createElement("label",null,"Snap to 45\xb0 line"),a.a.createElement(K,{buttonStyle:{height:"24px"},options:["Square","Circle"],selectedOption:l,setSelectedOption:u}),a.a.createElement("div",{style:{display:t?void 0:"none"}},a.a.createElement(X,{label:c,value:e.signalBrushSize,setValue:e.setSignalBrushSize,min:1,max:100,step:1}),a.a.createElement(X,{label:"Signal amplitude",value:e.signalBrushValue,setValue:e.setSignalBrushValue,min:1,max:100,step:1}),a.a.createElement(X,{label:"Signal frequency",value:e.signalFrequency,setValue:e.setSignalFrequency,min:0,max:25,step:.25})),a.a.createElement("div",{style:{display:t?"none":void 0}},a.a.createElement(X,{label:c,value:e.materialBrushSize,setValue:e.setMaterialBrushSize,min:1,max:100,step:1}),a.a.createElement(X,{label:"\u03b5 value",value:e.permittivityBrushValue,setValue:e.setPermittivityBrushValue,min:-1,max:10,step:.1,allowNegative:!0,logarithmic:!0,displayDigits:1}),a.a.createElement(X,{label:"\xb5 value",value:e.permeabilityBrushValue,setValue:e.setPermeabilityBrushValue,min:-1,max:10,step:.1,allowNegative:!0,logarithmic:!0,displayDigits:1})),a.a.createElement(K,{style:{margin:"10px"},options:["Material","Signal"],selectedOption:e.clickOption,setSelectedOption:e.setClickOption}),a.a.createElement("div",null,a.a.createElement("button",{onClick:e.resetFields,style:{backgroundColor:"rgb(50, 50, 50)",border:"0px",color:"white",margin:"2px",width:"130px"}},"Reset fields"),a.a.createElement("button",{onClick:e.resetMaterials,style:{backgroundColor:"rgb(50, 50, 50)",border:"0px",color:"white",margin:"2px",width:"130px"}},"Reset materials")))}function $(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}function ee(e,t,i){return Math.max(e,Math.min(t,i))}var te=i(97),ie=i.n(te);i(216);function re(e,t,i,r,a){return r<0||r>=t||a<0||a>=i?0:e[a][r]}function ae(e,t,i,r,a,n,l,u,c,o){var s=c[0],d=c[1],p=s*this.thread.x/this.output.x,h=d*(1-this.thread.y/this.output.y),m=4e-4/(o*o),f=re(e,s,d,p,h),b=re(t,s,d,p,h),g=re(i,s,d,p,h),v=m*m*(f*f+b*b+g*g),y=re(r,s,d,p-.5,h-.5),S=re(a,s,d,p-.5,h-.5),O=re(n,s,d,p-.5,h-.5),x=m*m*(y*y+S*S+O*O),j=2/(1+Math.exp(-.4*re(l,s,d,p,h)))-1,w=2/(1+Math.exp(-.4*re(u,s,d,p,h)))-1,E=Math.max(1,c[0]/this.output.x),M=Math.max(1,c[1]/this.output.y),z=(Math.abs(E*p%1-.5)<.25?1:0)*(Math.abs(M*h%1-.5)<.25?1:0),k=1-z;this.color(Math.min(1,v+.8*z*j),Math.min(1,v+x),Math.min(1,x+.8*k*w))}function ne(e,t,i,r,a,n,l,u,c,o){var s=c[0],d=c[1],p=s*this.thread.x/this.output.x,h=d*(1-this.thread.y/this.output.y),m=Math.round(p),f=Math.round(h),b=4e-4/(o*o),g=re(e,s,d,m,f),v=re(t,s,d,m,f),y=re(i,s,d,m,f),S=b*b*(g*g+v*v+y*y),O=re(r,s,d,m,f),x=re(a,s,d,m,f),j=re(n,s,d,m,f),w=b*b*(O*O+x*x+j*j),E=2/(1+Math.exp(-.4*re(l,s,d,m,f)))-1,M=2/(1+Math.exp(-.4*re(u,s,d,m,f)))-1,z=Math.max(1,c[0]/this.output.x),k=Math.max(1,c[1]/this.output.y),C=(Math.abs(z*p%1-.5)<.25?1:0)*(Math.abs(k*h%1-.5)<.25?1:0),A=1-C;this.color(Math.min(1,S+.8*C*E),Math.min(1,S+w),Math.min(1,w+.8*A*M))}var le={Low:{dt:.026,cellSize:.04,resolutionScale:.3,gridSizeLongest:200},Medium:{dt:.013,cellSize:.02,resolutionScale:1,gridSizeLongest:400},High:{dt:.0065,cellSize:.01,resolutionScale:1,gridSizeLongest:800},Ultra:{dt:.00325,cellSize:.005,resolutionScale:1,gridSizeLongest:1600}},ue=function(){if(s.GPU.isSinglePrecisionSupported){if(s.GPU.isWebGL2Supported)return"webgl2";if(s.GPU.isWebGLSupported)return"webgl"}return"cpu"}();console.log("Using GPU mode ".concat(ue));var ce="cpu"===ue?le.Low:le.Medium,oe=10,se=1,de="cpu"===ue?1:3,pe=5,he=1,me=5,fe="square",be=ce.dt,ge=ce.cellSize,ve=1,ye=ce.gridSizeLongest,Se=ce.resolutionScale,Oe=[window.innerWidth,window.innerHeight],xe=Ee(Oe,Se),je=Me(ye,xe),we=!1;function Ee(e,t){return[Math.round(e[0]*t),Math.round(e[1]*t)]}function Me(e,t){var i=t[0]/t[1];return t[0]>=t[1]?[e,Math.ceil(e/i)]:[Math.ceil(e*i),e]}var ze=function(e,t){return("cpu"!==ue?e.createKernel(ae):e.createKernel(ne)).setOutput(t).setGraphical(!0).setFunctions([re]).setWarnVarUsage(!1).setTactic("performance").setPrecision("unsigned").setDynamicOutput(!0).setDynamicArguments(!0)};function ke(){var e=Object(c.f)().shareId,t=Object(r.useState)(e||null),i=Object(u.a)(t,2),n=i[0],l=i[1],o=Object(r.useRef)(null),d=Object(r.useState)(xe),p=Object(u.a)(d,2),h=p[0],m=p[1],f=Object(r.useState)(Oe),b=Object(u.a)(f,2),g=b[0],v=b[1],y=Object(r.useState)(ye),S=Object(u.a)(y,2),O=S[0],x=S[1],j=Object(r.useState)(be),w=Object(u.a)(j,2),E=w[0],M=w[1],z=Object(r.useState)(ge),A=Object(u.a)(z,2),T=A[0],B=A[1],D=Object(r.useState)(Se),P=Object(u.a)(D,2),q=P[0],V=P[1],I=Object(r.useState)(ve),L=Object(u.a)(I,2),R=L[0],G=L[1],W=Object(r.useState)(we),N=Object(u.a)(W,2),J=N[0],X=N[1],K=Object(r.useState)([]),te=Object(u.a)(K,2),re=te[0],ae=te[1];Object(r.useEffect)((function(){var e=function(){var e=[window.innerWidth,window.innerHeight];m(Ee(e,q)),v(e)};return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[q]);var ne=Object(r.useMemo)((function(){return Me(O,h)}),[h,O]),ce=Object(r.useState)(null),ke=Object(u.a)(ce,2),Ce=ke[0],Ae=ke[1];Object(r.useEffect)((function(){o.current&&Ae(new s.GPU({mode:ue,canvas:o.current}))}),[o]);var Fe=Object(r.useMemo)((function(){return Ce?new F(Ce,je,ge,we):null}),[Ce]),Te=Object(r.useMemo)((function(){return Ce?ze(Ce,je):null}),[Ce]);Object(r.useEffect)((function(){Fe&&e&&(console.log("Loading ".concat(e)),function(e){return U.apply(this,arguments)}(e).then((function(t){Fe.loadPermittivity(t.materialMap.permittivity),Fe.loadPermeability(t.materialMap.permeability),M(t.simulationSettings.dt),x(Math.max(t.simulationSettings.gridSize[0],t.simulationSettings.gridSize[1])),B(t.simulationSettings.cellSize),console.log("Loaded ".concat(e))})).catch((function(t){return console.error("Error getting share ".concat(e,": ").concat(JSON.stringify(t)))})))}),[Fe,e]),Object(r.useEffect)((function(){Te&&Te.setOutput(h)}),[Te,h]),Object(r.useEffect)((function(){Fe&&Fe.setGridSize(ne)}),[Fe,ne]),Object(r.useEffect)((function(){Fe&&Fe.setCellSize(T)}),[Fe,T]),Object(r.useEffect)((function(){Fe&&(Fe.reflectiveBoundary=J)}),[Fe,J]);var Be=Object(r.useState)(se),De=Object(u.a)(Be,2),Pe=De[0],qe=De[1],Ve=Object(r.useState)(oe),Ie=Object(u.a)(Ve,2),Le=Ie[0],Re=Ie[1],Ge=Object(r.useState)(fe),Ue=Object(u.a)(Ge,2),We=Ue[0],Ne=Ue[1],Je=Object(r.useState)(me),Ye=Object(u.a)(Je,2),Xe=Ye[0],Ke=Ye[1],Qe=Object(r.useState)(pe),Ze=Object(u.a)(Qe,2),He=Ze[0],_e=Ze[1],$e=Object(r.useState)(he),et=Object(u.a)($e,2),tt=et[0],it=et[1],rt=Object(r.useState)(de),at=Object(u.a)(rt,2),nt=at[0],lt=at[1],ut=Object(r.useState)(!1),ct=Object(u.a)(ut,2),ot=ct[0],st=ct[1],dt=Object(r.useState)(1),pt=Object(u.a)(dt,2),ht=pt[0],mt=pt[1],ft=Object(r.useState)(null),bt=Object(u.a)(ft,2),gt=bt[0],vt=bt[1],yt=Object(r.useRef)(0),St=Object(r.useRef)(null),Ot=Object(r.useState)(!1),xt=Object(u.a)(Ot,2),jt=xt[0],wt=xt[1],Et=Object(r.useState)(null),Mt=Object(u.a)(Et,2),zt=Mt[0],kt=Mt[1],Ct=Object(r.useState)(null),At=Object(u.a)(Ct,2),Ft=At[0],Tt=At[1],Bt=Object(r.useMemo)((function(){return function(e){return[ee(0,ne[0]-1,Math.floor(ne[0]*e[0]/g[0])),ee(0,ne[1]-1,Math.floor(ne[1]*e[1]/g[1]))]}}),[g,ne]),Dt=Object(r.useCallback)((function(){if(Fe){var e=Fe.getData();if(null!==St.current){var t=Bt(St.current),i=Math.round(Pe/2),r=2e3*-Le*Math.cos(2*Math.PI*nt*e.time),a="square"===We?k(t,i,r):C(t,i,r);Fe.injectSignal(a,E)}var n=!0,l=!1,u=void 0;try{for(var c,o=re[Symbol.iterator]();!(n=(c=o.next()).done);n=!0){c.value.inject(Fe,E)}}catch(s){l=!0,u=s}finally{try{n||null==o.return||o.return()}finally{if(l)throw u}}Fe.stepMagnetic(E),Fe.stepElectric(E)}}),[Fe,E,nt,Le,Pe,re,Bt,We]);Object(r.useEffect)((function(){if(R>0){var e=setInterval(Dt,1e3/R*E);return function(){return clearInterval(e)}}}),[Dt,E,R]);var Pt=Object(r.useCallback)((function(){if(Fe&&Te){if(o.current){var e=Ee([window.innerWidth,window.innerHeight],q);o.current.width=e[0],o.current.height=e[1]}var t=Fe.getData();Te(t.electricField[0].values,t.electricField[1].values,t.electricField[2].values,t.magneticField[0].values,t.magneticField[1].values,t.magneticField[2].values,t.permittivity.values,t.permeability.values,ne,T)}}),[Fe,Te,ne,T,q,o]);Object(r.useEffect)((function(){var e=!1;return requestAnimationFrame((function t(){e||(Pt(),requestAnimationFrame(t))})),function(){e=!0}}),[Pt]);var qt=Object(r.useCallback)((function(e){if(Fe){var t=[Math.round(ne[0]*(e[0]/g[0])),Math.round(ne[1]*(e[1]/g[1]))],i=Math.round(Xe/2);Fe.drawMaterial("permittivity","square"===We?k(t,i,He):C(t,i,He)),Fe.drawMaterial("permeability","square"===We?k(t,i,tt):C(t,i,tt))}}),[Fe,ne,g,Xe,He,tt,We]),Vt=Object(r.useCallback)((function(){Fe&&Fe.resetMaterials()}),[Fe]),It=Object(r.useCallback)((function(){Fe&&(Fe.resetFields(),yt.current=0)}),[Fe]),Lt=Object(r.useCallback)((function(e){Fe&&(kt(e),1===ht?St.current=e:0===ht&&(qt(e),st(!0)))}),[Fe,qt,ht]),Rt=Object(r.useCallback)((function(e,t){if(Fe){var i=e;if((jt||t)&&zt){var r=[i[0]-zt[0],i[1]-zt[1]];if(Ft){var a=r[0]*Ft[0]+r[1]*Ft[1];i=[zt[0]+a*Ft[0],zt[1]+a*Ft[1]]}else{if(r[0]*r[0]+r[1]*r[1]>1e-4*(g[0]*g[0]+g[1]*g[1])){var n=Math.PI/4,l=Math.round(Math.atan2(r[1],r[0])/n)*n,u=[Math.cos(l),Math.sin(l)];Tt(u)}}}1===ht&&null!==St.current&&(St.current=i),ot&&qt(i)}}),[Fe,qt,ht,ot,Ft,zt,g,jt]),Gt=Object(r.useCallback)((function(){1===ht?St.current=null:0===ht&&st(!1),Tt(null),kt(null)}),[ht]),Ut=Object(r.useMemo)((function(){return(1===ht?Pe:Xe)*(h[0]/ne[0])}),[ht,Pe,Xe,h,ne]);return a.a.createElement("div",{style:{touchAction:"none",userSelect:"none"}},a.a.createElement("canvas",{width:h[0],height:h[1],ref:o,style:{position:"absolute",width:g[0],height:g[1]},onMouseDown:function(e){return Lt([e.clientX,e.clientY])},onMouseMove:function(e){vt([e.clientX,e.clientY]),Rt([e.clientX,e.clientY],e.shiftKey)},onMouseUp:function(e){return Gt()},onMouseLeave:function(e){return Gt()},onTouchStart:function(e){vt([e.touches[0].clientX,e.touches[0].clientY]),Lt([e.touches[0].clientX,e.touches[0].clientY])},onTouchMove:function(e){vt([e.touches[0].clientX,e.touches[0].clientY]),Rt([e.touches[0].clientX,e.touches[0].clientY])},onTouchEnd:function(e){vt(null),Gt()},onTouchCancel:function(e){vt(null),Gt()},onContextMenu:function(e){return e.preventDefault()}}),a.a.createElement("div",{style:{position:"absolute",bottom:10,right:10}},a.a.createElement("a",{href:"mailto:tora@warlock.ai?subject=EM simulation feedback",rel:"noopener noreferrer",target:"_blank",style:{fontWeight:"lighter",color:"rgba(255, 255, 255, 100)",textDecoration:"none",marginRight:"8px"}},"Feedback"),a.a.createElement("a",{href:"https://github.com/RobinKa/maxwell-simulation",rel:"noopener noreferrer",target:"_blank",style:{fontWeight:"lighter",color:"rgba(255, 255, 255, 100)",textDecoration:"none"}},"Source code")),gt&&("square"===We?a.a.createElement("div",{style:{position:"absolute",pointerEvents:"none",left:gt[0]-Ut/2,top:gt[1]-Ut/2,width:Ut,height:Ut,border:"2px solid yellow"}}):a.a.createElement("div",{style:{position:"absolute",pointerEvents:"none",left:gt[0]-Ut/2,top:gt[1]-Ut/2,width:Ut,height:Ut,border:"2px solid yellow",borderRadius:"50%"}})),"cpu"===ue&&a.a.createElement("div",{style:{position:"absolute",pointerEvents:"none",left:10,bottom:10,color:"red",fontWeight:"lighter"}},"Using CPU (WebGL with float textures unsupported by your device)"),a.a.createElement("img",{onClick:$,src:ie.a,alt:"Fullscreen",style:{position:"absolute",right:10,top:10,cursor:"pointer"}}),a.a.createElement(Y,{id:"Menu",title:"Menu",buttonStyle:{background:"rgb(60, 60, 60)"}},a.a.createElement(Y,{title:"Examples"},a.a.createElement(Z,{simulator:Fe,setCellSize:B,setDt:M,setGridSizeLongest:x,setSimulationSpeed:G,setSources:ae,gridSize:ne,dt:E,cellSize:T,simulationSpeed:R})),a.a.createElement(Y,{title:"Controls"},a.a.createElement(_,{signalBrushSize:Pe,setSignalBrushSize:qe,materialBrushSize:Xe,setMaterialBrushSize:Ke,signalBrushValue:Le,setSignalBrushValue:Re,permittivityBrushValue:He,setPermittivityBrushValue:_e,permeabilityBrushValue:tt,setPermeabilityBrushValue:it,signalFrequency:nt,setSignalFrequency:lt,clickOption:ht,setClickOption:mt,drawShapeType:We,setDrawShapeType:Ne,snapInput:jt,setSnapInput:wt,resetFields:It,resetMaterials:Vt})),a.a.createElement(Y,{title:"Share",initiallyCollapsed:!0},a.a.createElement(Q,{simulator:Fe,gridSize:ne,shareId:n,setShareId:l,cellSize:T,dt:E})),a.a.createElement(Y,{title:"Settings",initiallyCollapsed:!0},a.a.createElement(H,{gridSizeLongest:O,setGridSizeLongest:x,simulationSpeed:R,setSimulationSpeed:G,resolutionScale:q,setResolutionScale:V,cellSize:T,setCellSize:B,reflectiveBoundary:J,setReflectiveBoundary:X,dt:E,setDt:M,qualityPresets:le}))))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(a.a.createElement((function(){return a.a.createElement(o.a,null,a.a.createElement(c.c,null,a.a.createElement(c.a,{path:"/:shareId?",children:a.a.createElement(ke,null)})))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},97:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABISURBVFhH7dchDgAhDETRKfe/M1TUlgyqgv8Mq+AnQMjGTjJFqs+rlzlXjWMIIKC9Be6Jd3XrsAUEAAB4jgkYD+DPiIDfA6QD/j8gGcpVf+MAAAAASUVORK5CYII="}},[[101,1,2]]]);
//# sourceMappingURL=main.56bd63b9.chunk.js.map