{"version":3,"sources":["simulator.ts","sources.ts","components.tsx","serialization.ts","maps.ts","util.ts","App.tsx","serviceWorker.ts","index.tsx","icons/fullscreen.png"],"names":["memoByName","makeNew","memoized","name","FDTDSimulator","gpu","gridSize","cellSize","reflectiveBoundary","getAt","field","shapeX","shapeY","x","y","data","updateMagneticX","updateMagneticY","updateMagneticZ","updateElectricX","updateElectricY","updateElectricZ","injectSource","decaySource","makeFieldTexture","copyTexture","drawOnTexture","setGridSize","forEach","kernel","setOutput","electricFieldX","shape","electricFieldY","electricFieldZ","magneticFieldX","magneticFieldY","magneticFieldZ","permittivity","permeability","values","resetFields","setCellSize","stepElectric","dt","elX","elY","elZ","magX","magY","magZ","perm","injectedElZ","electricSourceFieldZ","time","stepMagnetic","resetMaterials","drawPermeability","pos","size","value","drawPermittivity","injectSignal","loadPermittivity","loadPermeability","getData","this","createKernel","setPipeline","setTactic","setDynamicOutput","setDynamicArguments","setPrecision","texture","thread","keep","oldValue","output","Math","max","abs","constants","setFunctions","setWarnVarUsage","source","gx","gy","pow","fieldY","fieldZ","magFieldX","cs","xAtMinBound","xAtMaxBound","yAtMinBound","yAtMaxBound","fieldX","magFieldY","magFieldZ","elFieldX","elFieldY","elFieldZ","PointSignalSource","amplitude","frequency","position","turnOffTime","inject","simulator","t","undefined","cos","PI","CollapsibleContainer","props","useState","initiallyCollapsed","collapsed","setCollapsed","id","className","style","textAlign","background","fontWeight","color","onClick","e","width","height","border","cursor","buttonStyle","title","children","LabeledSlider","label","type","min","step","onChange","setValue","parseFloat","target","lineHeight","marginBottom","OptionSelector","margin","options","map","option","optionIndex","buttonClassName","key","backgroundColor","selectedOption","overflow","textOverflow","setSelectedOption","SaveLoadComponent","simulatorMapUrl","setSimulatorMapUrl","onSaveClicked","useCallback","simData","window","open","materialMap","canvas","document","createElement","ctx","getContext","fillStyle","fillRect","textBaseline","fillText","canvasData","getImageData","round","putImageData","toDataURL","encodeMaterialMap","toArray","onLoadClicked","encodedMaterialMap","targetSize","onLoaded","image","Image","crossOrigin","onload","drawImage","imageData","push","src","decodeMaterialMap","padding","ExamplesComponent","setGridSizeLongest","setDt","setSimulationSpeed","setSources","loadMap","simulatorMap","loadedSources","sourcesDescriptors","desc","Error","simulationSettings","simulationSpeed","useMemo","_","Array","fill","maps","slitCenterX","isWallRow","permittivityRow","getCurvePoint","sin","endPoint","center","isLensPoint","point","dx","dy","SettingsComponent","gridSizeLongest","resolutionScale","setResolutionScale","checked","setReflectiveBoundary","ControlComponent","brushSize","setBrushSize","brushValue","setBrushValue","signalFrequency","setSignalFrequency","clickOption","setClickOption","toggleFullScreen","fullscreenElement","exitFullscreen","documentElement","requestFullscreen","gpuMode","GPU","isSinglePrecisionSupported","isWebGL2Supported","isWebGLSupported","getGpuMode","console","log","defaultSignalBrushValue","defaultSignalFrequency","initialDt","initialCellSize","initialGridSizeLongest","initialResolutionScale","initialWindowSize","innerWidth","innerHeight","initialCanvasSize","calculateCanvasSize","initialGridSize","calculateGridSize","windowSize","canvasSize","canvasAspect","ceil","clamp","Boolean","location","hostname","match","ReactDOM","render","drawCanvasRef","useRef","setCanvasSize","setWindowSize","sources","useEffect","adjustCanvasSize","wndSize","addEventListener","removeEventListener","setGpu","current","mode","renderSim","g","eAA","magXAA","magYAA","magZAA","mAA","permittivityValue","exp","permeabilityValue","backgroundX","backgroundY","fx","fy","setGraphical","makeRenderSimulatorCanvas","drawingPermeability","setDrawingPermeability","drawingPermittivity","setDrawingPermittivity","mousePosition","setMousePosition","signalStrength","mouseDownPos","windowToSimulationPoint","windowPoint","floor","simStep","brushHalfSize","timer","setInterval","clearInterval","drawStep","cnvSize","stop","requestAnimationFrame","drawIfNotStopped","changeMaterial","canvasPos","material","centerX","centerY","onInputDown","clientX","clientY","onInputMove","onInputUp","previousClickOption","setPreviousClickOption","signalBrushSize","setSignalBrushSize","signalBrushValue","setSignalBrushValue","materialBrushSize","setMaterialBrushSize","materialBrushValue","setMaterialBrushValue","touchAction","userSelect","ref","onMouseDown","onMouseMove","onMouseUp","onMouseLeave","onTouchStart","touches","onTouchMove","onTouchEnd","onTouchCancel","onContextMenu","preventDefault","bottom","right","href","rel","textDecoration","pointerEvents","left","top","Fullscreen","alt","getElementById","navigator","serviceWorker","ready","then","registration","unregister","module","exports"],"mappings":"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","file":"static/js/main.43ed5166.chunk.js","sourcesContent":["import { GPU, IKernelRunShortcut, Texture } from \"gpu.js\"\r\n\r\nexport type ScalarField2D = {\r\n    values: Texture\r\n    shape: [number, number]\r\n}\r\n\r\nexport type SimulationData = {\r\n    time: number\r\n    electricFieldX: ScalarField2D\r\n    electricFieldY: ScalarField2D\r\n    electricFieldZ: ScalarField2D\r\n    magneticFieldX: ScalarField2D\r\n    magneticFieldY: ScalarField2D\r\n    magneticFieldZ: ScalarField2D\r\n\r\n    permittivity: ScalarField2D\r\n    permeability: ScalarField2D\r\n\r\n    electricSourceFieldZ: ScalarField2D\r\n}\r\n\r\nexport interface Simulator {\r\n    stepElectric: (dt: number) => void\r\n    stepMagnetic: (dt: number) => void\r\n    resetFields: () => void\r\n    resetMaterials: () => void\r\n    injectSignal: (pos: [number, number], size: number, value: number, dt: number) => void\r\n    getData: () => SimulationData\r\n}\r\n\r\nfunction memoByName<T>(makeNew: () => T) {\r\n    const memoized: { [name: string]: T } = {}\r\n\r\n    return (name: string) => {\r\n        if (!memoized[name]) {\r\n            memoized[name] = makeNew()\r\n        }\r\n        return memoized[name]\r\n    }\r\n}\r\n\r\nexport class FDTDSimulator implements Simulator {\r\n    private data: SimulationData\r\n\r\n    private updateMagneticX: IKernelRunShortcut\r\n    private updateMagneticY: IKernelRunShortcut\r\n    private updateMagneticZ: IKernelRunShortcut\r\n    private updateElectricX: IKernelRunShortcut\r\n    private updateElectricY: IKernelRunShortcut\r\n    private updateElectricZ: IKernelRunShortcut\r\n\r\n    private injectSource: IKernelRunShortcut\r\n    private decaySource: IKernelRunShortcut\r\n\r\n    private makeFieldTexture: (name: string) => IKernelRunShortcut\r\n    private copyTexture: (name: string) => IKernelRunShortcut\r\n\r\n    private drawOnTexture: (name: string) => IKernelRunShortcut\r\n\r\n    constructor(readonly gpu: GPU, private gridSize: [number, number], private cellSize: number, public reflectiveBoundary: boolean) {\r\n        this.makeFieldTexture = memoByName(() => this.gpu.createKernel(function (value: number) {\r\n            return value\r\n        }).setOutput(this.gridSize).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true).setPrecision(\"single\"))\r\n\r\n        this.copyTexture = memoByName(() => this.gpu.createKernel(function (texture: number[][]) {\r\n            return texture[this.thread.y!][this.thread.x]\r\n        }).setOutput(this.gridSize).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true).setPrecision(\"single\"))\r\n\r\n        this.data = {\r\n            time: 0,\r\n            electricFieldX: { values: this.makeFieldTexture(\"ex\")(0) as Texture, shape: this.gridSize },\r\n            electricFieldY: { values: this.makeFieldTexture(\"ey\")(0) as Texture, shape: this.gridSize },\r\n            electricFieldZ: { values: this.makeFieldTexture(\"ez\")(0) as Texture, shape: this.gridSize },\r\n            magneticFieldX: { values: this.makeFieldTexture(\"mx\")(0) as Texture, shape: this.gridSize },\r\n            magneticFieldY: { values: this.makeFieldTexture(\"my\")(0) as Texture, shape: this.gridSize },\r\n            magneticFieldZ: { values: this.makeFieldTexture(\"mz\")(0) as Texture, shape: this.gridSize },\r\n            electricSourceFieldZ: { values: this.makeFieldTexture(\"esz\")(0) as Texture, shape: this.gridSize },\r\n            permittivity: { values: this.makeFieldTexture(\"permittivity\")(1) as Texture, shape: this.gridSize },\r\n            permeability: { values: this.makeFieldTexture(\"permeability\")(1) as Texture, shape: this.gridSize },\r\n        }\r\n\r\n        function getAt(field: number[][], shapeX: number, shapeY: number, x: number, y: number) {\r\n            if (x < 0 || x >= shapeX || y < 0 || y >= shapeY) {\r\n                return 0\r\n            }\r\n\r\n            return field[y][x]\r\n        }\r\n\r\n        this.drawOnTexture = memoByName(() => this.gpu.createKernel(function (pos: number[], size: number, value: number, keep: number, texture: number[][]) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            const oldValue = getAt(texture, gx, gy, x, y)\r\n\r\n            const within = Math.max(Math.abs(pos[0] - x), Math.abs(pos[1] - y)) < size\r\n\r\n            return within ? value + keep * oldValue : oldValue\r\n        }, {\r\n            constants: { cellSize: cellSize },\r\n        }).setOutput(this.gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true).setPrecision(\"single\"))\r\n\r\n        this.injectSource = this.gpu.createKernel(function (source: number[][], field: number[][], dt: number) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            return getAt(field, gx, gy, x, y) + getAt(source, gx, gy, x, y) * dt\r\n        }).setOutput(this.gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true).setPrecision(\"single\")\r\n\r\n        this.decaySource = this.gpu.createKernel(function (source: number[][], dt: number) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            return getAt(source, gx, gy, x, y) * Math.pow(0.1, dt)\r\n        }).setOutput(this.gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true).setPrecision(\"single\")\r\n\r\n        this.updateMagneticX = this.gpu.createKernel(function (fieldY: number[][], fieldZ: number[][], permeability: number[][], magFieldX: number[][], dt: number, cs: number, reflectiveBoundary: boolean) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            if (!reflectiveBoundary) {\r\n                const xAtMinBound = x < 2 ? 1 : 0\r\n                const xAtMaxBound = x + 2 >= gx ? -1 : 0\r\n                const yAtMinBound = y < 2 ? 1 : 0\r\n                const yAtMaxBound = y + 2 >= gy ? -1 : 0\r\n                if (xAtMinBound !== 0 || xAtMaxBound !== 0 || yAtMinBound !== 0 || yAtMaxBound !== 0) {\r\n                    return magFieldX[y + yAtMinBound + yAtMaxBound][x + xAtMinBound + xAtMaxBound]\r\n                }\r\n            }\r\n\r\n            // d_Y Z - d_Z Y\r\n            return getAt(magFieldX, gx, gy, x, y) - (dt / (getAt(permeability, gx, gy, x, y) * cs)) * (\r\n                (getAt(fieldZ, gx, gy, x, y + 1) - getAt(fieldZ, gx, gy, x, y)))\r\n        }, {\r\n            constants: { cellSize: cellSize },\r\n        }).setOutput(this.gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true).setPrecision(\"single\")\r\n\r\n        this.updateMagneticY = this.gpu.createKernel(function (fieldX: number[][], fieldZ: number[][], permeability: number[][], magFieldY: number[][], dt: number, cs: number, reflectiveBoundary: boolean) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            if (!reflectiveBoundary) {\r\n                const xAtMinBound = x < 2 ? 1 : 0\r\n                const xAtMaxBound = x + 2 >= gx ? -1 : 0\r\n                const yAtMinBound = y < 2 ? 1 : 0\r\n                const yAtMaxBound = y + 2 >= gy ? -1 : 0\r\n                if (xAtMinBound !== 0 || xAtMaxBound !== 0 || yAtMinBound !== 0 || yAtMaxBound !== 0) {\r\n                    return magFieldY[y + yAtMinBound + yAtMaxBound][x + xAtMinBound + xAtMaxBound]\r\n                }\r\n            }\r\n\r\n            // d_Z X - d_X Z\r\n            return getAt(magFieldY, gx, gy, x, y) - (dt / (getAt(permeability, gx, gy, x, y) * cs)) * (\r\n                -(getAt(fieldZ, gx, gy, x + 1, y) - getAt(fieldZ, gx, gy, x, y)))\r\n        }, {\r\n            constants: { cellSize: cellSize },\r\n        }).setOutput(this.gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true).setPrecision(\"single\")\r\n\r\n        this.updateMagneticZ = this.gpu.createKernel(function (fieldX: number[][], fieldY: number[][], permeability: number[][], magFieldZ: number[][], dt: number, cs: number, reflectiveBoundary: boolean) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            if (!reflectiveBoundary) {\r\n                const xAtMinBound = x < 2 ? 1 : 0\r\n                const xAtMaxBound = x + 2 >= gx ? -1 : 0\r\n                const yAtMinBound = y < 2 ? 1 : 0\r\n                const yAtMaxBound = y + 2 >= gy ? -1 : 0\r\n                if (xAtMinBound !== 0 || xAtMaxBound !== 0 || yAtMinBound !== 0 || yAtMaxBound !== 0) {\r\n                    return magFieldZ[y + yAtMinBound + yAtMaxBound][x + xAtMinBound + xAtMaxBound]\r\n                }\r\n            }\r\n\r\n            // d_X Y - d_Y X\r\n            return getAt(magFieldZ, gx, gy, x, y) - (dt / (getAt(permeability, gx, gy, x, y) * cs)) * (\r\n                (getAt(fieldY, gx, gy, x + 1, y) - getAt(fieldY, gx, gy, x, y)) -\r\n                (getAt(fieldX, gx, gy, x, y + 1) - getAt(fieldX, gx, gy, x, y)))\r\n        }, {\r\n            constants: { cellSize: cellSize },\r\n        }).setOutput(this.gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true).setPrecision(\"single\")\r\n\r\n        this.updateElectricX = this.gpu.createKernel(function (fieldY: number[][], fieldZ: number[][], permittivity: number[][], elFieldX: number[][], dt: number, cs: number, reflectiveBoundary: boolean) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            if (!reflectiveBoundary) {\r\n                const xAtMinBound = x < 2 ? 1 : 0\r\n                const xAtMaxBound = x + 2 >= gx ? -1 : 0\r\n                const yAtMinBound = y < 2 ? 1 : 0\r\n                const yAtMaxBound = y + 2 >= gy ? -1 : 0\r\n                if (xAtMinBound !== 0 || xAtMaxBound !== 0 || yAtMinBound !== 0 || yAtMaxBound !== 0) {\r\n                    return elFieldX[y + yAtMinBound + yAtMaxBound][x + xAtMinBound + xAtMaxBound]\r\n                }\r\n            }\r\n\r\n            // d_Y Z - d_Z Y\r\n            return getAt(elFieldX, gx, gy, x, y) + (dt / (getAt(permittivity, gx, gy, x, y) * cs)) * (\r\n                (getAt(fieldZ, gx, gy, x, y) - getAt(fieldZ, gx, gy, x, y - 1)))\r\n        }, {\r\n            constants: { cellSize: cellSize },\r\n        }).setOutput(this.gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true).setPrecision(\"single\")\r\n\r\n        this.updateElectricY = this.gpu.createKernel(function (fieldX: number[][], fieldZ: number[][], permittivity: number[][], elFieldY: number[][], dt: number, cs: number, reflectiveBoundary: boolean) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            if (!reflectiveBoundary) {\r\n                const xAtMinBound = x < 2 ? 1 : 0\r\n                const xAtMaxBound = x + 2 >= gx ? -1 : 0\r\n                const yAtMinBound = y < 2 ? 1 : 0\r\n                const yAtMaxBound = y + 2 >= gy ? -1 : 0\r\n                if (xAtMinBound !== 0 || xAtMaxBound !== 0 || yAtMinBound !== 0 || yAtMaxBound !== 0) {\r\n                    return elFieldY[y + yAtMinBound + yAtMaxBound][x + xAtMinBound + xAtMaxBound]\r\n                }\r\n            }\r\n\r\n            // d_Z X - d_X Z\r\n            return getAt(elFieldY, gx, gy, x, y) + (dt / (getAt(permittivity, gx, gy, x, y) * cs)) * (\r\n                -(getAt(fieldZ, gx, gy, x, y) - getAt(fieldZ, gx, gy, x - 1, y)))\r\n        }, {\r\n            constants: { cellSize: cellSize },\r\n        }).setOutput(this.gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true).setPrecision(\"single\")\r\n\r\n        this.updateElectricZ = this.gpu.createKernel(function (fieldX: number[][], fieldY: number[][], permittivity: number[][], elFieldZ: number[][], dt: number, cs: number, reflectiveBoundary: boolean) {\r\n            const x = this.thread.x as number\r\n            const y = this.thread.y! as number\r\n            const gx = this.output.x as number\r\n            const gy = this.output.y as number\r\n\r\n            if (!reflectiveBoundary) {\r\n                const xAtMinBound = x < 2 ? 1 : 0\r\n                const xAtMaxBound = x + 2 >= gx ? -1 : 0\r\n                const yAtMinBound = y < 2 ? 1 : 0\r\n                const yAtMaxBound = y + 2 >= gy ? -1 : 0\r\n                if (xAtMinBound !== 0 || xAtMaxBound !== 0 || yAtMinBound !== 0 || yAtMaxBound !== 0) {\r\n                    return elFieldZ[y + yAtMinBound + yAtMaxBound][x + xAtMinBound + xAtMaxBound]\r\n                }\r\n            }\r\n\r\n            // d_X Y - d_Y X\r\n            return getAt(elFieldZ, gx, gy, x, y) + (dt / (getAt(permittivity, gx, gy, x, y) * cs)) * (\r\n                (getAt(fieldY, gx, gy, x, y) - getAt(fieldY, gx, gy, x - 1, y)) -\r\n                (getAt(fieldX, gx, gy, x, y) - getAt(fieldX, gx, gy, x, y - 1)))\r\n        }, {\r\n            constants: { cellSize: cellSize },\r\n        }).setOutput(this.gridSize).setFunctions([getAt]).setWarnVarUsage(false).setPipeline(true).setTactic(\"performance\").setDynamicOutput(true).setDynamicArguments(true).setPrecision(\"single\")\r\n    }\r\n\r\n    setGridSize = (gridSize: [number, number]) => {\r\n        this.gridSize = gridSize\r\n\r\n        const kernels = [\r\n            this.updateElectricX,\r\n            this.updateElectricY,\r\n            this.updateElectricZ,\r\n            this.updateMagneticX,\r\n            this.updateMagneticY,\r\n            this.updateMagneticZ,\r\n            this.injectSource,\r\n            this.decaySource,\r\n            this.makeFieldTexture(\"ex\"),\r\n            this.makeFieldTexture(\"ey\"),\r\n            this.makeFieldTexture(\"ez\"),\r\n            this.makeFieldTexture(\"mx\"),\r\n            this.makeFieldTexture(\"my\"),\r\n            this.makeFieldTexture(\"mz\"),\r\n            this.makeFieldTexture(\"esz\"),\r\n            this.makeFieldTexture(\"permeability\"),\r\n            this.makeFieldTexture(\"permittivity\"),\r\n            this.copyTexture(\"loadPermittivity\"),\r\n            this.copyTexture(\"loadPermittivity\"),\r\n            this.copyTexture(\"permeability\"),\r\n            this.copyTexture(\"permittivity\"),\r\n            this.copyTexture(\"ex\"),\r\n            this.copyTexture(\"ey\"),\r\n            this.copyTexture(\"esz\"),\r\n            this.copyTexture(\"mx\"),\r\n            this.copyTexture(\"my\"),\r\n            this.copyTexture(\"mz\"),\r\n            this.drawOnTexture(\"esz\"),\r\n            this.drawOnTexture(\"permeability\"),\r\n            this.drawOnTexture(\"permittivity\")\r\n        ]\r\n\r\n        kernels.forEach(kernel => kernel.setOutput(gridSize))\r\n\r\n        this.data.electricFieldX.shape = gridSize\r\n        this.data.electricFieldY.shape = gridSize\r\n        this.data.electricFieldZ.shape = gridSize\r\n        this.data.magneticFieldX.shape = gridSize\r\n        this.data.magneticFieldY.shape = gridSize\r\n        this.data.magneticFieldZ.shape = gridSize\r\n        this.data.permittivity.shape = gridSize\r\n        this.data.permeability.shape = gridSize\r\n\r\n        // TODO: Copy only the valid fraction. This one will potentially copy out of bounds.\r\n        this.data.permittivity.values = this.copyTexture(\"permittivity\")(this.data.permittivity.values) as Texture\r\n        this.data.permeability.values = this.copyTexture(\"permeability\")(this.data.permeability.values) as Texture\r\n\r\n        this.resetFields()\r\n    }\r\n\r\n    setCellSize = (cellSize: number) => {\r\n        this.cellSize = cellSize\r\n\r\n        this.resetFields()\r\n    }\r\n\r\n    stepElectric = (dt: number) => {\r\n        const elX = this.data.electricFieldX.values\r\n        const elY = this.data.electricFieldY.values\r\n        const elZ = this.data.electricFieldZ.values\r\n        const magX = this.data.magneticFieldX.values\r\n        const magY = this.data.magneticFieldY.values\r\n        const magZ = this.data.magneticFieldZ.values\r\n        const perm = this.data.permittivity.values\r\n\r\n        const injectedElZ = this.injectSource(this.data.electricSourceFieldZ.values, elZ, dt) as Texture\r\n        this.data.electricSourceFieldZ.values = this.decaySource(this.copyTexture(\"esz\")(this.data.electricSourceFieldZ.values), dt) as Texture\r\n\r\n        // d/dt E(x, t) = (curl B(x, t))/(µε)\r\n        this.data.electricFieldX.values = this.updateElectricX(magY, magZ, perm, this.copyTexture(\"ex\")(elX), dt, this.cellSize, this.reflectiveBoundary) as Texture\r\n        this.data.electricFieldY.values = this.updateElectricY(magX, magZ, perm, this.copyTexture(\"ey\")(elY), dt, this.cellSize, this.reflectiveBoundary) as Texture\r\n        this.data.electricFieldZ.values = this.updateElectricZ(magX, magY, perm, injectedElZ, dt, this.cellSize, this.reflectiveBoundary) as Texture\r\n\r\n        this.data.time += dt / 2\r\n    }\r\n\r\n    stepMagnetic = (dt: number) => {\r\n        const elX = this.data.electricFieldX.values\r\n        const elY = this.data.electricFieldY.values\r\n        const elZ = this.data.electricFieldZ.values\r\n        const magX = this.data.magneticFieldX.values\r\n        const magY = this.data.magneticFieldY.values\r\n        const magZ = this.data.magneticFieldZ.values\r\n        const perm = this.data.permeability.values\r\n\r\n        // d/dt B(x, t) = -curl E(x, t)\r\n        this.data.magneticFieldX.values = this.updateMagneticX(elY, elZ, perm, this.copyTexture(\"mx\")(magX), dt, this.cellSize, this.reflectiveBoundary) as Texture\r\n        this.data.magneticFieldY.values = this.updateMagneticY(elX, elZ, perm, this.copyTexture(\"my\")(magY), dt, this.cellSize, this.reflectiveBoundary) as Texture\r\n        this.data.magneticFieldZ.values = this.updateMagneticZ(elX, elY, perm, this.copyTexture(\"mz\")(magZ), dt, this.cellSize, this.reflectiveBoundary) as Texture\r\n\r\n        this.data.time += dt / 2\r\n    }\r\n\r\n    resetFields = () => {\r\n        this.data.time = 0\r\n        this.data.electricFieldX.values = this.makeFieldTexture(\"ex\")(0) as Texture\r\n        this.data.electricFieldY.values = this.makeFieldTexture(\"ey\")(0) as Texture\r\n        this.data.electricFieldZ.values = this.makeFieldTexture(\"ez\")(0) as Texture\r\n        this.data.magneticFieldX.values = this.makeFieldTexture(\"mx\")(0) as Texture\r\n        this.data.magneticFieldY.values = this.makeFieldTexture(\"my\")(0) as Texture\r\n        this.data.magneticFieldZ.values = this.makeFieldTexture(\"mz\")(0) as Texture\r\n        this.data.electricSourceFieldZ.values = this.makeFieldTexture(\"esz\")(0) as Texture\r\n    }\r\n\r\n    resetMaterials = () => {\r\n        this.data.permeability.values = this.makeFieldTexture(\"permeability\")(1) as Texture\r\n        this.data.permittivity.values = this.makeFieldTexture(\"permittivity\")(1) as Texture\r\n    }\r\n\r\n    drawPermeability = (pos: [number, number, number], size: number, value: number) => {\r\n        this.data.permeability.values = this.drawOnTexture(\"permeability\")(pos, size, value, 0, this.copyTexture(\"permability\")(this.data.permeability.values)) as Texture\r\n    }\r\n\r\n    drawPermittivity = (pos: [number, number, number], size: number, value: number) => {\r\n        this.data.permittivity.values = this.drawOnTexture(\"permittivity\")(pos, size, value, 0, this.copyTexture(\"permittivity\")(this.data.permittivity.values)) as Texture\r\n    }\r\n\r\n    injectSignal = (pos: [number, number], size: number, value: number, dt: number) => {\r\n        this.data.electricSourceFieldZ.values = this.drawOnTexture(\"esz\")(pos, size, value * dt, 1, this.copyTexture(\"esz\")(this.data.electricSourceFieldZ.values)) as Texture\r\n    }\r\n\r\n    loadPermittivity = (permittivity: number[][]) => {\r\n        this.data.permittivity.values = this.copyTexture(\"loadPermittivity\")(permittivity) as Texture\r\n    }\r\n\r\n    loadPermeability = (permeability: number[][]) => {\r\n        this.data.permeability.values = this.copyTexture(\"loadPermeability\")(permeability) as Texture\r\n    }\r\n\r\n    getData = () => this.data\r\n}","import { Simulator } from \"./simulator\"\r\n\r\nexport interface SignalSource {\r\n    inject(simulator: Simulator, dt: number): void\r\n}\r\n\r\nexport class PointSignalSource implements SignalSource {\r\n    constructor(public amplitude: number, public frequency: number, public position: [number, number], public turnOffTime?: number) {\r\n\r\n    }\r\n\r\n    inject = (simulator: Simulator, dt: number) => {\r\n        const t = simulator.getData().time\r\n        if (this.turnOffTime === undefined || t <= this.turnOffTime) {\r\n            const amplitude = -this.amplitude * Math.cos(2 * Math.PI * this.frequency * t)\r\n            simulator.injectSignal(this.position, 1, amplitude, dt)\r\n        }\r\n    }\r\n}\r\n\r\n","import React, { ReactElement, useState, useCallback, useMemo } from \"react\"\r\nimport { encodeMaterialMap, decodeMaterialMap, SimulatorMap, SimulationSettings } from \"./serialization\"\r\nimport { FDTDSimulator } from \"./simulator\"\r\nimport { SignalSource, PointSignalSource } from \"./sources\"\r\nimport * as maps from \"./maps\"\r\n\r\nexport type CollapsibleContainerProps = {\r\n    children: ReactElement<any> | ReactElement<any>[] | null\r\n    id?: string\r\n    className?: string\r\n    style?: React.CSSProperties\r\n    buttonStyle?: React.CSSProperties\r\n    title?: string\r\n    initiallyCollapsed?: boolean\r\n}\r\n\r\nexport function CollapsibleContainer(props: CollapsibleContainerProps) {\r\n    const [collapsed, setCollapsed] = useState(props.initiallyCollapsed !== undefined ? props.initiallyCollapsed : false)\r\n\r\n    return (\r\n        <div id={props.id} className={props.className} style={{ textAlign: \"center\", background: \"rgb(33, 33, 33)\", fontWeight: \"lighter\", color: \"white\", ...props.style }}>\r\n            <button onClick={e => setCollapsed(!collapsed)} style={{ width: \"100%\", height: \"24px\", background: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", fontWeight: \"bold\", cursor: \"pointer\", ...props.buttonStyle }}>\r\n                {props.title ? `${props.title} ` : \"\"}[{collapsed ? \"+\" : \"-\"}]\r\n            </button>\r\n            {!collapsed && props.children}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type LabeledSliderProps = {\r\n    label: string\r\n    value: number,\r\n    setValue: (value: number) => void\r\n    min: number\r\n    max: number\r\n    step: number\r\n}\r\n\r\nexport function LabeledSlider(props: LabeledSliderProps) {\r\n    return (\r\n        <div>\r\n            <label>{props.label}</label>\r\n            <div>\r\n                <input type=\"range\" min={props.min} max={props.max} value={props.value} step={props.step}\r\n                    onChange={e => props.setValue(parseFloat(e.target.value))} style={{ height: 10, width: \"100%\" }} />\r\n                <div style={{ textAlign: \"center\", lineHeight: 0.2, marginBottom: \"7px\" }}>\r\n                    {props.value}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type OptionSelectorProps = {\r\n    options: string[]\r\n    selectedOption: number\r\n    setSelectedOption: (selectedOption: number) => void\r\n    buttonClassName?: string\r\n}\r\n\r\nexport function OptionSelector(props: OptionSelectorProps) {\r\n    return (\r\n        <div style={{ margin: \"10px\" }}>\r\n            {props.options.map((option, optionIndex) =>\r\n                <button className={props.buttonClassName} key={option} style={{\r\n                    backgroundColor: \"rgb(50, 50, 50)\",\r\n                    color: \"white\",\r\n                    border: optionIndex === props.selectedOption ? \"3px solid rgb(0, 150, 255)\" : \"0\",\r\n                    height: \"30px\",\r\n                    width: \"70px\",\r\n                    overflow: \"hidden\",\r\n                    textOverflow: \"hidden\"\r\n                }}\r\n                    onClick={e => props.setSelectedOption(optionIndex)}>\r\n                    {option}\r\n                </button>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type SaveLoadComponentProps = {\r\n    simulator: FDTDSimulator | null\r\n    gridSize: [number, number]\r\n}\r\n\r\nexport function SaveLoadComponent(props: SaveLoadComponentProps) {\r\n    const simulator = props.simulator\r\n    const gridSize = props.gridSize\r\n    const [simulatorMapUrl, setSimulatorMapUrl] = useState(\"\")\r\n\r\n    const onSaveClicked = useCallback(() => {\r\n        if (simulator) {\r\n            const simData = simulator.getData()\r\n\r\n            window.open(encodeMaterialMap({\r\n                permittivity: simData.permittivity.values.toArray() as number[][],\r\n                permeability: simData.permeability.values.toArray() as number[][],\r\n                shape: [simData.permeability.shape[0], simData.permeability.shape[1]]\r\n            }))\r\n        }\r\n    }, [simulator])\r\n\r\n    const onLoadClicked = useCallback(() => {\r\n        if (simulator) {\r\n            decodeMaterialMap(simulatorMapUrl, [gridSize[0], gridSize[1]], map => {\r\n                if (simulator) {\r\n                    simulator.loadPermeability(map.permeability)\r\n                    simulator.loadPermittivity(map.permittivity)\r\n                }\r\n            })\r\n        }\r\n    }, [simulator, gridSize, simulatorMapUrl])\r\n\r\n    return (\r\n        <div style={{ padding: \"10px\" }}>\r\n            <div>\r\n                <button onClick={onSaveClicked} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Save map</button>\r\n            </div>\r\n            <div>\r\n                <input type=\"text\" onChange={e => setSimulatorMapUrl(e.target.value)} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", margin: \"2px\" }} />\r\n                <button onClick={onLoadClicked} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Load map url</button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type ExamplesComponentProps = {\r\n    simulator: FDTDSimulator | null\r\n\r\n    dt: number\r\n    simulationSpeed: number\r\n    cellSize: number\r\n    gridSize: [number, number]\r\n\r\n    setGridSizeLongest: (gridSizeLongest: number) => void\r\n    setDt: (dt: number) => void\r\n    setCellSize: (cellSize: number) => void\r\n    setSimulationSpeed: (simulationSpeed: number) => void\r\n    setSources: (sources: SignalSource[]) => void\r\n}\r\n\r\nexport function ExamplesComponent(props: ExamplesComponentProps) {\r\n    const { simulator, setGridSizeLongest, setDt, setCellSize, setSimulationSpeed, setSources } = props\r\n\r\n    const loadMap = useCallback((simulatorMap: SimulatorMap) => {\r\n        if (simulator) {\r\n            simulator.resetFields()\r\n            simulator.loadPermeability(simulatorMap.materialMap.permeability)\r\n            simulator.loadPermittivity(simulatorMap.materialMap.permittivity)\r\n        }\r\n\r\n        const loadedSources = simulatorMap.sourcesDescriptors.map(desc => {\r\n            if (desc.type === \"point\") {\r\n                return new PointSignalSource(desc.amplitude, desc.frequency, desc.position, desc.turnOffTime)\r\n            }\r\n\r\n            throw new Error(`Unsupported source type: ${desc.type}`)\r\n        })\r\n\r\n        setCellSize(simulatorMap.simulationSettings.cellSize)\r\n        setDt(simulatorMap.simulationSettings.dt)\r\n        setSimulationSpeed(simulatorMap.simulationSettings.simulationSpeed)\r\n        setGridSizeLongest(Math.max(simulatorMap.simulationSettings.gridSize[0], simulatorMap.simulationSettings.gridSize[1]))\r\n        setSources(loadedSources)\r\n    }, [simulator, setCellSize, setDt, setSimulationSpeed, setGridSizeLongest, setSources])\r\n\r\n    const simulationSettings = useMemo<SimulationSettings>(() => {\r\n        return {\r\n            dt: props.dt,\r\n            cellSize: props.cellSize,\r\n            gridSize: props.gridSize,\r\n            simulationSpeed: props.simulationSpeed\r\n        }\r\n    }, [props.dt, props.cellSize, props.gridSize, props.simulationSpeed])\r\n\r\n    return (\r\n        <div style={{ padding: \"10px\" }}>\r\n            <button onClick={_ => loadMap(maps.empty(simulationSettings))} style={{ backgroundColor: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Empty</button>\r\n            <button onClick={_ => loadMap(maps.doubleSlit(simulationSettings))} style={{ backgroundColor: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Double slit</button>\r\n            <button onClick={_ => loadMap(maps.fiberOptics(simulationSettings))} style={{ backgroundColor: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Fiber optics</button>\r\n            <button onClick={_ => loadMap(maps.lens(simulationSettings))} style={{ backgroundColor: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Lens</button>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type SettingsComponentProps = {\r\n    gridSizeLongest: number\r\n    setGridSizeLongest: (gridSizeLongest: number) => void\r\n\r\n    dt: number\r\n    setDt: (dt: number) => void\r\n\r\n    cellSize: number\r\n    setCellSize: (cellSize: number) => void\r\n\r\n    resolutionScale: number\r\n    setResolutionScale: (resolutionScale: number) => void\r\n\r\n    simulationSpeed: number\r\n    setSimulationSpeed: (simulationSpeed: number) => void\r\n\r\n    reflectiveBoundary: boolean\r\n    setReflectiveBoundary: (reflectiveBoundary: boolean) => void\r\n}\r\n\r\nexport function SettingsComponent(props: SettingsComponentProps) {\r\n    return (\r\n        <div style={{ padding: \"10px\" }}>\r\n            <LabeledSlider label=\"Grid length\" value={props.gridSizeLongest} setValue={props.setGridSizeLongest} min={100} max={2000} step={100} />\r\n            <LabeledSlider label=\"Time step size\" value={props.dt} setValue={props.setDt} min={0.001} max={0.1} step={0.001} />\r\n            <LabeledSlider label=\"Cell size\" value={props.cellSize} setValue={props.setCellSize} min={0.002} max={0.2} step={0.001} />\r\n            <LabeledSlider label=\"Resolution scale\" value={props.resolutionScale} setValue={props.setResolutionScale} min={0.1} max={2} step={0.1} />\r\n            <LabeledSlider label=\"Simulation speed\" value={props.simulationSpeed} setValue={props.setSimulationSpeed} min={0} max={10} step={0.1} />\r\n            <input type=\"checkbox\" checked={props.reflectiveBoundary} onChange={e => props.setReflectiveBoundary(e.target.checked)} />Reflective boundary\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type ControlComponentProps = {\r\n    brushSize: number,\r\n    setBrushSize: (brushSize: number) => void\r\n\r\n    brushValue: number\r\n    setBrushValue: (brushValue: number) => void\r\n\r\n    signalFrequency: number,\r\n    setSignalFrequency: (signalFrequency: number) => void\r\n\r\n    clickOption: number\r\n    setClickOption: (clickOption: number) => void\r\n\r\n    resetFields: () => void\r\n    resetMaterials: () => void\r\n}\r\n\r\nexport function ControlComponent(props: ControlComponentProps) {\r\n    return (\r\n        <div style={{ padding: \"10px\" }}>\r\n            <LabeledSlider label=\"Brush size\" value={props.brushSize} setValue={props.setBrushSize} min={1} max={100} step={1} />\r\n            <LabeledSlider label=\"Brush value\" value={props.brushValue} setValue={props.setBrushValue} min={1} max={255} step={1} />\r\n            <LabeledSlider label=\"Signal frequency\" value={props.signalFrequency} setValue={props.setSignalFrequency} min={0} max={25} step={0.25} />\r\n            <OptionSelector options={[\"ε-Brush\", \"µ-Brush\", \"Signal\"]} selectedOption={props.clickOption} setSelectedOption={props.setClickOption} />\r\n            <div>\r\n                <button onClick={props.resetFields} style={{ backgroundColor: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", margin: \"2px\", width: \"130px\" }}>Reset fields</button>\r\n                <button onClick={props.resetMaterials} style={{ backgroundColor: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", margin: \"2px\", width: \"130px\" }}>Reset materials</button>\r\n            </div>\r\n        </div>\r\n    )\r\n}","export type SimulationSettings = {\r\n    dt: number\r\n    gridSize: [number, number]\r\n    simulationSpeed: number\r\n    cellSize: number\r\n}\r\n\r\nexport type MaterialMap = {\r\n    permittivity: number[][]\r\n    permeability: number[][]\r\n    shape: [number, number]\r\n}\r\n\r\nexport type EncodedMaterialMap = string\r\n\r\nexport type SourceDescriptor = {\r\n    type: \"point\"\r\n    position: [number, number]\r\n    amplitude: number\r\n    frequency: number\r\n    turnOffTime?: number\r\n}\r\n\r\nexport type SimulatorMap = {\r\n    materialMap: MaterialMap\r\n    simulationSettings: SimulationSettings\r\n    sourcesDescriptors: SourceDescriptor[]\r\n}\r\n\r\nexport function encodeMaterialMap(materialMap: MaterialMap): string {\r\n    const canvas = document.createElement(\"canvas\")\r\n    canvas.width = materialMap.shape[0]\r\n    canvas.height = materialMap.shape[1]\r\n\r\n    const permeability = materialMap.permeability\r\n    const permittivity = materialMap.permittivity\r\n\r\n    const ctx = canvas.getContext(\"2d\")!\r\n\r\n    ctx.fillStyle = \"rgb(1, 0, 1)\"\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height)\r\n\r\n    ctx.fillStyle = \"rgb(0, 255, 0)\"\r\n    ctx.textAlign = \"center\"\r\n    ctx.textBaseline = \"middle\"\r\n    ctx.fillText(\"warlock.ai/maxwell\", canvas.width / 2, canvas.height / 2)\r\n\r\n    const canvasData = ctx.getImageData(0, 0, canvas.width, canvas.height)\r\n\r\n    for (let x = 0; x < canvas.width; x++) {\r\n        for (let y = 0; y < canvas.height; y++) {\r\n            canvasData.data[x * 4 + y * canvas.width * 4 + 0] = Math.round(permittivity[y][x]) // r\r\n            canvasData.data[x * 4 + y * canvas.width * 4 + 2] = Math.round(permeability[y][x]) // b\r\n            canvasData.data[x * 4 + y * canvas.width * 4 + 3] = 255 // a\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(canvasData, 0, 0)\r\n\r\n    return canvas.toDataURL(\"image/png\")\r\n}\r\n\r\nexport function decodeMaterialMap(encodedMaterialMap: EncodedMaterialMap, targetSize: [number, number], onLoaded: (materialMap: MaterialMap) => void) {\r\n    const canvas = document.createElement(\"canvas\")\r\n    canvas.width = targetSize[0]\r\n    canvas.height = targetSize[1]\r\n    const image = new Image()\r\n    image.crossOrigin = \"anonymous\"\r\n    image.onload = e => {\r\n        const ctx = canvas.getContext(\"2d\")!\r\n\r\n        ctx.fillStyle = \"rgb(1, 0, 1)\"\r\n        ctx.fillRect(0, 0, canvas.width, canvas.height)\r\n\r\n        ctx.drawImage(image, 0, 0, image.width, image.height)\r\n\r\n        const materialMap: MaterialMap = { permeability: [], permittivity: [], shape: targetSize }\r\n\r\n        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data\r\n        for (let y = 0; y < targetSize[1]; y++) {\r\n            materialMap.permittivity.push([])\r\n            materialMap.permeability.push([])\r\n            for (let x = 0; x < targetSize[0]; x++) {\r\n                materialMap.permittivity[y].push(Math.max(1, imageData[x * 4 + y * targetSize[0] * 4 + 0]))\r\n                materialMap.permeability[y].push(Math.max(1, imageData[x * 4 + y * targetSize[0] * 4 + 2]))\r\n            }\r\n        }\r\n\r\n        onLoaded(materialMap)\r\n    }\r\n    image.src = encodedMaterialMap\r\n}","import { SimulatorMap, MaterialMap, SourceDescriptor, SimulationSettings } from \"./serialization\"\r\n\r\nexport function empty(simulationSettings: SimulationSettings): SimulatorMap {\r\n    const materialMap: MaterialMap = {\r\n        permittivity: [],\r\n        permeability: [],\r\n        shape: simulationSettings.gridSize\r\n    }\r\n\r\n    for (let y = 0; y < simulationSettings.gridSize[1]; y++) {\r\n        materialMap.permittivity.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n        materialMap.permeability.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n    }\r\n\r\n    const sourceDescriptors: SourceDescriptor[] = []\r\n\r\n    return {\r\n        sourcesDescriptors: sourceDescriptors,\r\n        simulationSettings: simulationSettings,\r\n        materialMap: materialMap\r\n    }\r\n}\r\n\r\nexport function doubleSlit(simulationSettings: SimulationSettings): SimulatorMap {\r\n    const materialMap: MaterialMap = {\r\n        permittivity: [],\r\n        permeability: [],\r\n        shape: simulationSettings.gridSize\r\n    }\r\n\r\n    const slitCenterX = Math.round(0.75 * simulationSettings.gridSize[0])\r\n\r\n    for (let y = 0; y < simulationSettings.gridSize[1]; y++) {\r\n        const isWallRow = Math.abs(y - simulationSettings.gridSize[1] / 5) < 2\r\n        const permittivityRow = new Array(simulationSettings.gridSize[0]).fill(isWallRow ? 100 : 1)\r\n\r\n        if (isWallRow) {\r\n            for (let x = slitCenterX - 20; x < slitCenterX - 10; x++) {\r\n                permittivityRow[x] = 1\r\n            }\r\n\r\n            for (let x = slitCenterX + 20; x > slitCenterX + 10; x--) {\r\n                permittivityRow[x] = 1\r\n            }\r\n        }\r\n\r\n        materialMap.permittivity.push(permittivityRow)\r\n        materialMap.permeability.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n    }\r\n\r\n    const sourceDescriptors: SourceDescriptor[] = [{\r\n        type: \"point\",\r\n        amplitude: 150000,\r\n        frequency: 3,\r\n        position: [Math.round(slitCenterX), Math.round(simulationSettings.gridSize[1] / 15)]\r\n    }]\r\n\r\n    return {\r\n        sourcesDescriptors: sourceDescriptors,\r\n        simulationSettings: simulationSettings,\r\n        materialMap: materialMap\r\n    }\r\n}\r\n\r\nexport function fiberOptics(simulationSettings: SimulationSettings): SimulatorMap {\r\n    const materialMap: MaterialMap = {\r\n        permittivity: [],\r\n        permeability: [],\r\n        shape: simulationSettings.gridSize\r\n    }\r\n\r\n    for (let y = 0; y < simulationSettings.gridSize[1]; y++) {\r\n        materialMap.permittivity.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n        materialMap.permeability.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n    }\r\n\r\n    function getCurvePoint(t: number): [number, number] {\r\n        return [\r\n            Math.round(simulationSettings.gridSize[0] * 3 / 4 + simulationSettings.gridSize[0] / 5 * 0.5 / (2 * t + 1) * -Math.sin(2 * Math.PI * t)),\r\n            Math.round(simulationSettings.gridSize[1] * (1 / 10 + t * (1 - 2 / 10)))\r\n        ]\r\n    }\r\n\r\n    const numPoints = 100\r\n    const thickness = 2\r\n    for (let t = 0; t < numPoints; t++) {\r\n        const pos = getCurvePoint(t / numPoints)\r\n\r\n        for (let x = -thickness + pos[0]; x < thickness + pos[0]; x++) {\r\n            for (let y = -thickness + pos[1]; y < thickness + pos[1]; y++) {\r\n                if (x >= 0 && y >= 0 && x < simulationSettings.gridSize[0] && y < simulationSettings.gridSize[1]) {\r\n                    materialMap.permittivity[y][x] = 2\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    const endPoint = getCurvePoint(1)\r\n\r\n    const sourceDescriptors: SourceDescriptor[] = [{\r\n        type: \"point\",\r\n        amplitude: 40000,\r\n        frequency: 5,\r\n        position: [endPoint[0] - 1, endPoint[1]],\r\n        turnOffTime: 0.5\r\n    }, {\r\n        type: \"point\",\r\n        amplitude: 40000,\r\n        frequency: 5,\r\n        position: [endPoint[0] + 2, endPoint[1]],\r\n        turnOffTime: 0.5\r\n    },]\r\n\r\n    return {\r\n        sourcesDescriptors: sourceDescriptors,\r\n        simulationSettings: simulationSettings,\r\n        materialMap: materialMap\r\n    }\r\n}\r\n\r\n\r\nexport function lens(simulationSettings: SimulationSettings): SimulatorMap {\r\n    const materialMap: MaterialMap = {\r\n        permittivity: [],\r\n        permeability: [],\r\n        shape: simulationSettings.gridSize\r\n    }\r\n\r\n    const center = [simulationSettings.gridSize[0] * 0.6, simulationSettings.gridSize[1] / 2]\r\n\r\n    function isLensPoint(point: [number, number]) {\r\n        const dx = point[0] - center[0]\r\n        const dy = point[1] - center[1]\r\n\r\n        return 4 * dx * dx + dy * dy < simulationSettings.gridSize[0] * simulationSettings.gridSize[0] / (10 * 10)\r\n    }\r\n\r\n    for (let y = 0; y < simulationSettings.gridSize[1]; y++) {\r\n        materialMap.permittivity.push([])\r\n        materialMap.permeability.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n        for (let x = 0; x < simulationSettings.gridSize[0]; x++) {\r\n            materialMap.permittivity[y].push(isLensPoint([x, y]) ? 3 : 1)\r\n        }\r\n    }\r\n\r\n    const sourceDescriptors: SourceDescriptor[] = [{\r\n        type: \"point\",\r\n        amplitude: 100000,\r\n        frequency: 2,\r\n        position: [Math.round(simulationSettings.gridSize[0] / 10), Math.round(simulationSettings.gridSize[1] / 2)],\r\n        turnOffTime: 0.5\r\n    }]\r\n\r\n    return {\r\n        sourcesDescriptors: sourceDescriptors,\r\n        simulationSettings: simulationSettings,\r\n        materialMap: materialMap\r\n    }\r\n}","export function toggleFullScreen() {\r\n    if (!document.fullscreenElement) {\r\n        document.documentElement.requestFullscreen()\r\n    } else if (document.exitFullscreen) {\r\n        document.exitFullscreen()\r\n    }\r\n}","import React, { useRef, useCallback, useEffect, useState, useMemo } from 'react'\nimport { GPU, GPUMode, GPUInternalMode, IKernelRunShortcut } from \"gpu.js\"\nimport { FDTDSimulator } from \"./simulator\"\nimport { CollapsibleContainer, ControlComponent, SaveLoadComponent, SettingsComponent, ExamplesComponent } from './components'\nimport { toggleFullScreen } from './util'\nimport Fullscreen from \"./icons/fullscreen.png\"\nimport \"./App.css\"\nimport { SignalSource } from './sources'\n\nfunction getGpuMode(): GPUMode | GPUInternalMode {\n    if (GPU.isSinglePrecisionSupported) {\n        if (GPU.isWebGL2Supported) {\n            return \"webgl2\"\n        } else if (GPU.isWebGLSupported) {\n            return \"webgl\"\n        }\n    }\n\n    return \"cpu\"\n}\n\nconst gpuMode = getGpuMode()\nconsole.log(`Using GPU mode ${gpuMode}`)\n\nconst defaultSignalBrushValue = gpuMode === \"cpu\" ? 5 : 50\nconst defaultSignalBrushSize = 1\nconst defaultSignalFrequency = gpuMode === \"cpu\" ? 1 : 3\nconst defaultMaterialBrushValue = 5\nconst defaultMaterialBrushSize = 5\n\nconst initialDt = gpuMode === \"cpu\" ? 0.026 : 0.013\nconst initialCellSize = gpuMode === \"cpu\" ? 0.04 : 0.02\nconst initialSimulationSpeed = 1\nconst initialGridSizeLongest = gpuMode === \"cpu\" ? 200 : 400\nconst initialResolutionScale = gpuMode === \"cpu\" ? 0.3 : 1\nconst initialWindowSize: [number, number] = [window.innerWidth, window.innerHeight]\nconst initialCanvasSize: [number, number] = calculateCanvasSize(initialWindowSize, initialResolutionScale)\nconst initialGridSize: [number, number] = calculateGridSize(initialGridSizeLongest, initialCanvasSize)\nconst initialReflectiveBoundary = false\n\nfunction calculateCanvasSize(windowSize: [number, number], resolutionScale: number): [number, number] {\n    return [Math.round(windowSize[0] * resolutionScale), Math.round(windowSize[1] * resolutionScale)]\n}\n\nfunction calculateGridSize(gridSizeLongest: number, canvasSize: [number, number]): [number, number] {\n    const canvasAspect = canvasSize[0] / canvasSize[1]\n\n    return canvasSize[0] >= canvasSize[1] ?\n        [gridSizeLongest, Math.ceil(gridSizeLongest / canvasAspect)] :\n        [Math.ceil(gridSizeLongest * canvasAspect), gridSizeLongest]\n}\n\nconst makeRenderSimulatorCanvas = (g: GPU, canvasSize: [number, number]) => {\n    function getAt(field: number[][], shapeX: number, shapeY: number, x: number, y: number) {\n        if (x < 0 || x >= shapeX || y < 0 || y >= shapeY) {\n            return 0\n        }\n\n        return field[y][x]\n    }\n\n    let kernel: IKernelRunShortcut\n\n    // On CPU we can't use float indices so round the coordinates\n    if (gpuMode !== \"cpu\") {\n        kernel = g.createKernel(function (electricFieldX: number[][], electricFieldY: number[][], electricFieldZ: number[][],\n            magneticFieldX: number[][], magneticFieldY: number[][], magneticFieldZ: number[][],\n            permittivity: number[][], permeability: number[][], gridSize: number[]) {\n            const gx = gridSize[0]\n            const gy = gridSize[1]\n\n            const x = gx * this.thread.x! / (this.output.x as number)\n            const y = gy * (1 - this.thread.y! / (this.output.y as number))\n\n            const eAA =\n                getAt(electricFieldX, gx, gy, x, y) * getAt(electricFieldX, gx, gy, x, y) +\n                getAt(electricFieldY, gx, gy, x, y) * getAt(electricFieldY, gx, gy, x, y) +\n                getAt(electricFieldZ, gx, gy, x, y) * getAt(electricFieldZ, gx, gy, x, y)\n\n            // Magnetic field is offset from electric field, so get value at +0.5 by interpolating 0 and 1\n            const magXAA = getAt(magneticFieldX, gx, gy, x - 0.5, y - 0.5)\n            const magYAA = getAt(magneticFieldY, gx, gy, x - 0.5, y - 0.5)\n            const magZAA = getAt(magneticFieldZ, gx, gy, x - 0.5, y - 0.5)\n\n            const mAA = magXAA * magXAA + magYAA * magYAA + magZAA * magZAA\n\n            // Material constants are between 1 and 100, map to [0, 1] using tanh(0.5 * x)\n            const permittivityValue = (2 / (1 + Math.exp(-0.4 * (getAt(permittivity, gx, gy, x, y)))) - 1)\n            const permeabilityValue = (2 / (1 + Math.exp(-0.4 * (getAt(permeability, gx, gy, x, y)))) - 1)\n\n            const backgroundX = (Math.abs((1.5 * x) % 1 - 0.5) < 0.25 ? 1 : 0) * (Math.abs((1.5 * y) % 1 - 0.5) < 0.25 ? 1 : 0)\n            const backgroundY = 1 - backgroundX\n\n            const scale = 15\n            this.color(\n                Math.min(1, eAA / scale + 0.8 * backgroundX * permittivityValue),\n                Math.min(1, eAA / scale + mAA / scale),\n                Math.min(1, mAA / scale + 0.8 * backgroundY * permeabilityValue))\n        })\n    } else {\n        kernel = g.createKernel(function (electricFieldX: number[][], electricFieldY: number[][], electricFieldZ: number[][],\n            magneticFieldX: number[][], magneticFieldY: number[][], magneticFieldZ: number[][],\n            permittivity: number[][], permeability: number[][], gridSize: number[]) {\n            const gx = gridSize[0]\n            const gy = gridSize[1]\n\n            const fx = gx * this.thread.x! / (this.output.x as number)\n            const fy = gy * (1 - this.thread.y! / (this.output.y as number))\n            const x = Math.round(fx)\n            const y = Math.round(fy)\n\n            const eAA =\n                getAt(electricFieldX, gx, gy, x, y) * getAt(electricFieldX, gx, gy, x, y) +\n                getAt(electricFieldY, gx, gy, x, y) * getAt(electricFieldY, gx, gy, x, y) +\n                getAt(electricFieldZ, gx, gy, x, y) * getAt(electricFieldZ, gx, gy, x, y)\n\n            // Magnetic field is offset from electric field, so get value at +0.5 by interpolating 0 and 1\n            const magXAA = getAt(magneticFieldX, gx, gy, x, y)\n            const magYAA = getAt(magneticFieldY, gx, gy, x, y)\n            const magZAA = getAt(magneticFieldZ, gx, gy, x, y)\n\n            const mAA = magXAA * magXAA + magYAA * magYAA + magZAA * magZAA\n\n            // Material constants are between 1 and 100, map to [0, 1] using tanh(0.5 * x)\n            const permittivityValue = (2 / (1 + Math.exp(-0.4 * (getAt(permittivity, gx, gy, x, y)))) - 1)\n            const permeabilityValue = (2 / (1 + Math.exp(-0.4 * (getAt(permeability, gx, gy, x, y)))) - 1)\n\n            const backgroundX = (Math.abs((1.5 * x) % 1 - 0.5) < 0.25 ? 1 : 0) * (Math.abs((1.5 * y) % 1 - 0.5) < 0.25 ? 1 : 0)\n            const backgroundY = 1 - backgroundX\n\n            const scale = 15\n            this.color(\n                Math.min(1, eAA / scale + 0.8 * backgroundX * permittivityValue),\n                Math.min(1, eAA / scale + mAA / scale),\n                Math.min(1, mAA / scale + 0.8 * backgroundY * permeabilityValue))\n        })\n    }\n\n    return kernel.setOutput(canvasSize).setGraphical(true).setFunctions([getAt]).setWarnVarUsage(false).setTactic(\"performance\").setPrecision(\"unsigned\").setDynamicOutput(true).setDynamicArguments(true)\n}\n\nfunction clamp(min: number, max: number, value: number) {\n    return Math.max(min, Math.min(max, value))\n}\n\nexport default function () {\n    const drawCanvasRef = useRef<HTMLCanvasElement>(null)\n\n    const [canvasSize, setCanvasSize] = useState<[number, number]>(initialCanvasSize)\n    const [windowSize, setWindowSize] = useState<[number, number]>(initialWindowSize)\n    const [gridSizeLongest, setGridSizeLongest] = useState(initialGridSizeLongest)\n    const [dt, setDt] = useState(initialDt)\n    const [cellSize, setCellSize] = useState(initialCellSize)\n    const [resolutionScale, setResolutionScale] = useState(initialResolutionScale)\n    const [simulationSpeed, setSimulationSpeed] = useState(initialSimulationSpeed)\n    const [reflectiveBoundary, setReflectiveBoundary] = useState(initialReflectiveBoundary)\n\n    const [sources, setSources] = useState<SignalSource[]>([])\n\n    useEffect(() => {\n        const adjustCanvasSize = () => {\n            const wndSize: [number, number] = [window.innerWidth, window.innerHeight]\n            setCanvasSize(calculateCanvasSize(wndSize, resolutionScale))\n            setWindowSize(wndSize)\n        }\n\n        adjustCanvasSize()\n\n        window.addEventListener(\"resize\", adjustCanvasSize)\n        return () => window.removeEventListener(\"resize\", adjustCanvasSize)\n    }, [resolutionScale])\n\n    const gridSize = useMemo<[number, number]>(() => calculateGridSize(gridSizeLongest, canvasSize), [canvasSize, gridSizeLongest])\n\n    // Would use useMemo for gpu here, but useMemo does not seem to work with ref dependencies.\n    const [gpu, setGpu] = useState<GPU | null>(null)\n    useEffect(() => {\n        if (drawCanvasRef.current) {\n            setGpu(new GPU({ mode: gpuMode, canvas: drawCanvasRef.current }))\n        }\n    }, [drawCanvasRef])\n\n    const simulator = useMemo(() => gpu ? new FDTDSimulator(gpu, initialGridSize, initialCellSize, initialReflectiveBoundary) : null, [gpu])\n    const renderSim = useMemo(() => gpu ? makeRenderSimulatorCanvas(gpu, initialGridSize) : null, [gpu])\n\n    // Update render sim output size\n    useEffect(() => {\n        if (renderSim) {\n            renderSim.setOutput(canvasSize)\n        }\n    }, [renderSim, canvasSize])\n\n    // Update simulator grid size\n    useEffect(() => {\n        if (simulator) {\n            simulator.setGridSize(gridSize)\n        }\n    }, [simulator, gridSize])\n\n    // Update simulator cell size\n    useEffect(() => {\n        if (simulator) {\n            simulator.setCellSize(cellSize)\n        }\n    }, [simulator, cellSize])\n\n    // Update reflective boundary\n    useEffect(() => {\n        if (simulator) {\n            simulator.reflectiveBoundary = reflectiveBoundary\n        }\n    }, [simulator, reflectiveBoundary])\n\n    const [brushSize, setBrushSize] = useState(defaultSignalBrushSize)\n    const [brushValue, setBrushValue] = useState(defaultSignalBrushValue)\n    const [signalFrequency, setSignalFrequency] = useState(defaultSignalFrequency)\n    const [drawingPermeability, setDrawingPermeability] = useState(false)\n    const [drawingPermittivity, setDrawingPermittivity] = useState(false)\n    const [clickOption, setClickOption] = useState(2) // eps, mu, signal\n    const optionPermittivityBrush = 0\n    const optionPermeabilityBrush = 1\n    const optionSignal = 2\n\n    const [mousePosition, setMousePosition] = useState<[number, number] | null>(null)\n\n    const signalStrength = useRef(0)\n    const mouseDownPos = useRef<[number, number] | null>(null)\n\n    const windowToSimulationPoint = useMemo(() => {\n        return (windowPoint: [number, number]) => {\n            const simulationPoint: [number, number] = [\n                clamp(0, gridSize[0] - 1, Math.floor(gridSize[0] * windowPoint[0] / windowSize[0])),\n                clamp(0, gridSize[1] - 1, Math.floor(gridSize[1] * windowPoint[1] / windowSize[1]))\n            ]\n            return simulationPoint\n        }\n    }, [windowSize, gridSize])\n\n    const simStep = useCallback(() => {\n        if (simulator) {\n            const simData = simulator.getData()\n\n            if (mouseDownPos.current !== null) {\n                const center = windowToSimulationPoint(mouseDownPos.current)\n                const brushHalfSize = Math.round(brushSize / 2)\n\n                simulator.injectSignal(center, brushHalfSize, -brushValue * 2000 * Math.cos(2 * Math.PI * signalFrequency * simData.time), dt)\n            }\n\n            for (const source of sources) {\n                source.inject(simulator, dt)\n            }\n\n            simulator.stepMagnetic(dt)\n            simulator.stepElectric(dt)\n        }\n    }, [simulator, dt, signalFrequency, brushValue, brushSize, sources, windowToSimulationPoint])\n\n    useEffect(() => {\n        if (simulationSpeed > 0) {\n            const timer = setInterval(simStep, 1000 / simulationSpeed * dt)\n            return () => clearInterval(timer)\n        }\n\n        return undefined\n    }, [simStep, dt, simulationSpeed])\n\n    const drawStep = useCallback(() => {\n        if (simulator && renderSim) {\n            if (drawCanvasRef.current) {\n                const cnvSize = calculateCanvasSize([window.innerWidth, window.innerHeight], resolutionScale)\n                drawCanvasRef.current.width = cnvSize[0]\n                drawCanvasRef.current.height = cnvSize[1]\n            }\n\n            const simData = simulator.getData()\n\n            if (simData.time > 0) {\n                renderSim(simData.electricFieldX.values, simData.electricFieldY.values, simData.electricFieldZ.values,\n                    simData.magneticFieldX.values, simData.magneticFieldY.values, simData.magneticFieldZ.values,\n                    simData.permittivity.values, simData.permeability.values, gridSize)\n            }\n        }\n    }, [simulator, renderSim, gridSize, resolutionScale, drawCanvasRef])\n\n    useEffect(() => {\n        let stop = false\n        const drawIfNotStopped = () => {\n            if (!stop) {\n                drawStep()\n                requestAnimationFrame(drawIfNotStopped)\n            }\n        }\n\n        requestAnimationFrame(drawIfNotStopped)\n\n        return () => { stop = true }\n    }, [drawStep])\n\n    const changeMaterial = useCallback((canvasPos: [number, number], material: \"permittivity\" | \"permeability\") => {\n        if (simulator) {\n            const centerX = Math.round(gridSize[0] * (canvasPos[0] / windowSize[0]))\n            const centerY = Math.round(gridSize[1] * (canvasPos[1] / windowSize[1]))\n            const brushHalfSize = Math.round(brushSize / 2)\n\n            if (material === \"permittivity\") {\n                simulator.drawPermittivity([centerX, centerY, 0], brushHalfSize, brushValue)\n            } else {\n                simulator.drawPermeability([centerX, centerY, 0], brushHalfSize, brushValue)\n            }\n\n        }\n    }, [simulator, gridSize, windowSize, brushSize, brushValue])\n\n    const resetMaterials = useCallback(() => {\n        if (simulator) {\n            simulator.resetMaterials()\n        }\n    }, [simulator])\n\n    const resetFields = useCallback(() => {\n        if (simulator) {\n            simulator.resetFields()\n            signalStrength.current = 0\n        }\n    }, [simulator])\n\n    const onInputDown = useCallback(([clientX, clientY]: [number, number]) => {\n        if (simulator) {\n            if (clickOption === optionSignal) {\n                mouseDownPos.current = [clientX, clientY]\n            } else if (clickOption === optionPermittivityBrush) {\n                changeMaterial([clientX, clientY], \"permittivity\")\n                setDrawingPermittivity(true)\n            } else if (clickOption === optionPermeabilityBrush) {\n                changeMaterial([clientX, clientY], \"permeability\")\n                setDrawingPermeability(true)\n            }\n        }\n    }, [simulator, changeMaterial, clickOption])\n\n    const onInputMove = useCallback(([clientX, clientY]: [number, number]) => {\n        if (simulator) {\n            if (clickOption === optionSignal && mouseDownPos.current !== null) {\n                mouseDownPos.current = [clientX, clientY]\n            }\n\n            if (drawingPermittivity) {\n                changeMaterial([clientX, clientY], \"permittivity\")\n            }\n\n            if (drawingPermeability) {\n                changeMaterial([clientX, clientY], \"permeability\")\n            }\n        }\n    }, [simulator, changeMaterial, clickOption, drawingPermeability, drawingPermittivity])\n\n    const onInputUp = useCallback(() => {\n        if (clickOption === optionSignal) {\n            mouseDownPos.current = null\n        } else if (clickOption === optionPermeabilityBrush) {\n            setDrawingPermeability(false)\n        } else if (clickOption === optionPermittivityBrush) {\n            setDrawingPermittivity(false)\n        }\n    }, [clickOption])\n\n    // Remember old brush values for signal and material\n    const [previousClickOption, setPreviousClickOption] = useState(optionSignal)\n    const [signalBrushSize, setSignalBrushSize] = useState(defaultSignalBrushSize)\n    const [signalBrushValue, setSignalBrushValue] = useState(defaultSignalBrushValue)\n    const [materialBrushSize, setMaterialBrushSize] = useState(defaultMaterialBrushSize)\n    const [materialBrushValue, setMaterialBrushValue] = useState(defaultMaterialBrushValue)\n    useEffect(() => {\n        if (clickOption === optionSignal && previousClickOption !== optionSignal) {\n            setMaterialBrushSize(brushSize)\n            setMaterialBrushValue(brushValue)\n            setBrushSize(signalBrushSize)\n            setBrushValue(signalBrushValue)\n        } else if (clickOption !== optionSignal && previousClickOption === optionSignal) {\n            setSignalBrushSize(brushSize)\n            setSignalBrushValue(brushValue)\n            setBrushSize(materialBrushSize)\n            setBrushValue(materialBrushValue)\n        }\n\n        setPreviousClickOption(clickOption)\n    }, [clickOption, previousClickOption, signalBrushSize, signalBrushValue, materialBrushSize, materialBrushValue, brushSize, brushValue])\n\n    return (\n        <div style={{ touchAction: \"none\", userSelect: \"none\" }}>\n            <canvas width={canvasSize[0]} height={canvasSize[1]} ref={drawCanvasRef} style={{ position: \"absolute\", width: windowSize[0], height: windowSize[1] }}\n                onMouseDown={e => onInputDown([e.clientX, e.clientY])}\n                onMouseMove={e => { setMousePosition([e.clientX, e.clientY]); onInputMove([e.clientX, e.clientY]) }}\n                onMouseUp={e => onInputUp()}\n                onMouseLeave={e => onInputUp()}\n                onTouchStart={e => { setMousePosition([e.touches[0].clientX, e.touches[0].clientY]); onInputDown([e.touches[0].clientX, e.touches[0].clientY]) }}\n                onTouchMove={e => { setMousePosition([e.touches[0].clientX, e.touches[0].clientY]); onInputMove([e.touches[0].clientX, e.touches[0].clientY]) }}\n                onTouchEnd={e => { setMousePosition(null); onInputUp() }}\n                onTouchCancel={e => { setMousePosition(null); onInputUp() }}\n                onContextMenu={e => e.preventDefault()}\n            />\n\n            <div style={{ position: \"absolute\", bottom: 10, right: 10 }}>\n                <a href=\"https://github.com/RobinKa/maxwell-simulation\" rel=\"noopener noreferrer\" target=\"_blank\" style={{ fontWeight: \"lighter\", color: \"rgba(255, 255, 255, 100)\", textDecoration: \"none\" }}>Source code</a>\n            </div>\n\n            {mousePosition &&\n                <div style={{ position: \"absolute\", pointerEvents: \"none\", left: mousePosition[0] - (2 * (brushSize + 1)), top: mousePosition[1] - (2 * (brushSize + 1)), width: 4 * (brushSize + 1), height: 4 * (brushSize + 1), border: \"2px solid yellow\" }} />\n            }\n\n            {gpuMode === \"cpu\" &&\n                <div style={{position: \"absolute\", pointerEvents: \"none\", left: 10, bottom: 10, color: \"red\", fontWeight: \"lighter\"}}>Using CPU (WebGL with float textures unsupported by your device)</div>\n            }\n\n            <img onClick={toggleFullScreen} src={Fullscreen} alt=\"Fullscreen\" style={{ position: \"absolute\", right: 10, top: 10, cursor: \"pointer\" }} />\n\n            <CollapsibleContainer id=\"Menu\" title=\"Menu\" buttonStyle={{ background: \"rgb(60, 60, 60)\" }}>\n                <CollapsibleContainer title=\"Examples\">\n                    <ExamplesComponent\n                        simulator={simulator} setCellSize={setCellSize} setDt={setDt}\n                        setGridSizeLongest={setGridSizeLongest} setSimulationSpeed={setSimulationSpeed}\n                        setSources={setSources} gridSize={gridSize} dt={dt}\n                        cellSize={cellSize} simulationSpeed={simulationSpeed} />\n                </CollapsibleContainer>\n                <CollapsibleContainer title=\"Controls\">\n                    <ControlComponent\n                        brushSize={brushSize} setBrushSize={setBrushSize}\n                        brushValue={brushValue} setBrushValue={setBrushValue}\n                        signalFrequency={signalFrequency} setSignalFrequency={setSignalFrequency}\n                        clickOption={clickOption} setClickOption={setClickOption}\n                        resetFields={resetFields} resetMaterials={resetMaterials} />\n                </CollapsibleContainer>\n                <CollapsibleContainer title=\"Save / Load\" initiallyCollapsed={true}>\n                    <SaveLoadComponent simulator={simulator} gridSize={gridSize} />\n                </CollapsibleContainer>\n                <CollapsibleContainer title=\"Settings\" initiallyCollapsed={true}>\n                    <SettingsComponent\n                        gridSizeLongest={gridSizeLongest} setGridSizeLongest={setGridSizeLongest}\n                        simulationSpeed={simulationSpeed} setSimulationSpeed={setSimulationSpeed}\n                        resolutionScale={resolutionScale} setResolutionScale={setResolutionScale}\n                        cellSize={cellSize} setCellSize={setCellSize}\n                        reflectiveBoundary={reflectiveBoundary} setReflectiveBoundary={setReflectiveBoundary}\n                        dt={dt} setDt={setDt} />\n                </CollapsibleContainer>\n            </CollapsibleContainer>\n        </div>\n    )\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABISURBVFhH7dchDgAhDETRKfe/M1TUlgyqgv8Mq+AnQMjGTjJFqs+rlzlXjWMIIKC9Be6Jd3XrsAUEAAB4jgkYD+DPiIDfA6QD/j8gGcpVf+MAAAAASUVORK5CYII=\""],"sourceRoot":""}