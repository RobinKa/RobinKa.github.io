{"version":3,"sources":["simulator.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["makeScalarField3D","shape","value","values","Array","fill","setScalarField3DValue","field","x","y","z","addScalarField3DValue","canvasSize","window","innerWidth","innerHeight","canvasAspect","gridSize","Math","ceil","simulator","cellSize","data","gpu","updateMagneticX","updateMagneticY","updateMagneticZ","updateElectricX","updateElectricY","updateElectricZ","injectSource","decaySource","stepElectric","dt","elX","electricFieldX","elY","electricFieldY","elZ","electricFieldZ","magX","magneticFieldX","magY","magneticFieldY","magZ","magneticFieldZ","perm","permittivity","electricSourceFieldZ","time","stepMagnetic","permeability","resetFields","resetMaterials","getData","this","cellCount","getAt","shapeX","shapeY","shapeZ","getX","index","getY","floor","getZ","GPU","createKernel","source","thread","gx","constants","gridSizeX","gy","gridSizeY","gz","gridSizeZ","output","setFunctions","setWarnVarUsage","pow","fieldY","fieldZ","magFieldX","cs","fieldX","magFieldY","magFieldZ","elFieldX","elFieldY","elFieldZ","clamp","min","max","LabeledSlider","props","label","type","step","onChange","e","setValue","parseFloat","target","style","height","width","textAlign","lineHeight","marginBottom","OptionSelector","options","map","option","optionIndex","key","boxSizing","border","selectedOption","margin","length","background","color","onClick","setSelectedOption","ControlWidget","useState","collapsed","setCollapsed","userSelect","position","opacity","fontWeight","cursor","padding","brushSize","setBrushSize","brushValue","setBrushValue","signalFrequency","setSignalFrequency","clickOption","setClickOption","Boolean","location","hostname","match","ReactDOM","render","drawingPermeability","setDrawingPermeability","drawingPermittivity","setDrawingPermittivity","mousePosition","setMousePosition","signalStrength","useRef","mouseDownPos","renderSim","drawCanvasRef","simStep","useCallback","simData","current","centerX","centerY","brushHalfSize","round","cos","PI","useEffect","timer","setInterval","clearInterval","startLoop","stop","a","resolveDrawPromise","resolve","requestAnimationFrame","Promise","loop","Error","g","xa","ya","eAA","magXAA","magYAA","magZAA","mAA","permittivityValue","log","permeabilityValue","backgroundX","abs","backgroundY","graphical","makeRenderSimulatorCanvas","mode","canvas","changeMaterial","canvasPos","onInputDown","clientX","clientY","onInputMove","onInputUp","previousClickOption","setPreviousClickOption","signalBrushSize","setSignalBrushSize","signalBrushValue","setSignalBrushValue","materialBrushSize","setMaterialBrushSize","materialBrushValue","setMaterialBrushValue","ref","onMouseDown","onMouseMove","onMouseUp","onTouchStart","touches","onTouchMove","onTouchEnd","onContextMenu","preventDefault","bottom","right","href","rel","textDecoration","pointerEvents","left","top","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"wMAOA,SAASA,EAAkBC,GAAqD,IAApBC,EAAmB,uDAAH,EAExE,MAAO,CAAEC,OADKC,MAAMH,EAAM,GAAKA,EAAM,GAAKA,EAAM,IAAII,KAAKH,GACjCD,MAAOA,GAO5B,SAASK,EAAsBC,EAA0BC,EAAWC,EAAWC,EAAWR,GAC7FK,EAAMJ,OAAOK,EAAIC,EAAIF,EAAMN,MAAM,GAAKS,EAAIH,EAAMN,MAAM,GAAKM,EAAMN,MAAM,IAAMC,EAG1E,SAASS,EAAsBJ,EAA0BC,EAAWC,EAAWC,EAAWR,GAC7FK,EAAMJ,OAAOK,EAAIC,EAAIF,EAAMN,MAAM,GAAKS,EAAIH,EAAMN,MAAM,GAAKM,EAAMN,MAAM,KAAOC,EAiC3E,IClDDU,EAAa,CAACC,OAAOC,WAAYD,OAAOE,aACxCC,EAAeJ,EAAW,GAAKA,EAAW,GAI1CK,EAAqCL,EAAW,IAAMA,EAAW,GACnE,CAFoB,IAEFM,KAAKC,KAFH,IAE0BH,GAAe,GAC7D,CAACE,KAAKC,KAHc,IAGSH,GAHT,IAGyC,GAG3DI,EAAY,IDsDd,WAAYH,EAAoCI,GAAmB,IAAD,gCAb1DC,UAa0D,OAX1DC,SAW0D,OAV1DC,qBAU0D,OAT1DC,qBAS0D,OAR1DC,qBAQ0D,OAP1DC,qBAO0D,OAN1DC,qBAM0D,OAL1DC,qBAK0D,OAH1DC,kBAG0D,OAF1DC,iBAE0D,OAmMlEC,aAAe,SAACC,GACZ,IAAMC,EAAM,EAAKZ,KAAKa,eAAehC,OAC/BiC,EAAM,EAAKd,KAAKe,eAAelC,OACjCmC,EAAM,EAAKhB,KAAKiB,eAAepC,OAC7BqC,EAAO,EAAKlB,KAAKmB,eAAetC,OAChCuC,EAAO,EAAKpB,KAAKqB,eAAexC,OAChCyC,EAAO,EAAKtB,KAAKuB,eAAe1C,OAChC2C,EAAO,EAAKxB,KAAKyB,aAAa5C,OAEpCmC,EAAM,EAAKR,aAAa,EAAKR,KAAK0B,qBAAqB7C,OAAQmC,EAAKL,GACpE,EAAKX,KAAK0B,qBAAqB7C,OAAS,EAAK4B,YAAY,EAAKT,KAAK0B,qBAAqB7C,OAAQ8B,GAGhG,EAAKX,KAAKa,eAAehC,OAAS,EAAKwB,gBAAgBe,EAAME,EAAME,EAAMZ,EAAKD,GAC9E,EAAKX,KAAKe,eAAelC,OAAS,EAAKyB,gBAAgBY,EAAMI,EAAME,EAAMV,EAAKH,GAC9E,EAAKX,KAAKiB,eAAepC,OAAS,EAAK0B,gBAAgBW,EAAME,EAAMI,EAAMR,EAAKL,GAE9E,EAAKX,KAAK2B,MAAQhB,EAAK,GApNuC,KAuNlEiB,aAAe,SAACjB,GACZ,IAAMC,EAAM,EAAKZ,KAAKa,eAAehC,OAC/BiC,EAAM,EAAKd,KAAKe,eAAelC,OAC/BmC,EAAM,EAAKhB,KAAKiB,eAAepC,OAC/BqC,EAAO,EAAKlB,KAAKmB,eAAetC,OAChCuC,EAAO,EAAKpB,KAAKqB,eAAexC,OAChCyC,EAAO,EAAKtB,KAAKuB,eAAe1C,OAChC2C,EAAO,EAAKxB,KAAK6B,aAAahD,OAGpC,EAAKmB,KAAKmB,eAAetC,OAAS,EAAKqB,gBAAgBY,EAAKE,EAAKQ,EAAMN,EAAMP,GAC7E,EAAKX,KAAKqB,eAAexC,OAAS,EAAKsB,gBAAgBS,EAAKI,EAAKQ,EAAMJ,EAAMT,GAC7E,EAAKX,KAAKuB,eAAe1C,OAAS,EAAKuB,gBAAgBQ,EAAKE,EAAKU,EAAMF,EAAMX,GAE7E,EAAKX,KAAK2B,MAAQhB,EAAK,GArOuC,KAwOlEmB,YAAc,WACV,EAAK9B,KAAK2B,KAAO,EACjB,EAAK3B,KAAKa,eAAehC,OAAOE,KAAK,GACrC,EAAKiB,KAAKe,eAAelC,OAAOE,KAAK,GACrC,EAAKiB,KAAKiB,eAAepC,OAAOE,KAAK,GACrC,EAAKiB,KAAKmB,eAAetC,OAAOE,KAAK,GACrC,EAAKiB,KAAKqB,eAAexC,OAAOE,KAAK,GACrC,EAAKiB,KAAKuB,eAAe1C,OAAOE,KAAK,GACrC,EAAKiB,KAAK0B,qBAAqB7C,OAAOE,KAAK,IAhPmB,KAmPlEgD,eAAiB,WACb,EAAK/B,KAAK6B,aAAahD,OAAOE,KAAK,GACnC,EAAKiB,KAAKyB,aAAa5C,OAAOE,KAAK,IArP2B,KAwPlEiD,QAAU,kBAAM,EAAKhC,MAvPjBiC,KAAKjC,KAAO,CACR2B,KAAM,EACNd,eAAgBnC,EAAkBiB,GAClCoB,eAAgBrC,EAAkBiB,GAClCsB,eAAgBvC,EAAkBiB,GAClCwB,eAAgBzC,EAAkBiB,GAClC0B,eAAgB3C,EAAkBiB,GAClC4B,eAAgB7C,EAAkBiB,GAClC+B,qBAAsBhD,EAAkBiB,EAAU,GAClD8B,aAAc/C,EAAkBiB,EAAU,GAC1CkC,aAAcnD,EAAkBiB,EAAU,IAG9C,IAAMuC,EAAYvC,EAAS,GAAKA,EAAS,GAAKA,EAAS,GAIvD,SAASwC,EAAMlD,EAAiBmD,EAAgBC,EAAgBC,EAAgBpD,EAAWC,EAAWC,GAClG,OAAIF,EAAI,GAAKA,GAAKkD,GAAUjD,EAAI,GAAKA,GAAKkD,GAAUjD,EAAI,GAAKA,GAAKkD,EACvD,EAGJrD,EAAMC,EAAIC,EAAIiD,EAAShD,EAAIgD,EAASC,GAG/C,SAASE,EAAKC,EAAeJ,GACzB,OAAOI,EAAQJ,EAGnB,SAASK,EAAKD,EAAeJ,EAAgBC,GACzC,OAAOzC,KAAK8C,MAAMF,EAAQJ,GAAUC,EAGxC,SAASM,EAAKH,EAAeJ,EAAgBC,EAAgBC,GACzD,OAAO1C,KAAK8C,MAAMF,GAASJ,EAASC,IAAWC,EAnBnDL,KAAKhC,IAAM,IAAI2C,MAsBfX,KAAKzB,aAAeyB,KAAKhC,IAAI4C,cAAa,SAAUC,EAAkB7D,EAAiB0B,GACnF,IAAM6B,EAAQ5C,KAAK8C,MAAMT,KAAKc,OAAO7D,GAE/B8D,EAAKf,KAAKgB,UAAUC,UACpBC,EAAKlB,KAAKgB,UAAUG,UACpBC,EAAKpB,KAAKgB,UAAUK,UAEpBpE,EAAIqD,EAAKC,EAAOQ,GAChB7D,EAAIsD,EAAKD,EAAOQ,EAAIG,GACpB/D,EAAIuD,EAAKH,EAAOQ,EAAIG,EAAIE,GAE9B,OAAOlB,EAAMlD,EAAO+D,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAK+C,EAAMW,EAAQE,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAKuB,IACjF,CACC4C,OAAQ,CAACrB,GACTe,UAAW,CAAElD,SAAUA,EAAUmD,UAAWvD,EAAS,GAAIyD,UAAWzD,EAAS,GAAI2D,UAAW3D,EAAS,MACtG6D,aAAa,CAACjB,EAAME,EAAME,EAAMR,IAAQsB,iBAAgB,GAE3DxB,KAAKxB,YAAcwB,KAAKhC,IAAI4C,cAAa,SAAUC,EAAkBnC,GACjE,IAAM6B,EAAQ5C,KAAK8C,MAAMT,KAAKc,OAAO7D,GAE/B8D,EAAKf,KAAKgB,UAAUC,UACpBC,EAAKlB,KAAKgB,UAAUG,UACpBC,EAAKpB,KAAKgB,UAAUK,UAM1B,OAAOnB,EAAMW,EAAQE,EAAIG,EAAIE,EAJnBd,EAAKC,EAAOQ,GACZP,EAAKD,EAAOQ,EAAIG,GAChBR,EAAKH,EAAOQ,EAAIG,EAAIE,IAEczD,KAAK8D,IAAI,GAAK/C,KAC3D,CACC4C,OAAQ,CAACrB,GACTe,UAAW,CAAElD,SAAUA,EAAUmD,UAAWvD,EAAS,GAAIyD,UAAWzD,EAAS,GAAI2D,UAAW3D,EAAS,MACtG6D,aAAa,CAACjB,EAAME,EAAME,EAAMR,IAAQsB,iBAAgB,GAE3DxB,KAAK/B,gBAAkB+B,KAAKhC,IAAI4C,cAAa,SAAUc,EAAkBC,EAAkB/B,EAAwBgC,EAAqBlD,GACpI,IAAM6B,EAAQ5C,KAAK8C,MAAMT,KAAKc,OAAO7D,GAE/B8D,EAAKf,KAAKgB,UAAUC,UACpBC,EAAKlB,KAAKgB,UAAUG,UACpBC,EAAKpB,KAAKgB,UAAUK,UACpBQ,EAAK7B,KAAKgB,UAAUlD,SAEpBb,EAAIqD,EAAKC,EAAOQ,GAChB7D,EAAIsD,EAAKD,EAAOQ,EAAIG,GACpB/D,EAAIuD,EAAKH,EAAOQ,EAAIG,EAAIE,GAG9B,OAAOlB,EAAM0B,EAAWb,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAMuB,GAAMwB,EAAMN,EAAcmB,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAK0E,IAC5F3B,EAAMyB,EAAQZ,EAAIG,EAAIE,EAAInE,EAAGC,EAAI,EAAGC,GAAK+C,EAAMyB,EAAQZ,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,MAC/E,CACCmE,OAAQ,CAACrB,GACTe,UAAW,CAAElD,SAAUA,EAAUmD,UAAWvD,EAAS,GAAIyD,UAAWzD,EAAS,GAAI2D,UAAW3D,EAAS,MACtG6D,aAAa,CAACjB,EAAME,EAAME,EAAMR,IAAQsB,iBAAgB,GAE3DxB,KAAK9B,gBAAkB8B,KAAKhC,IAAI4C,cAAa,SAAUkB,EAAkBH,EAAkB/B,EAAwBmC,EAAqBrD,GACpI,IAAM6B,EAAQ5C,KAAK8C,MAAMT,KAAKc,OAAO7D,GAE/B8D,EAAKf,KAAKgB,UAAUC,UACpBC,EAAKlB,KAAKgB,UAAUG,UACpBC,EAAKpB,KAAKgB,UAAUK,UACpBQ,EAAK7B,KAAKgB,UAAUlD,SAEpBb,EAAIqD,EAAKC,EAAOQ,GAChB7D,EAAIsD,EAAKD,EAAOQ,EAAIG,GACpB/D,EAAIuD,EAAKH,EAAOQ,EAAIG,EAAIE,GAG9B,OAAOlB,EAAM6B,EAAWhB,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAMuB,GAAMwB,EAAMN,EAAcmB,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAK0E,KAC3F3B,EAAMyB,EAAQZ,EAAIG,EAAIE,EAAInE,EAAI,EAAGC,EAAGC,GAAK+C,EAAMyB,EAAQZ,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,MAChF,CACCmE,OAAQ,CAACrB,GACTe,UAAW,CAAElD,SAAUA,EAAUmD,UAAWvD,EAAS,GAAIyD,UAAWzD,EAAS,GAAI2D,UAAW3D,EAAS,MACtG6D,aAAa,CAACjB,EAAME,EAAME,EAAMR,IAAQsB,iBAAgB,GAE3DxB,KAAK7B,gBAAkB6B,KAAKhC,IAAI4C,cAAa,SAAUkB,EAAkBJ,EAAkB9B,EAAwBoC,EAAqBtD,GACpI,IAAM6B,EAAQ5C,KAAK8C,MAAMT,KAAKc,OAAO7D,GAE/B8D,EAAKf,KAAKgB,UAAUC,UACpBC,EAAKlB,KAAKgB,UAAUG,UACpBC,EAAKpB,KAAKgB,UAAUK,UACpBQ,EAAK7B,KAAKgB,UAAUlD,SAEpBb,EAAIqD,EAAKC,EAAOQ,GAChB7D,EAAIsD,EAAKD,EAAOQ,EAAIG,GACpB/D,EAAIuD,EAAKH,EAAOQ,EAAIG,EAAIE,GAG9B,OAAOlB,EAAM8B,EAAWjB,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAMuB,GAAMwB,EAAMN,EAAcmB,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAK0E,IAC5F3B,EAAMwB,EAAQX,EAAIG,EAAIE,EAAInE,EAAI,EAAGC,EAAGC,GAAK+C,EAAMwB,EAAQX,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,IACzE+C,EAAM4B,EAAQf,EAAIG,EAAIE,EAAInE,EAAGC,EAAI,EAAGC,GAAK+C,EAAM4B,EAAQf,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,OAC/E,CACCmE,OAAQ,CAACrB,GACTe,UAAW,CAAElD,SAAUA,EAAUmD,UAAWvD,EAAS,GAAIyD,UAAWzD,EAAS,GAAI2D,UAAW3D,EAAS,MACtG6D,aAAa,CAACjB,EAAME,EAAME,EAAMR,IAAQsB,iBAAgB,GAE3DxB,KAAK5B,gBAAkB4B,KAAKhC,IAAI4C,cAAa,SAAUc,EAAkBC,EAAkBnC,EAAwByC,EAAoBvD,GACnI,IAAM6B,EAAQ5C,KAAK8C,MAAMT,KAAKc,OAAO7D,GAE/B8D,EAAKf,KAAKgB,UAAUC,UACpBC,EAAKlB,KAAKgB,UAAUG,UACpBC,EAAKpB,KAAKgB,UAAUK,UACpBQ,EAAK7B,KAAKgB,UAAUlD,SAEpBb,EAAIqD,EAAKC,EAAOQ,GAChB7D,EAAIsD,EAAKD,EAAOQ,EAAIG,GACpB/D,EAAIuD,EAAKH,EAAOQ,EAAIG,EAAIE,GAG9B,OAAOlB,EAAM+B,EAAUlB,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAMuB,GAAMwB,EAAMV,EAAcuB,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAK0E,IAC3F3B,EAAMyB,EAAQZ,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAK+C,EAAMyB,EAAQZ,EAAIG,EAAIE,EAAInE,EAAGC,EAAI,EAAGC,MAC/E,CACCmE,OAAQ,CAACrB,GACTe,UAAW,CAAElD,SAAUA,EAAUmD,UAAWvD,EAAS,GAAIyD,UAAWzD,EAAS,GAAI2D,UAAW3D,EAAS,MACtG6D,aAAa,CAACjB,EAAME,EAAME,EAAMR,IAAQsB,iBAAgB,GAE3DxB,KAAK3B,gBAAkB2B,KAAKhC,IAAI4C,cAAa,SAAUkB,EAAkBH,EAAkBnC,EAAwB0C,EAAoBxD,GACnI,IAAM6B,EAAQ5C,KAAK8C,MAAMT,KAAKc,OAAO7D,GAE/B8D,EAAKf,KAAKgB,UAAUC,UACpBC,EAAKlB,KAAKgB,UAAUG,UACpBC,EAAKpB,KAAKgB,UAAUK,UACpBQ,EAAK7B,KAAKgB,UAAUlD,SAEpBb,EAAIqD,EAAKC,EAAOQ,GAChB7D,EAAIsD,EAAKD,EAAOQ,EAAIG,GACpB/D,EAAIuD,EAAKH,EAAOQ,EAAIG,EAAIE,GAG9B,OAAOlB,EAAMgC,EAAUnB,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAMuB,GAAMwB,EAAMV,EAAcuB,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAK0E,KAC1F3B,EAAMyB,EAAQZ,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAK+C,EAAMyB,EAAQZ,EAAIG,EAAIE,EAAInE,EAAI,EAAGC,EAAGC,MAChF,CACCmE,OAAQ,CAACrB,GACTe,UAAW,CAAElD,SAAUA,EAAUmD,UAAWvD,EAAS,GAAIyD,UAAWzD,EAAS,GAAI2D,UAAW3D,EAAS,MACtG6D,aAAa,CAACjB,EAAME,EAAME,EAAMR,IAAQsB,iBAAgB,GAE3DxB,KAAK1B,gBAAkB0B,KAAKhC,IAAI4C,cAAa,SAAUkB,EAAkBJ,EAAkBlC,EAAwB2C,EAAoBzD,GACnI,IAAM6B,EAAQ5C,KAAK8C,MAAMT,KAAKc,OAAO7D,GAE/B8D,EAAKf,KAAKgB,UAAUC,UACpBC,EAAKlB,KAAKgB,UAAUG,UACpBC,EAAKpB,KAAKgB,UAAUK,UACpBQ,EAAK7B,KAAKgB,UAAUlD,SAEpBb,EAAIqD,EAAKC,EAAOQ,GAChB7D,EAAIsD,EAAKD,EAAOQ,EAAIG,GACpB/D,EAAIuD,EAAKH,EAAOQ,EAAIG,EAAIE,GAG9B,OAAOlB,EAAMiC,EAAUpB,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAMuB,GAAMwB,EAAMV,EAAcuB,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAK0E,IAC3F3B,EAAMwB,EAAQX,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAK+C,EAAMwB,EAAQX,EAAIG,EAAIE,EAAInE,EAAI,EAAGC,EAAGC,IACzE+C,EAAM4B,EAAQf,EAAIG,EAAIE,EAAInE,EAAGC,EAAGC,GAAK+C,EAAM4B,EAAQf,EAAIG,EAAIE,EAAInE,EAAGC,EAAI,EAAGC,OAC/E,CACCmE,OAAQ,CAACrB,GACTe,UAAW,CAAElD,SAAUA,EAAUmD,UAAWvD,EAAS,GAAIyD,UAAWzD,EAAS,GAAI2D,UAAW3D,EAAS,MACtG6D,aAAa,CAACjB,EAAME,EAAME,EAAMR,IAAQsB,iBAAgB,GCtPjD,CAAkB9D,EAFnB,KAuDjB,SAAS0E,EAAMC,EAAaC,EAAa3F,GACrC,OAAOgB,KAAK2E,IAAID,EAAK1E,KAAK0E,IAAIC,EAAK3F,IAYvC,SAAS4F,EAAcC,GACnB,OACI,6BACI,+BAAQA,EAAMC,OACd,6BACI,2BAAOC,KAAK,QAAQL,IAAKG,EAAMH,IAAKC,IAAKE,EAAMF,IAAK3F,MAAO6F,EAAM7F,MAAOgG,KAAMH,EAAMG,KAChFC,SAAU,SAAAC,GAAC,OAAIL,EAAMM,SAASC,WAAWF,EAAEG,OAAOrG,SAASsG,MAAO,CAAEC,OAAQ,GAAIC,MAAO,UAC3F,yBAAKF,MAAO,CAAEG,UAAW,SAAUC,WAAY,GAAKC,aAAc,QAC7Dd,EAAM7F,SAa3B,SAAS4G,EAAef,GACpB,OACI,6BACKA,EAAMgB,QAAQC,KAAI,SAACC,EAAQC,GAAT,OACf,4BAAQC,IAAKF,EAAQT,MAAO,CACxBY,UAAW,aACXC,OAAQH,IAAgBnB,EAAMuB,eAAiB,6BAA+B,IAC9Eb,OAAQ,OACRc,OAAQ,MACRb,MAAM,GAAD,OAAK,IAAMX,EAAMgB,QAAQS,OAAzB,KAAoCC,WAAY,qBAAsBC,MAAO,SAElFC,QAAS,SAAAvB,GAAC,OAAIL,EAAM6B,kBAAkBV,KACrCD,OAwBrB,SAASY,EAAc9B,GAA4B,IAAD,EACZ+B,oBAAS,GADG,mBACvCC,EADuC,KAC5BC,EAD4B,KAG9C,OACI,yBAAKxB,MAAO,CAAEyB,WAAY,SACtB,yBAAKzB,MAAO,CAAEG,UAAW,SAAUuB,SAAU,WAAYC,QAAS,GAAKV,WAAY,wBAAyBW,WAAY,UAAWV,MAAO,UACtI,4BAAQC,QAAS,SAAAvB,GAAC,OAAI4B,GAAcD,IAAYvB,MAAO,CAAEE,MAAO,OAAQD,OAAQ,OAAQgB,WAAY,wBAAyBJ,OAAQ,MAAOK,MAAO,QAASU,WAAY,OAAQC,OAAQ,YAAxL,aACeN,EAAY,IAAM,IADjC,MAGEA,GACE,yBAAKvB,MAAO,CAAE8B,QAAS,SACnB,kBAACxC,EAAD,CAAeE,MAAM,aAAa9F,MAAO6F,EAAMwC,UAAWlC,SAAUN,EAAMyC,aAAc5C,IAAK,EAAGC,IAAK,IAAKK,KAAM,IAChH,kBAACJ,EAAD,CAAeE,MAAM,cAAc9F,MAAO6F,EAAM0C,WAAYpC,SAAUN,EAAM2C,cAAe9C,IAAK,EAAGC,IAAK,IAAKK,KAAM,IACnH,kBAACJ,EAAD,CAAeE,MAAM,mBAAmB9F,MAAO6F,EAAM4C,gBAAiBtC,SAAUN,EAAM6C,mBAAoBhD,IAAK,EAAGC,IAAK,EAAGK,KAAM,KAChI,kBAACY,EAAD,CAAgBC,QAAS,CAAC,eAAW,aAAW,UAAWO,eAAgBvB,EAAM8C,YAAajB,kBAAmB7B,EAAM+C,iBACvH,4BAAQnB,QAAS5B,EAAM3C,YAAaoD,MAAO,CAAEiB,WAAY,wBAAyBJ,OAAQ,MAAOK,MAAO,QAASH,OAAQ,QAAzH,gBACA,4BAAQI,QAAS5B,EAAM1C,eAAgBmD,MAAO,CAAEiB,WAAY,wBAAyBJ,OAAQ,MAAOK,MAAO,QAASH,OAAQ,QAA5H,sBC7IJwB,QACW,cAA7BlI,OAAOmI,SAASC,UAEe,UAA7BpI,OAAOmI,SAASC,UAEhBpI,OAAOmI,SAASC,SAASC,MACvB,2DCZNC,IAASC,OAAO,mBFgKD,WAAa,IAAD,EACWtB,mBALP,GAIJ,mBAChBS,EADgB,KACLC,EADK,OAEaV,mBAPR,IAKL,mBAEhBW,EAFgB,KAEJC,EAFI,OAGuBZ,mBAAS,GAHhC,mBAGhBa,EAHgB,KAGCC,EAHD,OAI+Bd,oBAAS,GAJxC,mBAIhBuB,EAJgB,KAIKC,EAJL,OAK+BxB,oBAAS,GALxC,mBAKhByB,EALgB,KAKKC,EALL,OAMe1B,mBAAS,GANxB,mBAMhBe,EANgB,KAMHC,EANG,OAWmBhB,mBAAkC,MAXrD,mBAWhB2B,EAXgB,KAWDC,EAXC,KAajBC,EAAiBC,iBAAO,GACxBC,EAAeD,iBAAgC,MAC/CE,EAAYF,iBAAkC,MAC9CG,EAAgBH,iBAA0B,MAE1CI,EAAUC,uBAAY,WACxB,IAAMC,EAAU9I,EAAUkC,UAE1B,GAA6B,OAAzBuG,EAAaM,SAAoBJ,EAAcI,QAK/C,IAJA,IAAMC,EAAUzE,EAAM,EAAGuE,EAAQlH,qBAAqB/C,MAAM,GAAK,EAAGiB,KAAK8C,MAAMkG,EAAQlH,qBAAqB/C,MAAM,GAAK4J,EAAaM,QAAQ,GAAKJ,EAAcI,QAAQzD,QACjK2D,EAAU1E,EAAM,EAAGuE,EAAQlH,qBAAqB/C,MAAM,GAAK,EAAGiB,KAAK8C,MAAMkG,EAAQlH,qBAAqB/C,MAAM,GAAK4J,EAAaM,QAAQ,GAAKJ,EAAcI,QAAQ1D,SACjK6D,EAAgBpJ,KAAKqJ,MAAMhC,EAAY,GAEpC/H,EAAIU,KAAK2E,IAAI,EAAGuE,EAAUE,GAAgB9J,GAAKU,KAAK0E,IAAI3E,EAAS,GAAK,EAAGmJ,EAAUE,GAAgB9J,IACxG,IAAK,IAAIC,EAAIS,KAAK2E,IAAI,EAAGwE,EAAUC,GAAgB7J,GAAKS,KAAK0E,IAAI3E,EAAS,GAAK,EAAGoJ,EAAUC,GAAgB7J,IACxG,IAAK,IAAIC,EAAI,EAAGA,EAAIwJ,EAAQlH,qBAAqB/C,MAAM,GAAIS,IACvDC,EAAsBuJ,EAAQlH,qBAAsBxC,EAAGC,EAAGC,EAAiB,KAAb+H,EAAoBvH,KAAKsJ,IAAI,EAAItJ,KAAKuJ,GAAK9B,EAAkBuB,EAAQjH,MA5LhJ,KAkMH7B,EAAU8B,aAlMP,KAmMH9B,EAAUY,aAnMP,OAoMJ,CAAC2G,EAAiBF,EAAYF,IAEjCmC,qBAAU,WACN,IAAMC,EAAQC,YAAYZ,EAAS,IACnC,OAAO,kBAAMa,cAAcF,MAC5B,CAACX,IAEJ,IAAMc,EAAYb,uBAAY,WAC1B,IAAIc,GAAO,EAoBX,OAlBU,uCAAI,8BAAAC,EAAA,sDACJC,EAAqB,SAACC,GAAD,OAAwCC,sBAAsBD,IAD/E,UAGFH,EAHE,uBAIAb,EAAU9I,EAAUkC,WAEdL,KAAO,GAA2B,OAAtB6G,EAAUK,SAC9BL,EAAUK,QAAQD,EAAQ/H,eAAehC,OAAQ+J,EAAQ7H,eAAelC,OAAQ+J,EAAQ3H,eAAepC,OACnG+J,EAAQzH,eAAetC,OAAQ+J,EAAQvH,eAAexC,OAAQ+J,EAAQrH,eAAe1C,OACrF+J,EAAQnH,aAAa5C,OAAQ+J,EAAQ/G,aAAahD,QATpD,SAYA,IAAIiL,QAAQH,GAZZ,iEAAJ,oDAgBVI,GAEO,WAAQN,GAAO,KACvB,IAEHL,qBAAU,WACN,IAAIX,EAAcI,QAGd,MAAM,IAAImB,MAAM,uBAFhBxB,EAAUK,QA5NY,SAACoB,GAC/B,SAAS9H,EAAMlD,EAAiBmD,EAAgBC,EAAgBC,EAAgBpD,EAAWC,EAAWC,GAClG,OAAIF,EAAI,GAAKA,GAAKkD,GAAUjD,EAAI,GAAKA,GAAKkD,GAAUjD,EAAI,GAAKA,GAAKkD,EACvD,EAGJrD,EAAMC,EAAIC,EAAIiD,EAAShD,EAAIgD,EAASC,GAG/C,OAAO4H,EAAEpH,cAAa,SAAUhC,EAA0BE,EAA0BE,EAChFE,EAA0BE,EAA0BE,EACpDE,EAAwBI,GACxB,IAAMmB,EAAKf,KAAKgB,UAAUC,UACpBC,EAAKlB,KAAKgB,UAAUG,UACpBC,EAAKpB,KAAKgB,UAAUK,UAEpBpE,EAAI8D,EAAKf,KAAKc,OAAO7D,EAAM+C,KAAKsB,OAAOrE,EACvCC,EAAIgE,GAAM,EAAIlB,KAAKc,OAAO5D,EAAM8C,KAAKsB,OAAOpE,GAC5C+K,EAAKtK,KAAK8C,MAAMxD,GAChBiL,EAAKvK,KAAK8C,MAAMvD,GAEhBC,EAAIQ,KAAK8C,MAAMW,EAAK,GAEpB+G,EACFjI,EAAMtB,EAAgBmC,EAAIG,EAAIE,EAAI6G,EAAIC,EAAI/K,GAAK+C,EAAMtB,EAAgBmC,EAAIG,EAAIE,EAAI6G,EAAIC,EAAI/K,GACzF+C,EAAMpB,EAAgBiC,EAAIG,EAAIE,EAAI6G,EAAIC,EAAI/K,GAAK+C,EAAMpB,EAAgBiC,EAAIG,EAAIE,EAAI6G,EAAIC,EAAI/K,GACzF+C,EAAMlB,EAAgB+B,EAAIG,EAAIE,EAAI6G,EAAIC,EAAI/K,GAAK+C,EAAMlB,EAAgB+B,EAAIG,EAAIE,EAAI6G,EAAIC,EAAI/K,GAGvFiL,GAAUlI,EAAMhB,EAAgB6B,EAAIG,EAAIE,EAAI6G,EAAIC,EAAI/K,GAAK+C,EAAMhB,EAAgB6B,EAAIG,EAAIE,EAAI6G,EAAK,EAAGC,EAAK,EAAG/K,IAAM,EACjHkL,GAAUnI,EAAMd,EAAgB2B,EAAIG,EAAIE,EAAI6G,EAAIC,EAAI/K,GAAK+C,EAAMd,EAAgB2B,EAAIG,EAAIE,EAAI6G,EAAK,EAAGC,EAAK,EAAG/K,IAAM,EACjHmL,GAAUpI,EAAMZ,EAAgByB,EAAIG,EAAIE,EAAI6G,EAAIC,EAAI/K,GAAK+C,EAAMZ,EAAgByB,EAAIG,EAAIE,EAAI6G,EAAK,EAAGC,EAAK,EAAG/K,IAAM,EAEjHoL,EAAMH,EAASA,EAASC,EAASA,EAASC,EAASA,EAInDE,EAAoB7K,KAAK2E,IAAI,EAAG3E,KAAK0E,IAAI,GAAI,EAAI,YAAe1E,KAAK8K,IAAIvI,EAAMV,EAAcuB,EAAIG,EAAIE,EAAI6G,EAAIC,EAAI/K,KAAO,IACxHuL,EAAoB/K,KAAK2E,IAAI,EAAG3E,KAAK0E,IAAI,GAAI,EAAI,YAAe1E,KAAK8K,IAAIvI,EAAMN,EAAcmB,EAAIG,EAAIE,EAAI6G,EAAIC,EAAI/K,KAAO,IAExHwL,GAAehL,KAAKiL,IAAI3L,EAAI,EAAI,IAAO,IAAO,EAAI,IAAMU,KAAKiL,IAAI1L,EAAI,EAAI,IAAO,IAAO,EAAI,GAC3F2L,EAAc,EAAIF,EAExB3I,KAAKmE,MAAMgE,EARG,GAQW,GAAMQ,EAAcH,EAAmBL,EARlD,GAQgEI,EARhE,GAQ6EA,EAR7E,GAQ2F,GAAMM,EAAcH,KAC9H,CACCpH,OAAQ,CAACjE,EAAW,GAAIA,EAAW,IACnC2D,UAAW,CAAEC,UAAWvD,EAAS,GAAIyD,UAAWzD,EAAS,GAAI2D,UAAW3D,EAAS,IACjFoL,WAAW,IACZvH,aAAa,CAACrB,IAAQsB,iBAAgB,GA4KbuH,CAA0B,IAAIpI,MAAI,CAAEqI,KAAM,QAASC,OAAQzC,EAAcI,WAKjGW,MACD,CAACA,IAEJ,IAAM2B,EAAiBxC,uBAAY,SAAC1J,EAA0BmM,GAK1D,IAJA,IAAMtC,EAAUlJ,KAAKqJ,MAAMtJ,EAAS,IAAMyL,EAAU,GAAK9L,EAAW,KAC9DyJ,EAAUnJ,KAAKqJ,MAAMtJ,EAAS,IAAMyL,EAAU,GAAK9L,EAAW,KAC9D0J,EAAgBpJ,KAAKqJ,MAAMhC,EAAY,GAEpC/H,EAAIU,KAAK2E,IAAI,EAAGuE,EAAUE,GAAgB9J,GAAKU,KAAK0E,IAAI3E,EAAS,GAAK,EAAGmJ,EAAUE,GAAgB9J,IACxG,IAAK,IAAIC,EAAIS,KAAK2E,IAAI,EAAGwE,EAAUC,GAAgB7J,GAAKS,KAAK0E,IAAI3E,EAAS,GAAK,EAAGoJ,EAAUC,GAAgB7J,IACxGH,EAAsBC,EAAOC,EAAGC,EAAG,EAAGgI,KAG/C,CAACF,EAAWE,IAETpF,EAAiB4G,uBAAY,WAC/B7I,EAAUiC,mBACX,IAEGD,EAAc6G,uBAAY,WAC5B7I,EAAUgC,cACVuG,EAAeQ,QAAU,IAC1B,IAEGwC,EAAc1C,uBAAY,YAA2C,IAAD,mBAAxC2C,EAAwC,KAA/BC,EAA+B,KA1FrD,IA2FbhE,EACAgB,EAAaM,QAAU,CAACyC,EAASC,GA9FT,IA+FjBhE,GACP4D,EAAerL,EAAUkC,UAAUP,aAAc,CAAC6J,EAASC,IAC3DrD,GAAuB,IAhGC,IAiGjBX,IACP4D,EAAerL,EAAUkC,UAAUH,aAAc,CAACyJ,EAASC,IAC3DvD,GAAuB,MAE5B,CAACmD,EAAgB5D,IAEdiE,EAAc7C,uBAAY,YAA2C,IAAD,mBAAxC2C,EAAwC,KAA/BC,EAA+B,KAtGrD,IAuGbhE,GAAyD,OAAzBgB,EAAaM,UAC7CN,EAAaM,QAAU,CAACyC,EAASC,IAGjCtD,GACAkD,EAAerL,EAAUkC,UAAUP,aAAc,CAAC6J,EAASC,IAG3DxD,GACAoD,EAAerL,EAAUkC,UAAUH,aAAc,CAACyJ,EAASC,MAEhE,CAACJ,EAAgB5D,EAAaQ,EAAqBE,IAEhDwD,EAAY9C,uBAAY,WApHT,IAqHbpB,EACAgB,EAAaM,QAAU,KAvHC,IAwHjBtB,EACPS,GAAuB,GA1HC,IA2HjBT,GACPW,GAAuB,KAE5B,CAACX,IArImB,EAwI+Bf,mBA/HjC,GATE,oBAwIhBkF,GAxIgB,MAwIKC,GAxIL,SAyIuBnF,mBA7InB,GAIJ,qBAyIhBoF,GAzIgB,MAyICC,GAzID,SA0IyBrF,mBA/IpB,IAKL,qBA0IhBsF,GA1IgB,MA0IEC,GA1IF,SA2I2BvF,mBA7IrB,GAEN,qBA2IhBwF,GA3IgB,MA2IGC,GA3IH,SA4I6BzF,mBA/ItB,GAGP,qBA4IhB0F,GA5IgB,MA4IIC,GA5IJ,MA6JvB,OAhBA/C,qBAAU,WApIW,IAqIb7B,GArIa,IAqImBmE,IAChCO,GAAqBhF,GACrBkF,GAAsBhF,GACtBD,EAAa0E,IACbxE,EAAc0E,KAzID,IA0INvE,GA1IM,IA0I0BmE,KACvCG,GAAmB5E,GACnB8E,GAAoB5E,GACpBD,EAAa8E,IACb5E,EAAc8E,KAGlBP,GAAuBpE,KACxB,CAACA,EAAamE,GAAqBE,GAAiBE,GAAkBE,GAAmBE,GAAoBjF,EAAWE,IAGvH,6BACI,4BAAQ/B,MAAO9F,EAAW,GAAI6F,OAAQ7F,EAAW,GAAI8M,IAAK3D,EAAevD,MAAO,CAAE0B,SAAU,WAAYD,WAAY,QAChH0F,YAAa,SAAAvH,GAAC,OAAIuG,EAAY,CAACvG,EAAEwG,QAASxG,EAAEyG,WAC5Ce,YAAa,SAAAxH,GAAOsD,EAAiB,CAACtD,EAAEwG,QAASxG,EAAEyG,UAAWC,EAAY,CAAC1G,EAAEwG,QAASxG,EAAEyG,WACxFgB,UAAW,SAAAzH,GAAC,OAAI2G,KAChBe,aAAc,SAAA1H,GAAC,OAAIuG,EAAY,CAACvG,EAAE2H,QAAQ,GAAGnB,QAASxG,EAAE2H,QAAQ,GAAGlB,WACnEmB,YAAa,SAAA5H,GAAC,OAAI0G,EAAY,CAAC1G,EAAE2H,QAAQ,GAAGnB,QAASxG,EAAE2H,QAAQ,GAAGlB,WAClEoB,WAAY,SAAA7H,GAAC,OAAI2G,KACjBmB,cAAe,SAAA9H,GAAC,OAAIA,EAAE+H,oBAG1B,yBAAK3H,MAAO,CAAE0B,SAAU,WAAYkG,OAAQ,GAAIC,MAAO,GAAIpG,WAAY,SACnE,uBAAGqG,KAAK,gDAAgDC,IAAI,sBAAsBhI,OAAO,SAASC,MAAO,CAAE4B,WAAY,UAAWV,MAAO,2BAA4B8G,eAAgB,SAArL,gBAGH/E,GACG,yBAAKjD,MAAO,CAAE0B,SAAU,WAAYuG,cAAe,OAAQC,KAAMjF,EAAc,GAAM,GAAKlB,EAAY,GAAKoG,IAAKlF,EAAc,GAAM,GAAKlB,EAAY,GAAK7B,MAAO,GAAK6B,EAAY,GAAI9B,OAAQ,GAAK8B,EAAY,GAAIlB,OAAQ,sBAG/N,kBAACQ,EAAD,CAAeU,UAAWA,EAAWC,aAAcA,EAC/CC,WAAYA,EAAYC,cAAeA,EACvCC,gBAAiBA,EAAiBC,mBAAoBA,EACtDC,YAAaA,EAAaC,eAAgBA,EAC1C1F,YAAaA,EAAaC,eAAgBA,OErV1C,MAASuL,SAASC,eAAe,SDmI3C,kBAAmBC,WACrBA,UAAUC,cAAcC,MAAMC,MAAK,SAAAC,GACjCA,EAAaC,iB","file":"static/js/main.97e61e3b.chunk.js","sourcesContent":["import { GPU, IKernelRunShortcut } from \"gpu.js\"\r\n\r\nexport type FlatScalarField3D = {\r\n    values: number[]\r\n    shape: [number, number, number]\r\n}\r\n\r\nfunction makeScalarField3D(shape: [number, number, number], value: number = 0) {\r\n    const field = Array(shape[0] * shape[1] * shape[2]).fill(value)\r\n    return { values: field, shape: shape }\r\n}\r\n\r\nexport function indexToCoords(index: number, shape: [number, number, number]): [number, number, number] {\r\n    return [index % shape[0], Math.floor(index / shape[0]) % shape[1], Math.floor(index / (shape[0] * shape[1])) % shape[2]]\r\n}\r\n\r\nexport function setScalarField3DValue(field: FlatScalarField3D, x: number, y: number, z: number, value: number) {\r\n    field.values[x + y * field.shape[0] + z * field.shape[0] * field.shape[1]] = value\r\n}\r\n\r\nexport function addScalarField3DValue(field: FlatScalarField3D, x: number, y: number, z: number, value: number) {\r\n    field.values[x + y * field.shape[0] + z * field.shape[0] * field.shape[1]] += value\r\n}\r\n\r\nexport function updateScalarField3DValue(field: FlatScalarField3D, x: number, y: number, z: number, getValue: (current: number) => number) {\r\n    field.values[x + y * field.shape[0] + z * field.shape[0] * field.shape[1]] = getValue(field.values[x + y * field.shape[0] + z * field.shape[0] * field.shape[1]])\r\n}\r\n\r\nexport function getScalarField3DValue(field: FlatScalarField3D, x: number, y: number, z: number) {\r\n    return field.values[x + y * field.shape[0] + z * field.shape[0] * field.shape[1]]\r\n}\r\n\r\nexport type SimulationData = {\r\n    time: number\r\n    electricFieldX: FlatScalarField3D\r\n    electricFieldY: FlatScalarField3D\r\n    electricFieldZ: FlatScalarField3D\r\n    magneticFieldX: FlatScalarField3D\r\n    magneticFieldY: FlatScalarField3D\r\n    magneticFieldZ: FlatScalarField3D\r\n    permittivity: FlatScalarField3D\r\n    permeability: FlatScalarField3D\r\n\r\n    electricSourceFieldZ: FlatScalarField3D\r\n}\r\n\r\nexport interface Simulator {\r\n    stepElectric: (dt: number) => void\r\n    stepMagnetic: (dt: number) => void\r\n    resetFields: () => void\r\n    resetMaterials: () => void\r\n    getData: () => SimulationData\r\n}\r\n\r\nexport class FDTDSimulator implements Simulator {\r\n    private data: SimulationData\r\n\r\n    private gpu: GPU\r\n    private updateMagneticX: IKernelRunShortcut\r\n    private updateMagneticY: IKernelRunShortcut\r\n    private updateMagneticZ: IKernelRunShortcut\r\n    private updateElectricX: IKernelRunShortcut\r\n    private updateElectricY: IKernelRunShortcut\r\n    private updateElectricZ: IKernelRunShortcut\r\n\r\n    private injectSource: IKernelRunShortcut\r\n    private decaySource: IKernelRunShortcut\r\n\r\n    constructor(gridSize: [number, number, number], cellSize: number) {\r\n        this.data = {\r\n            time: 0,\r\n            electricFieldX: makeScalarField3D(gridSize),\r\n            electricFieldY: makeScalarField3D(gridSize),\r\n            electricFieldZ: makeScalarField3D(gridSize),\r\n            magneticFieldX: makeScalarField3D(gridSize),\r\n            magneticFieldY: makeScalarField3D(gridSize),\r\n            magneticFieldZ: makeScalarField3D(gridSize),\r\n            electricSourceFieldZ: makeScalarField3D(gridSize, 0),\r\n            permittivity: makeScalarField3D(gridSize, 1),\r\n            permeability: makeScalarField3D(gridSize, 1),\r\n        }\r\n\r\n        const cellCount = gridSize[0] * gridSize[1] * gridSize[2]\r\n\r\n        this.gpu = new GPU()\r\n\r\n        function getAt(field: number[], shapeX: number, shapeY: number, shapeZ: number, x: number, y: number, z: number) {\r\n            if (x < 0 || x >= shapeX || y < 0 || y >= shapeY || z < 0 || z >= shapeZ) {\r\n                return 0\r\n            }\r\n\r\n            return field[x + y * shapeX + z * shapeX * shapeY]\r\n        }\r\n\r\n        function getX(index: number, shapeX: number) {\r\n            return index % shapeX\r\n        }\r\n\r\n        function getY(index: number, shapeX: number, shapeY: number) {\r\n            return Math.floor(index / shapeX) % shapeY\r\n        }\r\n\r\n        function getZ(index: number, shapeX: number, shapeY: number, shapeZ: number) {\r\n            return Math.floor(index / (shapeX * shapeY)) % shapeZ\r\n        }\r\n\r\n        this.injectSource = this.gpu.createKernel(function (source: number[], field: number[], dt: number) {\r\n            const index = Math.floor(this.thread.x)\r\n\r\n            const gx = this.constants.gridSizeX as number\r\n            const gy = this.constants.gridSizeY as number\r\n            const gz = this.constants.gridSizeZ as number\r\n\r\n            const x = getX(index, gx)\r\n            const y = getY(index, gx, gy)\r\n            const z = getZ(index, gx, gy, gz)\r\n\r\n            return getAt(field, gx, gy, gz, x, y, z) + getAt(source, gx, gy, gz, x, y, z) * dt\r\n        }, {\r\n            output: [cellCount],\r\n            constants: { cellSize: cellSize, gridSizeX: gridSize[0], gridSizeY: gridSize[1], gridSizeZ: gridSize[2] },\r\n        }).setFunctions([getX, getY, getZ, getAt]).setWarnVarUsage(false)\r\n\r\n        this.decaySource = this.gpu.createKernel(function (source: number[], dt: number) {\r\n            const index = Math.floor(this.thread.x)\r\n\r\n            const gx = this.constants.gridSizeX as number\r\n            const gy = this.constants.gridSizeY as number\r\n            const gz = this.constants.gridSizeZ as number\r\n\r\n            const x = getX(index, gx)\r\n            const y = getY(index, gx, gy)\r\n            const z = getZ(index, gx, gy, gz)\r\n\r\n            return getAt(source, gx, gy, gz, x, y, z) * Math.pow(0.1, dt)\r\n        }, {\r\n            output: [cellCount],\r\n            constants: { cellSize: cellSize, gridSizeX: gridSize[0], gridSizeY: gridSize[1], gridSizeZ: gridSize[2] },\r\n        }).setFunctions([getX, getY, getZ, getAt]).setWarnVarUsage(false)\r\n\r\n        this.updateMagneticX = this.gpu.createKernel(function (fieldY: number[], fieldZ: number[], permeability: number[], magFieldX: number[], dt: number) {\r\n            const index = Math.floor(this.thread.x)\r\n\r\n            const gx = this.constants.gridSizeX as number\r\n            const gy = this.constants.gridSizeY as number\r\n            const gz = this.constants.gridSizeZ as number\r\n            const cs = this.constants.cellSize as number\r\n\r\n            const x = getX(index, gx)\r\n            const y = getY(index, gx, gy)\r\n            const z = getZ(index, gx, gy, gz)\r\n\r\n            // d_Y Z - d_Z Y\r\n            return getAt(magFieldX, gx, gy, gz, x, y, z) - (dt / (getAt(permeability, gx, gy, gz, x, y, z) * cs)) * (\r\n                (getAt(fieldZ, gx, gy, gz, x, y + 1, z) - getAt(fieldZ, gx, gy, gz, x, y, z)))\r\n        }, {\r\n            output: [cellCount],\r\n            constants: { cellSize: cellSize, gridSizeX: gridSize[0], gridSizeY: gridSize[1], gridSizeZ: gridSize[2] },\r\n        }).setFunctions([getX, getY, getZ, getAt]).setWarnVarUsage(false)\r\n\r\n        this.updateMagneticY = this.gpu.createKernel(function (fieldX: number[], fieldZ: number[], permeability: number[], magFieldY: number[], dt: number) {\r\n            const index = Math.floor(this.thread.x)\r\n\r\n            const gx = this.constants.gridSizeX as number\r\n            const gy = this.constants.gridSizeY as number\r\n            const gz = this.constants.gridSizeZ as number\r\n            const cs = this.constants.cellSize as number\r\n\r\n            const x = getX(index, gx)\r\n            const y = getY(index, gx, gy)\r\n            const z = getZ(index, gx, gy, gz)\r\n\r\n            // d_Z X - d_X Z\r\n            return getAt(magFieldY, gx, gy, gz, x, y, z) - (dt / (getAt(permeability, gx, gy, gz, x, y, z) * cs)) * (\r\n                -(getAt(fieldZ, gx, gy, gz, x + 1, y, z) - getAt(fieldZ, gx, gy, gz, x, y, z)))\r\n        }, {\r\n            output: [cellCount],\r\n            constants: { cellSize: cellSize, gridSizeX: gridSize[0], gridSizeY: gridSize[1], gridSizeZ: gridSize[2] }\r\n        }).setFunctions([getX, getY, getZ, getAt]).setWarnVarUsage(false)\r\n\r\n        this.updateMagneticZ = this.gpu.createKernel(function (fieldX: number[], fieldY: number[], permeability: number[], magFieldZ: number[], dt: number) {\r\n            const index = Math.floor(this.thread.x)\r\n\r\n            const gx = this.constants.gridSizeX as number\r\n            const gy = this.constants.gridSizeY as number\r\n            const gz = this.constants.gridSizeZ as number\r\n            const cs = this.constants.cellSize as number\r\n\r\n            const x = getX(index, gx)\r\n            const y = getY(index, gx, gy)\r\n            const z = getZ(index, gx, gy, gz)\r\n\r\n            // d_X Y - d_Y X\r\n            return getAt(magFieldZ, gx, gy, gz, x, y, z) - (dt / (getAt(permeability, gx, gy, gz, x, y, z) * cs)) * (\r\n                (getAt(fieldY, gx, gy, gz, x + 1, y, z) - getAt(fieldY, gx, gy, gz, x, y, z)) -\r\n                (getAt(fieldX, gx, gy, gz, x, y + 1, z) - getAt(fieldX, gx, gy, gz, x, y, z)))\r\n        }, {\r\n            output: [cellCount],\r\n            constants: { cellSize: cellSize, gridSizeX: gridSize[0], gridSizeY: gridSize[1], gridSizeZ: gridSize[2] }\r\n        }).setFunctions([getX, getY, getZ, getAt]).setWarnVarUsage(false)\r\n\r\n        this.updateElectricX = this.gpu.createKernel(function (fieldY: number[], fieldZ: number[], permittivity: number[], elFieldX: number[], dt: number) {\r\n            const index = Math.floor(this.thread.x)\r\n\r\n            const gx = this.constants.gridSizeX as number\r\n            const gy = this.constants.gridSizeY as number\r\n            const gz = this.constants.gridSizeZ as number\r\n            const cs = this.constants.cellSize as number\r\n\r\n            const x = getX(index, gx)\r\n            const y = getY(index, gx, gy)\r\n            const z = getZ(index, gx, gy, gz)\r\n\r\n            // d_Y Z - d_Z Y\r\n            return getAt(elFieldX, gx, gy, gz, x, y, z) + (dt / (getAt(permittivity, gx, gy, gz, x, y, z) * cs)) * (\r\n                (getAt(fieldZ, gx, gy, gz, x, y, z) - getAt(fieldZ, gx, gy, gz, x, y - 1, z)))\r\n        }, {\r\n            output: [cellCount],\r\n            constants: { cellSize: cellSize, gridSizeX: gridSize[0], gridSizeY: gridSize[1], gridSizeZ: gridSize[2] }\r\n        }).setFunctions([getX, getY, getZ, getAt]).setWarnVarUsage(false)\r\n\r\n        this.updateElectricY = this.gpu.createKernel(function (fieldX: number[], fieldZ: number[], permittivity: number[], elFieldY: number[], dt: number) {\r\n            const index = Math.floor(this.thread.x)\r\n\r\n            const gx = this.constants.gridSizeX as number\r\n            const gy = this.constants.gridSizeY as number\r\n            const gz = this.constants.gridSizeZ as number\r\n            const cs = this.constants.cellSize as number\r\n\r\n            const x = getX(index, gx)\r\n            const y = getY(index, gx, gy)\r\n            const z = getZ(index, gx, gy, gz)\r\n\r\n            // d_Z X - d_X Z\r\n            return getAt(elFieldY, gx, gy, gz, x, y, z) + (dt / (getAt(permittivity, gx, gy, gz, x, y, z) * cs)) * (\r\n                -(getAt(fieldZ, gx, gy, gz, x, y, z) - getAt(fieldZ, gx, gy, gz, x - 1, y, z)))\r\n        }, {\r\n            output: [cellCount],\r\n            constants: { cellSize: cellSize, gridSizeX: gridSize[0], gridSizeY: gridSize[1], gridSizeZ: gridSize[2] }\r\n        }).setFunctions([getX, getY, getZ, getAt]).setWarnVarUsage(false)\r\n\r\n        this.updateElectricZ = this.gpu.createKernel(function (fieldX: number[], fieldY: number[], permittivity: number[], elFieldZ: number[], dt: number) {\r\n            const index = Math.floor(this.thread.x)\r\n\r\n            const gx = this.constants.gridSizeX as number\r\n            const gy = this.constants.gridSizeY as number\r\n            const gz = this.constants.gridSizeZ as number\r\n            const cs = this.constants.cellSize as number\r\n\r\n            const x = getX(index, gx)\r\n            const y = getY(index, gx, gy)\r\n            const z = getZ(index, gx, gy, gz)\r\n\r\n            // d_X Y - d_Y X\r\n            return getAt(elFieldZ, gx, gy, gz, x, y, z) + (dt / (getAt(permittivity, gx, gy, gz, x, y, z) * cs)) * (\r\n                (getAt(fieldY, gx, gy, gz, x, y, z) - getAt(fieldY, gx, gy, gz, x - 1, y, z)) -\r\n                (getAt(fieldX, gx, gy, gz, x, y, z) - getAt(fieldX, gx, gy, gz, x, y - 1, z)))\r\n        }, {\r\n            output: [cellCount],\r\n            constants: { cellSize: cellSize, gridSizeX: gridSize[0], gridSizeY: gridSize[1], gridSizeZ: gridSize[2] }\r\n        }).setFunctions([getX, getY, getZ, getAt]).setWarnVarUsage(false)\r\n    }\r\n\r\n    stepElectric = (dt: number) => {\r\n        const elX = this.data.electricFieldX.values\r\n        const elY = this.data.electricFieldY.values\r\n        let elZ = this.data.electricFieldZ.values\r\n        const magX = this.data.magneticFieldX.values\r\n        const magY = this.data.magneticFieldY.values\r\n        const magZ = this.data.magneticFieldZ.values\r\n        const perm = this.data.permittivity.values\r\n\r\n        elZ = this.injectSource(this.data.electricSourceFieldZ.values, elZ, dt) as number[]\r\n        this.data.electricSourceFieldZ.values = this.decaySource(this.data.electricSourceFieldZ.values, dt) as number[]\r\n        \r\n        // d/dt E(x, t) = (curl B(x, t))/(µε)\r\n        this.data.electricFieldX.values = this.updateElectricX(magY, magZ, perm, elX, dt) as number[]\r\n        this.data.electricFieldY.values = this.updateElectricY(magX, magZ, perm, elY, dt) as number[]\r\n        this.data.electricFieldZ.values = this.updateElectricZ(magX, magY, perm, elZ, dt) as number[]\r\n\r\n        this.data.time += dt / 2\r\n    }\r\n\r\n    stepMagnetic = (dt: number) => {\r\n        const elX = this.data.electricFieldX.values\r\n        const elY = this.data.electricFieldY.values\r\n        const elZ = this.data.electricFieldZ.values\r\n        const magX = this.data.magneticFieldX.values\r\n        const magY = this.data.magneticFieldY.values\r\n        const magZ = this.data.magneticFieldZ.values\r\n        const perm = this.data.permeability.values\r\n\r\n        // d/dt B(x, t) = -curl E(x, t)\r\n        this.data.magneticFieldX.values = this.updateMagneticX(elY, elZ, perm, magX, dt) as number[]\r\n        this.data.magneticFieldY.values = this.updateMagneticY(elX, elZ, perm, magY, dt) as number[]\r\n        this.data.magneticFieldZ.values = this.updateMagneticZ(elX, elY, perm, magZ, dt) as number[]\r\n\r\n        this.data.time += dt / 2\r\n    }\r\n\r\n    resetFields = () => {\r\n        this.data.time = 0\r\n        this.data.electricFieldX.values.fill(0)\r\n        this.data.electricFieldY.values.fill(0)\r\n        this.data.electricFieldZ.values.fill(0)\r\n        this.data.magneticFieldX.values.fill(0)\r\n        this.data.magneticFieldY.values.fill(0)\r\n        this.data.magneticFieldZ.values.fill(0)\r\n        this.data.electricSourceFieldZ.values.fill(0)\r\n    }\r\n\r\n    resetMaterials = () => {\r\n        this.data.permeability.values.fill(1)\r\n        this.data.permittivity.values.fill(1)\r\n    }\r\n\r\n    getData = () => this.data\r\n}","import React, { useRef, useCallback, useEffect, useState } from 'react'\nimport { GPU, IKernelRunShortcut } from \"gpu.js\"\nimport { FDTDSimulator, addScalarField3DValue, FlatScalarField3D, setScalarField3DValue } from \"./simulator\"\n\nconst canvasSize = [window.innerWidth, window.innerHeight]\nconst canvasAspect = canvasSize[0] / canvasSize[1]\n\nconst dt = 0.02\nconst gridSizeLongest = 600\nconst gridSize: [number, number, number] = canvasSize[0] >= canvasSize[1] ?\n    [gridSizeLongest, Math.ceil(gridSizeLongest / canvasAspect), 1] :\n    [Math.ceil(gridSizeLongest * canvasAspect), gridSizeLongest, 1]\nconst cellSize = 0.04\n\nconst simulator = new FDTDSimulator(gridSize, cellSize)\n\nconst makeRenderSimulatorCanvas = (g: GPU) => {\n    function getAt(field: number[], shapeX: number, shapeY: number, shapeZ: number, x: number, y: number, z: number) {\n        if (x < 0 || x >= shapeX || y < 0 || y >= shapeY || z < 0 || z >= shapeZ) {\n            return 0\n        }\n\n        return field[x + y * shapeX + z * shapeX * shapeY]\n    }\n\n    return g.createKernel(function (electricFieldX: number[], electricFieldY: number[], electricFieldZ: number[],\n        magneticFieldX: number[], magneticFieldY: number[], magneticFieldZ: number[],\n        permittivity: number[], permeability: number[]) {\n        const gx = this.constants.gridSizeX as number\n        const gy = this.constants.gridSizeY as number\n        const gz = this.constants.gridSizeZ as number\n\n        const x = gx * this.thread.x! / (this.output.x as number)\n        const y = gy * (1 - this.thread.y! / (this.output.y as number))\n        const xa = Math.floor(x)\n        const ya = Math.floor(y)\n\n        const z = Math.floor(gz / 2)\n\n        const eAA =\n            getAt(electricFieldX, gx, gy, gz, xa, ya, z) * getAt(electricFieldX, gx, gy, gz, xa, ya, z) +\n            getAt(electricFieldY, gx, gy, gz, xa, ya, z) * getAt(electricFieldY, gx, gy, gz, xa, ya, z) +\n            getAt(electricFieldZ, gx, gy, gz, xa, ya, z) * getAt(electricFieldZ, gx, gy, gz, xa, ya, z)\n\n        // Magnetic field is offset from electric field, so get value at +0.5 by interpolating 0 and 1\n        const magXAA = (getAt(magneticFieldX, gx, gy, gz, xa, ya, z) + getAt(magneticFieldX, gx, gy, gz, xa - 1, ya - 1, z)) / 2\n        const magYAA = (getAt(magneticFieldY, gx, gy, gz, xa, ya, z) + getAt(magneticFieldY, gx, gy, gz, xa - 1, ya - 1, z)) / 2\n        const magZAA = (getAt(magneticFieldZ, gx, gy, gz, xa, ya, z) + getAt(magneticFieldZ, gx, gy, gz, xa - 1, ya - 1, z)) / 2\n\n        const mAA = magXAA * magXAA + magYAA * magYAA + magZAA * magZAA\n\n        const scale = 15\n\n        const permittivityValue = Math.max(0, Math.min(1, (1 + 0.4342944819 * Math.log(getAt(permittivity, gx, gy, gz, xa, ya, z))) / 4))\n        const permeabilityValue = Math.max(0, Math.min(1, (1 + 0.4342944819 * Math.log(getAt(permeability, gx, gy, gz, xa, ya, z))) / 4))\n\n        const backgroundX = (Math.abs(x % 1 - 0.5) < 0.25 ? 1 : 0) * (Math.abs(y % 1 - 0.5) < 0.25 ? 1 : 0)\n        const backgroundY = 1 - backgroundX\n\n        this.color(eAA / scale + 0.5 * backgroundX * permittivityValue, eAA / scale + mAA / scale, mAA / scale + 0.5 * backgroundY * permeabilityValue)\n    }, {\n        output: [canvasSize[0], canvasSize[1]],\n        constants: { gridSizeX: gridSize[0], gridSizeY: gridSize[1], gridSizeZ: gridSize[2] },\n        graphical: true\n    }).setFunctions([getAt]).setWarnVarUsage(false)\n}\n\nfunction clamp(min: number, max: number, value: number) {\n    return Math.max(min, Math.min(max, value))\n}\n\ntype LabeledSliderProps = {\n    label: string\n    value: number,\n    setValue: (value: number) => void\n    min: number\n    max: number\n    step: number\n}\n\nfunction LabeledSlider(props: LabeledSliderProps) {\n    return (\n        <div>\n            <label>{props.label}</label>\n            <div>\n                <input type=\"range\" min={props.min} max={props.max} value={props.value} step={props.step}\n                    onChange={e => props.setValue(parseFloat(e.target.value))} style={{ height: 10, width: \"100%\" }} />\n                <div style={{ textAlign: \"center\", lineHeight: 0.1, marginBottom: \"7px\" }}>\n                    {props.value}\n                </div>\n            </div>\n        </div>\n    )\n}\n\ntype OptionSelectorProps = {\n    options: string[]\n    selectedOption: number\n    setSelectedOption: (selectedOption: number) => void\n}\n\nfunction OptionSelector(props: OptionSelectorProps) {\n    return (\n        <div>\n            {props.options.map((option, optionIndex) =>\n                <button key={option} style={{\n                    boxSizing: \"border-box\",\n                    border: optionIndex === props.selectedOption ? \"4px solid rgb(0, 150, 255)\" : \"0\",\n                    height: \"30px\",\n                    margin: \"5px\",\n                    width: `${100 / props.options.length}%`, background: \"rgb(100, 100, 100)\", color: \"white\"\n                }}\n                    onClick={e => props.setSelectedOption(optionIndex)}>\n                    {option}\n                </button>\n            )}\n        </div>\n    )\n}\n\ntype ControlWidgerProps = {\n    brushSize: number,\n    setBrushSize: (brushSize: number) => void\n\n    brushValue: number,\n    setBrushValue: (brushValue: number) => void\n\n    signalFrequency: number,\n    setSignalFrequency: (signalFrequency: number) => void\n\n    clickOption: number\n    setClickOption: (clickOption: number) => void\n\n    resetFields: () => void\n    resetMaterials: () => void\n}\n\nfunction ControlWidget(props: ControlWidgerProps) {\n    const [collapsed, setCollapsed] = useState(false)\n\n    return (\n        <div style={{ userSelect: \"none\" }}>\n            <div style={{ textAlign: \"center\", position: \"absolute\", opacity: 0.8, background: \"rgba(33, 33, 33, 100)\", fontWeight: \"lighter\", color: \"white\" }}>\n                <button onClick={e => setCollapsed(!collapsed)} style={{ width: \"100%\", height: \"30px\", background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", fontWeight: \"bold\", cursor: \"pointer\" }}>\n                    Controls [{collapsed ? \"+\" : \"-\"}]\n                </button>\n                {!collapsed && (\n                    <div style={{ padding: \"10px\" }}>\n                        <LabeledSlider label=\"Brush size\" value={props.brushSize} setValue={props.setBrushSize} min={0} max={100} step={1} />\n                        <LabeledSlider label=\"Brush value\" value={props.brushValue} setValue={props.setBrushValue} min={1} max={100} step={1} />\n                        <LabeledSlider label=\"Signal frequency\" value={props.signalFrequency} setValue={props.setSignalFrequency} min={0} max={5} step={0.5} />\n                        <OptionSelector options={[\"ε brush\", \"µ brush\", \"Signal\"]} selectedOption={props.clickOption} setSelectedOption={props.setClickOption} />\n                        <button onClick={props.resetFields} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Reset fields</button>\n                        <button onClick={props.resetMaterials} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Reset materials</button>\n                    </div>\n                )}\n            </div>\n        </div>\n    )\n}\n\nconst defaultSignalBrushValue = 10\nconst defaultSignalBrushSize = 0\nconst defaultMaterialBrushValue = 5\nconst defaultMaterialBrushSize = 5\n\nexport default function () {\n    const [brushSize, setBrushSize] = useState(defaultSignalBrushSize)\n    const [brushValue, setBrushValue] = useState(defaultSignalBrushValue)\n    const [signalFrequency, setSignalFrequency] = useState(1)\n    const [drawingPermeability, setDrawingPermeability] = useState(false)\n    const [drawingPermittivity, setDrawingPermittivity] = useState(false)\n    const [clickOption, setClickOption] = useState(2) // eps, mu, signal\n    const optionPermittivityBrush = 0\n    const optionPermeabilityBrush = 1\n    const optionSignal = 2\n\n    const [mousePosition, setMousePosition] = useState<[number, number] | null>(null)\n\n    const signalStrength = useRef(0)\n    const mouseDownPos = useRef<[number, number] | null>(null)\n    const renderSim = useRef<IKernelRunShortcut | null>(null)\n    const drawCanvasRef = useRef<HTMLCanvasElement>(null)\n\n    const simStep = useCallback(() => {\n        const simData = simulator.getData()\n\n        if (mouseDownPos.current !== null && drawCanvasRef.current) {\n            const centerX = clamp(0, simData.electricSourceFieldZ.shape[0] - 1, Math.floor(simData.electricSourceFieldZ.shape[0] * mouseDownPos.current[0] / drawCanvasRef.current.width))\n            const centerY = clamp(0, simData.electricSourceFieldZ.shape[1] - 1, Math.floor(simData.electricSourceFieldZ.shape[1] * mouseDownPos.current[1] / drawCanvasRef.current.height))\n            const brushHalfSize = Math.round(brushSize / 2)\n\n            for (let x = Math.max(0, centerX - brushHalfSize); x <= Math.min(gridSize[0] - 1, centerX + brushHalfSize); x++) {\n                for (let y = Math.max(0, centerY - brushHalfSize); y <= Math.min(gridSize[1] - 1, centerY + brushHalfSize); y++) {\n                    for (let z = 0; z < simData.electricSourceFieldZ.shape[2]; z++) {\n                        addScalarField3DValue(simData.electricSourceFieldZ, x, y, z, -brushValue * 1000 * Math.cos(2 * Math.PI * signalFrequency * simData.time) * dt)\n                    }\n                }\n            }\n        }\n\n        simulator.stepMagnetic(dt)\n        simulator.stepElectric(dt)\n    }, [signalFrequency, brushValue, brushSize])\n\n    useEffect(() => {\n        const timer = setInterval(simStep, 1000 * dt)\n        return () => clearInterval(timer)\n    }, [simStep])\n\n    const startLoop = useCallback(() => {\n        let stop = false\n\n        const loop = (async () => {\n            const resolveDrawPromise = (resolve: (value?: unknown) => void) => requestAnimationFrame(resolve)\n\n            while (!stop) {\n                const simData = simulator.getData()\n\n                if (simData.time > 0 && renderSim.current !== null) {\n                    renderSim.current(simData.electricFieldX.values, simData.electricFieldY.values, simData.electricFieldZ.values,\n                        simData.magneticFieldX.values, simData.magneticFieldY.values, simData.magneticFieldZ.values,\n                        simData.permittivity.values, simData.permeability.values)\n                }\n\n                await new Promise(resolveDrawPromise)\n            }\n        })\n\n        loop()\n\n        return () => { stop = true }\n    }, [])\n\n    useEffect(() => {\n        if (drawCanvasRef.current) {\n            renderSim.current = makeRenderSimulatorCanvas(new GPU({ mode: \"webgl\", canvas: drawCanvasRef.current }))\n        } else {\n            throw new Error(\"Canvas ref was null\")\n        }\n\n        startLoop()\n    }, [startLoop])\n\n    const changeMaterial = useCallback((field: FlatScalarField3D, canvasPos: [number, number]) => {\n        const centerX = Math.round(gridSize[0] * (canvasPos[0] / canvasSize[0]))\n        const centerY = Math.round(gridSize[1] * (canvasPos[1] / canvasSize[1]))\n        const brushHalfSize = Math.round(brushSize / 2)\n\n        for (let x = Math.max(0, centerX - brushHalfSize); x <= Math.min(gridSize[0] - 1, centerX + brushHalfSize); x++) {\n            for (let y = Math.max(0, centerY - brushHalfSize); y <= Math.min(gridSize[1] - 1, centerY + brushHalfSize); y++) {\n                setScalarField3DValue(field, x, y, 0, brushValue)\n            }\n        }\n    }, [brushSize, brushValue])\n\n    const resetMaterials = useCallback(() => {\n        simulator.resetMaterials()\n    }, [])\n\n    const resetFields = useCallback(() => {\n        simulator.resetFields()\n        signalStrength.current = 0\n    }, [])\n\n    const onInputDown = useCallback(([clientX, clientY]: [number, number]) => {\n        if (clickOption === optionSignal) {\n            mouseDownPos.current = [clientX, clientY]\n        } else if (clickOption === optionPermittivityBrush) {\n            changeMaterial(simulator.getData().permittivity, [clientX, clientY])\n            setDrawingPermittivity(true)\n        } else if (clickOption === optionPermeabilityBrush) {\n            changeMaterial(simulator.getData().permeability, [clientX, clientY])\n            setDrawingPermeability(true)\n        }\n    }, [changeMaterial, clickOption])\n\n    const onInputMove = useCallback(([clientX, clientY]: [number, number]) => {\n        if (clickOption === optionSignal && mouseDownPos.current !== null) {\n            mouseDownPos.current = [clientX, clientY]\n        }\n\n        if (drawingPermittivity) {\n            changeMaterial(simulator.getData().permittivity, [clientX, clientY])\n        }\n\n        if (drawingPermeability) {\n            changeMaterial(simulator.getData().permeability, [clientX, clientY])\n        }\n    }, [changeMaterial, clickOption, drawingPermeability, drawingPermittivity])\n\n    const onInputUp = useCallback(() => {\n        if (clickOption === optionSignal) {\n            mouseDownPos.current = null\n        } else if (clickOption === optionPermeabilityBrush) {\n            setDrawingPermeability(false)\n        } else if (clickOption === optionPermittivityBrush) {\n            setDrawingPermittivity(false)\n        }\n    }, [clickOption])\n\n    // Remember old brush values for signal and material\n    const [previousClickOption, setPreviousClickOption] = useState(optionSignal)\n    const [signalBrushSize, setSignalBrushSize] = useState(defaultSignalBrushSize)\n    const [signalBrushValue, setSignalBrushValue] = useState(defaultSignalBrushValue)\n    const [materialBrushSize, setMaterialBrushSize] = useState(defaultMaterialBrushSize)\n    const [materialBrushValue, setMaterialBrushValue] = useState(defaultMaterialBrushValue)\n    useEffect(() => {\n        if (clickOption === optionSignal && previousClickOption !== optionSignal) {\n            setMaterialBrushSize(brushSize)\n            setMaterialBrushValue(brushValue)\n            setBrushSize(signalBrushSize)\n            setBrushValue(signalBrushValue)\n        } else if (clickOption !== optionSignal && previousClickOption === optionSignal) {\n            setSignalBrushSize(brushSize)\n            setSignalBrushValue(brushValue)\n            setBrushSize(materialBrushSize)\n            setBrushValue(materialBrushValue)\n        }\n\n        setPreviousClickOption(clickOption)\n    }, [clickOption, previousClickOption, signalBrushSize, signalBrushValue, materialBrushSize, materialBrushValue, brushSize, brushValue])\n\n    return (\n        <div>\n            <canvas width={canvasSize[0]} height={canvasSize[1]} ref={drawCanvasRef} style={{ position: \"absolute\", userSelect: \"none\" }}\n                onMouseDown={e => onInputDown([e.clientX, e.clientY])}\n                onMouseMove={e => { setMousePosition([e.clientX, e.clientY]); onInputMove([e.clientX, e.clientY]) }}\n                onMouseUp={e => onInputUp()}\n                onTouchStart={e => onInputDown([e.touches[0].clientX, e.touches[0].clientY])}\n                onTouchMove={e => onInputMove([e.touches[0].clientX, e.touches[0].clientY])}\n                onTouchEnd={e => onInputUp()}\n                onContextMenu={e => e.preventDefault()}\n            />\n\n            <div style={{ position: \"absolute\", bottom: 10, right: 10, userSelect: \"none\" }}>\n                <a href=\"https://github.com/RobinKa/maxwell-simulation\" rel=\"noopener noreferrer\" target=\"_blank\" style={{ fontWeight: \"lighter\", color: \"rgba(255, 255, 255, 100)\", textDecoration: \"none\" }}>Source code</a>\n            </div>\n\n            {mousePosition &&\n                <div style={{ position: \"absolute\", pointerEvents: \"none\", left: mousePosition[0] - (2 * (brushSize + 1)), top: mousePosition[1] - (2 * (brushSize + 1)), width: 4 * (brushSize + 1), height: 4 * (brushSize + 1), border: \"2px solid yellow\" }} />\n            }\n\n            <ControlWidget brushSize={brushSize} setBrushSize={setBrushSize}\n                brushValue={brushValue} setBrushValue={setBrushValue}\n                signalFrequency={signalFrequency} setSignalFrequency={setSignalFrequency}\n                clickOption={clickOption} setClickOption={setClickOption}\n                resetFields={resetFields} resetMaterials={resetMaterials}\n            />\n        </div>\n    )\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}