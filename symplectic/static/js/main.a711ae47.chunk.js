(window.webpackJsonpsymplectic=window.webpackJsonpsymplectic||[]).push([[0],{24:function(e,t,n){e.exports=n(47)},47:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(18),i=n.n(o),c=n(4),s=n(19),l=n(20),u=n.n(l);function m(e,t,n){for(var r=0;r<e.length;r++)e[r]+=n*t[r]}function f(e,t,n,r){for(var a=0;a<t.length;a++)e[a]=t[a]+r*n[a]}var d=function e(t,n){var r=this;Object(s.a)(this,e),this.constants=t,this.getEnergyGradients=n,this.iterate=function(e,t){var n=u()(e);n.time+=2*t;for(var a=[],o=[],i=0;i<n.objects.length;i++){var c=n.objects[i],s=r.constants[0],l=s.c,d=s.d,b=[],p=[];b.length=c.position.length,p.length=c.momentum.length;var g=r.getEnergyGradients(i,c.position,c.momentum,e);f(b,c.position,g.gradMomentum,t*d),f(p,c.momentum,g.gradPosition,t*-d),g=r.getEnergyGradients(i,b,p,e),m(c.position,g.gradMomentum,t*l),m(c.momentum,g.gradPosition,t*-l),a.push(b),o.push(p)}var v=!0,j=!1,h=void 0;try{for(var y,O=r.constants.slice(1,r.constants.length-1)[Symbol.iterator]();!(v=(y=O.next()).done);v=!0)for(var E=y.value,w=(l=E.c,E.d),x=0;x<n.objects.length;x++){var S=n.objects[x],P=a[x],k=o[x],C=r.getEnergyGradients(x,S.position,S.momentum,e);m(P,C.gradMomentum,t*w),m(k,C.gradPosition,t*-w),C=r.getEnergyGradients(x,P,k,e),m(S.position,C.gradMomentum,t*l),m(S.momentum,C.gradPosition,t*-l)}}catch(ae){j=!0,h=ae}finally{try{v||null==O.return||O.return()}finally{if(j)throw h}}for(var T=0;T<n.objects.length;T++){d=r.constants[r.constants.length-1].d;var M=n.objects[T],q=a[T],D=r.getEnergyGradients(T,M.position,M.momentum,e);f(M.position,q,D.gradMomentum,t*d)}for(var F=0;F<n.objects.length;F++){var A=n.objects[F],G=r.constants[0],R=(l=G.c,G.d),I=a[F],V=o[F],W=r.getEnergyGradients(F,A.position,A.momentum,e);f(I,A.position,W.gradMomentum,t*R),f(V,A.momentum,W.gradPosition,t*-R),W=r.getEnergyGradients(F,I,V,e),m(A.position,W.gradMomentum,t*l),m(A.momentum,W.gradPosition,t*-l)}var N=!0,_=!1,U=void 0;try{for(var Y,X=r.constants.slice(1,r.constants.length-1)[Symbol.iterator]();!(N=(Y=X.next()).done);N=!0)for(var B=Y.value,J=B.c,L=B.d,$=0;$<n.objects.length;$++){var z=n.objects[$],H=a[$],K=o[$],Q=r.getEnergyGradients($,z.position,z.momentum,e);m(H,Q.gradMomentum,t*L),m(K,Q.gradPosition,t*-L),Q=r.getEnergyGradients($,H,K,e),m(z.position,Q.gradMomentum,t*J),m(z.momentum,Q.gradPosition,t*-J)}}catch(ae){_=!0,U=ae}finally{try{N||null==X.return||X.return()}finally{if(_)throw U}}for(var Z=0;Z<n.objects.length;Z++){var ee=r.constants[r.constants.length-1].d,te=n.objects[Z],ne=o[Z],re=r.getEnergyGradients(Z,te.position,te.momentum,e);f(te.momentum,ne,re.gradPosition,t*-ee)}return n}},b=n(3),p=n(9),g=n(11),v=n(10);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(n,!0).forEach((function(t){Object(v.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t){switch(t.type){case"addEnergyTerm":return h({},e,{energyTerms:[].concat(Object(g.a)(e.energyTerms),[t.term])});case"updateEnergyTerm":var n=Object(g.a)(e.energyTerms);return n[t.index]=t.term,h({},e,{energyTerms:n});case"removeEnergyTerm":var r=Object(g.a)(e.energyTerms);return r.pop(),h({},e,{energyTerms:r});case"addObject":return h({},e,{objects:[].concat(Object(g.a)(e.objects),[{}])});case"removeObject":var a=Object(g.a)(e.objects);return a.pop(),h({},e,{objects:a});case"setInitialScales":return h({},e,{initialPositionScale:t.positionScale,initialMomentumScale:t.momentumScale})}throw new Error("Unhandled action in reducer")}var O=Object(r.createContext)(void 0);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(n,!0).forEach((function(t){Object(v.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function x(e){var t=Object(r.useContext)(O),n=t.state,o=t.dispatch,i=e.index,c=n.energyTerms[i];return a.a.createElement("div",null,n.objects.map((function(e,t){var n=!!c.affectedObjects[t];return a.a.createElement("input",{type:"checkbox",key:t,checked:n,onChange:function(){return o({type:"updateEnergyTerm",index:i,term:w({},c,{affectedObjects:w({},c.affectedObjects,Object(v.a)({},t,!n))})})}})})))}function S(e){var t=Object(r.useContext)(O),n=t.state,o=t.dispatch,i=e.index,c=n.energyTerms[i];return a.a.createElement("div",null,n.objects.map((function(e,t){return a.a.createElement("div",null,n.objects.map((function(e,n){var r=[t,n].toString(),s=!!c.affectedObjectPairs[r];return a.a.createElement("input",{type:"checkbox",key:t,checked:s,onChange:function(){return o({type:"updateEnergyTerm",index:i,term:w({},c,{affectedObjectPairs:w({},c.affectedObjectPairs,Object(v.a)({},r,!s))})})}})})))})))}function P(e){var t=Object(r.useContext)(O),n=t.state,o=t.dispatch,i=Object(r.useState)(""),s=Object(c.a)(i,2),l=s[0],u=s[1],m=Object(r.useState)(!0),f=Object(c.a)(m,2),d=f[0],p=f[1],g=e.index,v=n.energyTerms[g];Object(r.useEffect)((function(){""===l&&u(v.expressionFormula)}),[v,l]);var j=Object(r.useCallback)((function(){var e=Object(b.parseExpression)(l);p(!0),o({type:"updateEnergyTerm",index:g,term:w({},v,{expression:e,expressionFormula:l})})}),[l,g,o,v]),h=Object(r.useCallback)((function(e){u(e.target.value),p(!1)}),[]);return a.a.createElement("div",{style:{border:"2px solid black",padding:"4px",margin:"4px"}},a.a.createElement("h2",null,"Energy ",g),a.a.createElement("input",{type:"text",style:{width:800,color:d?"black":"red"},onChange:h,value:l}),a.a.createElement("input",{type:"button",value:"Parse",onClick:j}),a.a.createElement("h3",null,"Affected objects"),a.a.createElement(x,{index:g}),a.a.createElement("h3",null,"Affected object pairs"),a.a.createElement(S,{index:g}))}function k(){var e=Object(r.useContext)(O),t=e.state,n=e.dispatch,o=t.energyTerms;return a.a.createElement("div",{style:{}},a.a.createElement("h1",null,"Energy terms"),a.a.createElement("div",null,o.map((function(e,t){return a.a.createElement(P,{key:t,index:t})}))),a.a.createElement("input",{type:"button",value:"Add",onClick:function(){return n({type:"addEnergyTerm",term:(e=new b.Constant(0),t="0",{expression:e,expressionFormula:t,affectedObjects:{},affectedObjectPairs:{}})});var e,t}}),a.a.createElement("input",{type:"button",value:"Remove",onClick:function(){return n({type:"removeEnergyTerm"})}}))}function C(){var e=Object(r.useContext)(O),t=e.state,n=e.dispatch;return a.a.createElement("div",null,a.a.createElement("h1",null,"Objects"),a.a.createElement("div",null,t.objects.map((function(e,t){return a.a.createElement("div",{style:{border:"2px solid black",padding:"4px",margin:"4px"}},a.a.createElement("h2",null,"Object ",t))}))),a.a.createElement("input",{type:"button",value:"Add",onClick:function(){return n({type:"addObject"})}}),a.a.createElement("input",{type:"button",value:"Remove",onClick:function(){return n({type:"removeObject"})}}))}var T=n(5),M=(n(45),function(e){var t=Object(r.useContext)(O).state,n=Object(r.useRef)(null),o=Object(r.useState)(200/t.initialPositionScale),i=Object(c.a)(o,2),s=i[0],l=i[1],u=Object(r.useState)([0,0]),m=Object(c.a)(u,2),f=m[0],d=m[1];Object(r.useEffect)((function(){if(n.current){var t=n.current,r=t.getContext("2d");if(r){r.fillStyle="rgb(20, 20, 20)",r.fillRect(0,0,t.width,t.height),r.fillStyle="red";var a=!0,o=!1,i=void 0;try{for(var c,l=e.integratorState.objects[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var u=c.value,m=[u.position[0],u.position[1]],d=m[0],b=m[1],p=u.position[0]+u.momentum[0],g=u.position[1]+u.momentum[1];r.strokeStyle="blue",r.beginPath(),r.moveTo(s*d+t.width/2+f[0],s*b+t.height/2+f[1]),r.lineTo(s*p+t.width/2+f[0],s*g+t.height/2+f[1]),r.stroke(),r.fillRect(s*d-2+t.width/2+f[0],s*b-2+t.height/2+f[1],4,4)}}catch(v){o=!0,i=v}finally{try{a||null==l.return||l.return()}finally{if(o)throw i}}r.strokeStyle="lime",r.beginPath(),r.moveTo(10,10),r.lineTo(110,10),r.stroke(),r.fillStyle="lime",r.fillText((100/s).toFixed(2),50,20),r.fillText("t: ".concat(e.integratorState.time.toFixed(2)),t.width-50,20)}}}),[e.integratorState,n,s,f]);var b=Object(r.useCallback)((function(e){console.log(s),l(s*(1-.1*Math.sign(e.deltaY)))}),[s,l]),p=Object(r.useState)(!1),g=Object(c.a)(p,2),v=g[0],j=g[1],h=Object(r.useState)([0,0]),y=Object(c.a)(h,2),E=y[0],w=y[1],x=Object(r.useCallback)((function(e){0===e.button&&(j(!0),w([e.clientX,e.clientY]))}),[j,w]),S=Object(r.useCallback)((function(e){0===e.button&&j(!1)}),[j]),P=Object(r.useCallback)((function(e){if(v){var t=[e.clientX-E[0],e.clientY-E[1]];d([f[0]+t[0],f[1]+t[1]]),w([e.clientX,e.clientY])}}),[v,E,w,f]);return a.a.createElement("canvas",{width:"1000",height:"1000",ref:n,onWheel:b,onMouseDown:x,onMouseMove:P,onMouseUp:S})}),q=[{c:.24658818727861384,d:.08333333333333333},{c:.6047073875057809,d:.397767585954844},{c:-.40098690397880077,d:-.03933369314462574},{c:.09938265838881204,d:.05823277385644839},{c:-.40098690397880077,d:.05823277385644839},{c:.6047073875057809,d:-.03933369314462574},{c:.24658818727861384,d:.397767585954844},{c:0,d:.08333333333333333}];function D(e,t,n){for(var r={variableValues:{}},a=0;a<n;a++)r.variableValues["p"+a.toString()]=t[a],r.variableValues["q"+a.toString()]=e[a];return r}var F=function(){var e=Object(r.useContext)(O),t=e.state,n=e.dispatch,o=t.initialPositionScale,i=t.initialMomentumScale,s=Object(r.useState)(null),l=Object(c.a)(s,2),u=l[0],m=l[1],f=Object(r.useState)(null),g=Object(c.a)(f,2),v=g[0],j=g[1],h=Object(r.useCallback)((function(){if(v&&u){var e=v.iterate(u,.02);m(e)}}),[u,m,v]);Object(r.useEffect)((function(){var e=setInterval(h,20);return function(){return clearInterval(e)}}),[h]);var y=Object(r.useCallback)((function(){var e=t.energyTerms,n=[],r=[],a=!0,c=!1,s=void 0;try{for(var l,u=e[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){for(var f=l.value,g=Object(b.getAllVariables)(f.expression),v=[],h=[],y=0;y<t.dimensions;y++){var O=Object(b.getDerivativeForExpression)(g["q"+y.toString()],Object(b.getAllDerivatives)(f.expression,new p.Constant(1))),E=Object(b.getDerivativeForExpression)(g["p"+y.toString()],Object(b.getAllDerivatives)(f.expression,new p.Constant(1)));v.push(O),h.push(E)}n.push(v),r.push(h)}}catch(x){c=!0,s=x}finally{try{a||null==u.return||u.return()}finally{if(c)throw s}}var w={time:0,objects:[]};t.objects.forEach((function(e,t){w.objects.push({position:[Math.random()*o-o/2,Math.random()*o-o/2],momentum:[Math.random()*i-i/2,Math.random()*i-i/2]})})),m(w),j(new d(q,(function(e,a,o,i){for(var c=D(a,o,t.dimensions),s=[],l=[],u=0;u<t.dimensions;u++)s.push(0),l.push(0);return t.energyTerms.forEach((function(u,m){if(u.affectedObjects[e])for(var f=0;f<t.dimensions;f++)s[f]+=n[m][f].evaluate(c),l[f]+=r[m][f].evaluate(c);i.objects.forEach((function(c,f){if(u.affectedObjectPairs[[e,f].toString()])for(var d=i.objects[f],b=function(e,t,n,r,a){for(var o=D(e,t,a),i=0;i<a;i++)o.variableValues["p"+i.toString()+"_b"]=r[i],o.variableValues["q"+i.toString()+"_b"]=n[i];return o}(a,o,d.position,d.momentum,t.dimensions),p=0;p<t.dimensions;p++)s[p]+=n[m][p].evaluate(b),l[p]+=r[m][p].evaluate(b)}))})),{gradPosition:s,gradMomentum:l}})))}),[t.energyTerms,t.objects,t.dimensions,o,i]);return a.a.createElement(a.a.Fragment,null,a.a.createElement("input",{type:"button",value:"Simulate",onClick:y}),a.a.createElement("div",null,a.a.createElement("label",null,"Initial position scale: "),a.a.createElement("input",{type:"text",onChange:function(e){var t=parseFloat(e.target.value);console.log(t),isNaN(t)||n({type:"setInitialScales",positionScale:t,momentumScale:i})},defaultValue:o.toString()})),a.a.createElement("div",null,a.a.createElement("label",null,"Initial momentum scale: "),a.a.createElement("input",{type:"text",onChange:function(e){var t=parseFloat(e.target.value);isNaN(t)||n({type:"setInitialScales",positionScale:o,momentumScale:t})},defaultValue:i.toString()})),u&&a.a.createElement(a.a.Fragment,null,a.a.createElement(M,{integratorState:u})))},A=function(){var e=function(){for(var e={energyTerms:[{expression:Object(b.parseExpression)("0.5 * (p0 * p0 + p1 * p1)"),expressionFormula:"0.5 * (p0 * p0 + p1 * p1)",affectedObjects:{},affectedObjectPairs:{}},{expression:Object(b.parseExpression)("-0.01 / sqrt((q0 - q0_b)^2 + (q1 - q1_b)^2)"),expressionFormula:"-0.01 / sqrt((q0 - q0_b)^2 + (q1 - q1_b)^2)",affectedObjects:{},affectedObjectPairs:{}}],objects:[],dimensions:2,initialPositionScale:5,initialMomentumScale:.5},t=0;t<10;t++)e.objects.push({});return e.objects.forEach((function(t,n){e.energyTerms[0].affectedObjects[n]=!0})),e.objects.forEach((function(t,n){e.objects.forEach((function(t,r){n!==r&&(e.energyTerms[1].affectedObjectPairs[[n,r].toString()]=!0)}))})),Object(r.useReducer)(y,e)}(),t=Object(c.a)(e,2),n=t[0],o=t[1];return a.a.createElement(O.Provider,{value:{state:n,dispatch:o}},a.a.createElement(T.d,null,a.a.createElement(T.b,null,a.a.createElement(T.a,null,"Simulation"),a.a.createElement(T.a,null,"Objects"),a.a.createElement(T.a,null,"Energy Terms")),a.a.createElement(T.c,null,a.a.createElement(F,null)),a.a.createElement(T.c,null,a.a.createElement(C,null)),a.a.createElement(T.c,null,a.a.createElement(k,null))))},G=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function R(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}i.a.render(a.a.createElement(A,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/symplectic",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/symplectic","/service-worker.js");G?(!function(e,t){fetch(e).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):R(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):R(t,e)}))}}()}},[[24,1,2]]]);
//# sourceMappingURL=main.a711ae47.chunk.js.map