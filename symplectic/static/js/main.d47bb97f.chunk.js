(window.webpackJsonpsymplectic=window.webpackJsonpsymplectic||[]).push([[0],{24:function(e,t,n){e.exports=n(47)},47:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(18),c=n.n(o),i=n(6),s=n(19),l=n(20),u=n.n(l);function m(e,t,n){for(var r=0;r<e.length;r++)e[r]+=n*t[r]}function d(e,t,n,r){for(var a=0;a<t.length;a++)e[a]=t[a]+r*n[a]}var f=function e(t,n){var r=this;Object(s.a)(this,e),this.constants=t,this.getEnergyGradients=n,this.iterate=function(e,t){var n=u()(e);n.time+=2*t;for(var a=[],o=[],c=0;c<n.objects.length;c++){var i=n.objects[c],s=r.constants[0],l=s.c,f=s.d,b=[],p=[];b.length=i.position.length,p.length=i.momentum.length;var g=r.getEnergyGradients(c,i.position,i.momentum,e);d(b,i.position,g.gradMomentum,t*f),d(p,i.momentum,g.gradPosition,t*-f),g=r.getEnergyGradients(c,b,p,e),m(i.position,g.gradMomentum,t*l),m(i.momentum,g.gradPosition,t*-l),a.push(b),o.push(p)}var v=!0,j=!1,y=void 0;try{for(var h,O=r.constants.slice(1,r.constants.length-1)[Symbol.iterator]();!(v=(h=O.next()).done);v=!0)for(var E=h.value,w=(l=E.c,E.d),x=0;x<n.objects.length;x++){var P=n.objects[x],k=a[x],S=o[x],T=r.getEnergyGradients(x,P.position,P.momentum,e);m(k,T.gradMomentum,t*w),m(S,T.gradPosition,t*-w),T=r.getEnergyGradients(x,k,S,e),m(P.position,T.gradMomentum,t*l),m(P.momentum,T.gradPosition,t*-l)}}catch(ae){j=!0,y=ae}finally{try{v||null==O.return||O.return()}finally{if(j)throw y}}for(var C=0;C<n.objects.length;C++){f=r.constants[r.constants.length-1].d;var M=n.objects[C],A=a[C],D=r.getEnergyGradients(C,M.position,M.momentum,e);d(M.position,A,D.gradMomentum,t*f)}for(var G=0;G<n.objects.length;G++){var R=n.objects[G],q=r.constants[0],W=(l=q.c,q.d),V=a[G],F=o[G],U=r.getEnergyGradients(G,R.position,R.momentum,e);d(V,R.position,U.gradMomentum,t*W),d(F,R.momentum,U.gradPosition,t*-W),U=r.getEnergyGradients(G,V,F,e),m(R.position,U.gradMomentum,t*l),m(R.momentum,U.gradPosition,t*-l)}var _=!0,I=!1,B=void 0;try{for(var J,L=r.constants.slice(1,r.constants.length-1)[Symbol.iterator]();!(_=(J=L.next()).done);_=!0)for(var N=J.value,$=N.c,z=N.d,H=0;H<n.objects.length;H++){var K=n.objects[H],Q=a[H],X=o[H],Y=r.getEnergyGradients(H,K.position,K.momentum,e);m(Q,Y.gradMomentum,t*z),m(X,Y.gradPosition,t*-z),Y=r.getEnergyGradients(H,Q,X,e),m(K.position,Y.gradMomentum,t*$),m(K.momentum,Y.gradPosition,t*-$)}}catch(ae){I=!0,B=ae}finally{try{_||null==L.return||L.return()}finally{if(I)throw B}}for(var Z=0;Z<n.objects.length;Z++){var ee=r.constants[r.constants.length-1].d,te=n.objects[Z],ne=o[Z],re=r.getEnergyGradients(Z,te.position,te.momentum,e);d(te.momentum,ne,re.gradPosition,t*-ee)}return n}},b=n(3),p=n(9),g=n(11),v=n(10);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(n,!0).forEach((function(t){Object(v.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e,t){switch(t.type){case"addEnergyTerm":return y({},e,{energyTerms:[].concat(Object(g.a)(e.energyTerms),[t.term])});case"updateEnergyTerm":var n=Object(g.a)(e.energyTerms);return n[t.index]=t.term,y({},e,{energyTerms:n});case"removeEnergyTerm":var r=Object(g.a)(e.energyTerms);return r.pop(),y({},e,{energyTerms:r});case"addObject":return y({},e,{objects:[].concat(Object(g.a)(e.objects),[{}])});case"removeObject":var a=Object(g.a)(e.objects);return a.pop(),y({},e,{objects:a})}throw new Error("Unhandled action in reducer")}var O=Object(r.createContext)(void 0);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(n,!0).forEach((function(t){Object(v.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function x(e){var t=Object(r.useContext)(O),n=t.state,o=t.dispatch,c=e.index,i=n.energyTerms[c];return a.a.createElement("div",null,n.objects.map((function(e,t){var n=!!i.affectedObjects[t];return a.a.createElement("input",{type:"checkbox",key:t,checked:n,onChange:function(){return o({type:"updateEnergyTerm",index:c,term:w({},i,{affectedObjects:w({},i.affectedObjects,Object(v.a)({},t,!n))})})}})})))}function P(e){var t=Object(r.useContext)(O),n=t.state,o=t.dispatch,c=e.index,i=n.energyTerms[c];return a.a.createElement("div",null,n.objects.map((function(e,t){return a.a.createElement("div",null,n.objects.map((function(e,n){var r=[t,n].toString(),s=!!i.affectedObjectPairs[r];return a.a.createElement("input",{type:"checkbox",key:t,checked:s,onChange:function(){return o({type:"updateEnergyTerm",index:c,term:w({},i,{affectedObjectPairs:w({},i.affectedObjectPairs,Object(v.a)({},r,!s))})})}})})))})))}function k(e){var t=Object(r.useContext)(O),n=t.state,o=t.dispatch,c=Object(r.useState)(""),s=Object(i.a)(c,2),l=s[0],u=s[1],m=Object(r.useState)(!0),d=Object(i.a)(m,2),f=d[0],p=d[1],g=e.index,v=n.energyTerms[g],j=Object(r.useCallback)((function(){var e=Object(b.parseExpression)(l);p(!0),o({type:"updateEnergyTerm",index:g,term:w({},v,{expression:e})})}),[l,g,o,v]),y=Object(r.useCallback)((function(e){u(e.target.value),p(!1)}),[]);return a.a.createElement("div",{style:{border:"2px solid black",padding:"4px",margin:"4px"}},a.a.createElement("h2",null,"Energy ",g),a.a.createElement("input",{type:"text",style:{width:800,color:f?"black":"red"},onChange:y,value:l}),a.a.createElement("input",{type:"button",value:"Parse",onClick:j}),a.a.createElement("h3",null,"Affected objects"),a.a.createElement(x,{index:g}),a.a.createElement("h3",null,"Affected object pairs"),a.a.createElement(P,{index:g}))}function S(){var e=Object(r.useContext)(O),t=e.state,n=e.dispatch,o=t.energyTerms;return a.a.createElement("div",{style:{}},a.a.createElement("h1",null,"Energy terms"),a.a.createElement("div",null,o.map((function(e,t){return a.a.createElement(k,{key:t,index:t})}))),a.a.createElement("input",{type:"button",value:"Add",onClick:function(){return n({type:"addEnergyTerm",term:(e=new b.Constant(0),{expression:e,affectedObjects:{},affectedObjectPairs:{}})});var e}}),a.a.createElement("input",{type:"button",value:"Remove",onClick:function(){return n({type:"removeEnergyTerm"})}}))}function T(){var e=Object(r.useContext)(O),t=e.state,n=e.dispatch;return a.a.createElement("div",null,a.a.createElement("h1",null,"Objects"),a.a.createElement("div",null,t.objects.map((function(e,t){return a.a.createElement("div",{style:{border:"2px solid black",padding:"4px",margin:"4px"}},a.a.createElement("h2",null,"Object ",t))}))),a.a.createElement("input",{type:"button",value:"Add",onClick:function(){return n({type:"addObject"})}}),a.a.createElement("input",{type:"button",value:"Remove",onClick:function(){return n({type:"removeObject"})}}))}var C=n(4),M=(n(45),function(e){var t=Object(r.useRef)(null);return Object(r.useEffect)((function(){if(t.current){var n=t.current,r=n.getContext("2d");if(r){r.fillStyle="grey",r.fillRect(0,0,n.width,n.height),r.fillStyle="red";var a=!0,o=!1,c=void 0;try{for(var i,s=e.integratorState.objects[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){var l=i.value,u=l.position[0]+n.width/2,m=l.position[1]+n.height/2,d=l.position[0]+l.momentum[0]+n.width/2,f=l.position[1]+l.momentum[1]+n.width/2;r.strokeStyle="blue",r.beginPath(),r.moveTo(u,m),r.lineTo(d,f),r.stroke(),r.fillRect(u-2,m-2,4,4)}}catch(b){o=!0,c=b}finally{try{a||null==s.return||s.return()}finally{if(o)throw c}}}}}),[e.integratorState,t]),a.a.createElement("canvas",{width:"1000",height:"1000",ref:t})}),A=[{c:.24658818727861384,d:.08333333333333333},{c:.6047073875057809,d:.397767585954844},{c:-.40098690397880077,d:-.03933369314462574},{c:.09938265838881204,d:.05823277385644839},{c:-.40098690397880077,d:.05823277385644839},{c:.6047073875057809,d:-.03933369314462574},{c:.24658818727861384,d:.397767585954844},{c:0,d:.08333333333333333}];function D(e,t,n){for(var r={variableValues:{}},a=0;a<n;a++)r.variableValues["p"+a.toString()]=t[a],r.variableValues["q"+a.toString()]=e[a];return r}var G=function(){var e=Object(r.useContext)(O).state,t=Object(r.useState)(null),n=Object(i.a)(t,2),o=n[0],c=n[1],s=Object(r.useState)(null),l=Object(i.a)(s,2),u=l[0],m=l[1],d=Object(r.useCallback)((function(){if(u&&o){var e=u.iterate(o,.02);c(e)}}),[o,c,u]);Object(r.useEffect)((function(){var e=setInterval(d,20);return function(){return clearInterval(e)}}),[d]);var g=Object(r.useCallback)((function(){var t=e.energyTerms,n=[],r=[],a=!0,o=!1,i=void 0;try{for(var s,l=t[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){for(var u=s.value,d=Object(b.getAllVariables)(u.expression),g=[],v=[],j=0;j<e.dimensions;j++){var y=Object(b.getDerivativeForExpression)(d["q"+j.toString()],Object(b.getAllDerivatives)(u.expression,new p.Constant(1))),h=Object(b.getDerivativeForExpression)(d["p"+j.toString()],Object(b.getAllDerivatives)(u.expression,new p.Constant(1)));g.push(y),v.push(h)}n.push(g),r.push(v)}}catch(E){o=!0,i=E}finally{try{a||null==l.return||l.return()}finally{if(o)throw i}}var O={time:0,objects:[]};e.objects.forEach((function(e,t){O.objects.push({position:[400*Math.random()-200,400*Math.random()-200],momentum:[20*Math.random()-10,20*Math.random()-10]})})),c(O),m(new f(A,(function(t,a,o,c){for(var i=D(a,o,e.dimensions),s=[],l=[],u=0;u<e.dimensions;u++)s.push(0),l.push(0);return e.energyTerms.forEach((function(u,m){if(u.affectedObjects[t])for(var d=0;d<e.dimensions;d++)s[d]+=n[m][d].evaluate(i),l[d]+=r[m][d].evaluate(i);c.objects.forEach((function(i,d){if(u.affectedObjectPairs[[t,d].toString()])for(var f=c.objects[d],b=function(e,t,n,r,a){for(var o=D(e,t,a),c=0;c<a;c++)o.variableValues["p"+c.toString()+"_b"]=r[c],o.variableValues["q"+c.toString()+"_b"]=n[c];return o}(a,o,f.position,f.momentum,e.dimensions),p=0;p<e.dimensions;p++)s[p]+=n[m][p].evaluate(b),l[p]+=r[m][p].evaluate(b)}))})),{gradPosition:s,gradMomentum:l}})))}),[e.energyTerms,e.objects,e.dimensions]);return a.a.createElement(a.a.Fragment,null,o&&a.a.createElement(a.a.Fragment,null,a.a.createElement("h1",null,"Time: ",o.time),a.a.createElement(M,{integratorState:o})),a.a.createElement("input",{type:"button",value:"Simulate",onClick:g}))},R=function(){var e=function(){for(var e={energyTerms:[{expression:Object(b.parseExpression)("0.5 * (p0 * p0 + p1 * p1)"),affectedObjects:{},affectedObjectPairs:{}},{expression:Object(b.parseExpression)("-10000 / ((q0 - q0_b)^2 + (q1 - q1_b)^2)"),affectedObjects:{},affectedObjectPairs:{}}],objects:[],dimensions:2},t=0;t<10;t++)e.objects.push({});return e.objects.forEach((function(t,n){e.energyTerms[0].affectedObjects[n]=!0})),e.objects.forEach((function(t,n){e.objects.forEach((function(t,r){n!==r&&(e.energyTerms[1].affectedObjectPairs[[n,r].toString()]=!0)}))})),Object(r.useReducer)(h,e)}(),t=Object(i.a)(e,2),n=t[0],o=t[1];return a.a.createElement(O.Provider,{value:{state:n,dispatch:o}},a.a.createElement(C.d,null,a.a.createElement(C.b,null,a.a.createElement(C.a,null,"Simulation"),a.a.createElement(C.a,null,"Objects"),a.a.createElement(C.a,null,"Energy Terms")),a.a.createElement(C.c,null,a.a.createElement(G,null)),a.a.createElement(C.c,null,a.a.createElement(T,null)),a.a.createElement(C.c,null,a.a.createElement(S,null))))},q=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function W(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.a.render(a.a.createElement(R,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/symplectic",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/symplectic","/service-worker.js");q?(!function(e,t){fetch(e).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):W(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):W(t,e)}))}}()}},[[24,1,2]]]);
//# sourceMappingURL=main.d47bb97f.chunk.js.map